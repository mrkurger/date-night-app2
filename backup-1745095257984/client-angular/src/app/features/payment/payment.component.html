<div class="payment-container">
  <div class="payment-header">
    <h1>Subscription Plans</h1>
    <p>Choose a subscription plan to unlock premium features</p>
  </div>

  <!-- Current Subscription Info -->
  <div
    class="current-subscription"
    *ngIf="currentSubscription && currentSubscription.tier !== 'free'"
  >
    <div class="card">
      <div class="card-header">
        <h2>Current Subscription</h2>
      </div>
      <div class="card-body">
        <p><strong>Plan:</strong> {{ currentSubscription.tier | titlecase }}</p>
        <p><strong>Expires:</strong> {{ currentSubscription.expires | date: 'medium' }}</p>
        <p *ngIf="currentSubscription.cancelAtPeriodEnd" class="text-warning">
          Your subscription will not renew after the expiration date.
        </p>
        <button
          class="btn btn-danger"
          (click)="cancelSubscription()"
          [disabled]="loading || currentSubscription.cancelAtPeriodEnd"
        >
          {{
            currentSubscription.cancelAtPeriodEnd ? 'Subscription Cancelled' : 'Cancel Subscription'
          }}
        </button>
      </div>
    </div>
  </div>

  <!-- Subscription Plans -->
  <div class="subscription-plans">
    <div class="row">
      <!-- Free Plan -->
      <div class="col-md-4">
        <div class="card plan-card" [class.selected]="selectedPrice === null">
          <div class="card-header">
            <h3>Free</h3>
          </div>
          <div class="card-body">
            <div class="price">
              <span class="amount">$0</span>
              <span class="period">/month</span>
            </div>
            <ul class="features">
              <li>Basic profile</li>
              <li>Limited ad views</li>
              <li>No ad boosting</li>
              <li>Standard support</li>
            </ul>
            <button
              class="btn btn-outline-primary"
              (click)="selectPrice(null)"
              [disabled]="currentSubscription?.tier === 'free'"
            >
              {{ currentSubscription?.tier === 'free' ? 'Current Plan' : 'Select' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Premium Plans -->
      <div class="col-md-4" *ngFor="let price of subscriptionPrices">
        <div class="card plan-card" [class.selected]="selectedPrice?.id === price.id">
          <div class="card-header">
            <h3>{{ price.productName }}</h3>
          </div>
          <div class="card-body">
            <div class="price">
              <span class="amount">{{ formatPrice(price) }}</span>
            </div>
            <p class="description">{{ price.description }}</p>
            <button
              class="btn btn-primary"
              (click)="selectPrice(price)"
              [disabled]="currentSubscription?.tier === price.productName.toLowerCase()"
            >
              {{
                currentSubscription?.tier === price.productName.toLowerCase()
                  ? 'Current Plan'
                  : 'Select'
              }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Form -->
  <div class="payment-form" *ngIf="selectedPrice">
    <div class="card">
      <div class="card-header">
        <h2>Payment Information</h2>
      </div>
      <div class="card-body">
        <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label for="name">Name on Card</label>
            <input
              type="text"
              id="name"
              formControlName="name"
              class="form-control"
              [class.is-invalid]="
                paymentForm.get('name')?.invalid && paymentForm.get('name')?.touched
              "
            />
            <div
              class="invalid-feedback"
              *ngIf="paymentForm.get('name')?.invalid && paymentForm.get('name')?.touched"
            >
              Name is required
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              class="form-control"
              [class.is-invalid]="
                paymentForm.get('email')?.invalid && paymentForm.get('email')?.touched
              "
            />
            <div
              class="invalid-feedback"
              *ngIf="paymentForm.get('email')?.invalid && paymentForm.get('email')?.touched"
            >
              Valid email is required
            </div>
          </div>

          <div class="form-group">
            <label for="card-element">Credit or Debit Card</label>
            <div id="card-element" class="form-control" #cardElement></div>
            <div class="card-errors text-danger" *ngIf="cardErrors">{{ cardErrors }}</div>
          </div>

          <div class="form-group">
            <button
              type="submit"
              class="btn btn-success btn-block"
              [disabled]="paymentForm.invalid || loading"
            >
              <span *ngIf="loading" class="spinner-border spinner-border-sm mr-2"></span>
              Subscribe Now
            </button>
          </div>

          <div class="payment-details">
            <p>You will be charged {{ formatPrice(selectedPrice) }}</p>
            <p class="text-muted">
              Your subscription will automatically renew. You can cancel anytime.
            </p>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
