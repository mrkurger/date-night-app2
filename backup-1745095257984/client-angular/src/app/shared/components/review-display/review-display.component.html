<mat-card class="review-card" [class.pending]="review.status === 'pending'">
  <!-- Review Header -->
  <mat-card-header>
    <img
      mat-card-avatar
      [src]="review.reviewer.profileImage || '/assets/img/default-profile.jpg'"
      [alt]="review.reviewer.username"
    />
    <mat-card-title>
      {{ review.title }}
      <span class="verified-badge" *ngIf="review.isVerifiedMeeting" matTooltip="Verified Meeting">
        <mat-icon>verified</mat-icon>
      </span>
    </mat-card-title>
    <mat-card-subtitle>
      <span class="reviewer-name">{{ review.reviewer.username }}</span>
      <span class="review-date">{{ review.createdAt | timeAgo }}</span>

      <span class="status-badge" *ngIf="review.status === 'pending'"> Pending Approval </span>
    </mat-card-subtitle>

    <div class="review-rating">
      <app-star-rating
        [rating]="review.rating"
        [readonly]="true"
        [showRatingText]="true"
      ></app-star-rating>
    </div>
  </mat-card-header>

  <!-- Review Content -->
  <mat-card-content>
    <div class="review-content">
      {{ review.content }}
    </div>

    <!-- Category Ratings -->
    <div
      class="category-ratings"
      *ngIf="
        hasCategoryRating('communication') ||
        hasCategoryRating('appearance') ||
        hasCategoryRating('location') ||
        hasCategoryRating('value')
      "
    >
      <h4>Category Ratings</h4>

      <div class="category-grid">
        <div class="category-item" *ngIf="hasCategoryRating('communication')">
          <div class="category-label">Communication</div>
          <app-star-rating
            [rating]="getCategoryRating('communication')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('appearance')">
          <div class="category-label">Appearance</div>
          <app-star-rating
            [rating]="getCategoryRating('appearance')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('location')">
          <div class="category-label">Location</div>
          <app-star-rating
            [rating]="getCategoryRating('location')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('value')">
          <div class="category-label">Value</div>
          <app-star-rating
            [rating]="getCategoryRating('value')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>
      </div>
    </div>

    <!-- Meeting Date -->
    <div class="meeting-date" *ngIf="review.isVerifiedMeeting && review.meetingDate">
      <mat-icon>event</mat-icon>
      <span>Met on {{ review.meetingDate | date: 'mediumDate' }}</span>
    </div>

    <!-- Advertiser Response -->
    <div class="advertiser-response" *ngIf="review.advertiserResponse">
      <mat-divider></mat-divider>
      <div class="response-header">
        <img
          class="response-avatar"
          [src]="review.advertiser.profileImage || '/assets/img/default-profile.jpg'"
          [alt]="review.advertiser.username"
        />
        <div class="response-meta">
          <div class="response-name">
            <strong>Response from {{ review.advertiser.username }}</strong>
          </div>
          <div class="response-date">{{ review.advertiserResponse.date | timeAgo }}</div>
        </div>
      </div>
      <div class="response-content">
        {{ review.advertiserResponse.content }}
      </div>
    </div>
  </mat-card-content>

  <!-- Review Actions -->
  <mat-card-actions *ngIf="showActions && review.status === 'approved'">
    <button
      mat-button
      color="primary"
      (click)="onMarkHelpful()"
      [disabled]="isCurrentUserReviewer"
      matTooltip="Mark this review as helpful"
    >
      <mat-icon>thumb_up</mat-icon>
      Helpful ({{ review.helpfulVotes }})
    </button>

    <button
      mat-button
      color="warn"
      (click)="onReportReview()"
      [disabled]="isCurrentUserReviewer"
      matTooltip="Report this review"
    >
      <mat-icon>flag</mat-icon>
      Report
    </button>

    <span class="spacer"></span>

    <!-- Advertiser Actions -->
    <button
      mat-button
      color="primary"
      *ngIf="isCurrentUserAdvertiser && !review.advertiserResponse"
      (click)="onRespondToReview()"
      matTooltip="Respond to this review"
    >
      <mat-icon>reply</mat-icon>
      Respond
    </button>

    <!-- Reviewer Actions -->
    <button
      mat-button
      color="primary"
      *ngIf="isCurrentUserReviewer"
      (click)="onEditReview()"
      matTooltip="Edit your review"
    >
      <mat-icon>edit</mat-icon>
      Edit
    </button>

    <button
      mat-button
      color="warn"
      *ngIf="isCurrentUserReviewer"
      (click)="onDeleteReview()"
      matTooltip="Delete your review"
    >
      <mat-icon>delete</mat-icon>
      Delete
    </button>
  </mat-card-actions>
</mat-card>
