<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>client-angular documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">client-angular documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  SavedFilter</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/features/list-view/list-view.component.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#filter" 
>
                                            filter
                                        </a>
                                </li>
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="filter"></a>
                                        <span class="name "><b>filter</b>
                                            <a href="#filter">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>filter:         <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, AfterViewInit, ViewChild, TemplateRef } from &#x27;@angular/core&#x27;;
import { CommonModule } from &#x27;@angular/common&#x27;;
import { RouterModule, Router } from &#x27;@angular/router&#x27;;
import { FormBuilder, FormGroup, ReactiveFormsModule, FormsModule } from &#x27;@angular/forms&#x27;;
import { AdService } from &#x27;../../core/services/ad.service&#x27;;
import { NotificationService } from &#x27;../../core/services/notification.service&#x27;;
import { ChatService } from &#x27;../../core/services/chat.service&#x27;;
import { AuthService } from &#x27;../../core/services/auth.service&#x27;;
import { UserPreferencesService } from &#x27;../../core/services/user-preferences.service&#x27;;
import { Ad } from &#x27;../../core/models/ad.interface&#x27;;
import { AdCardComponent } from &#x27;../../shared/components/ad-card/ad-card.component&#x27;;

// Material Imports
import { MatIconModule } from &#x27;@angular/material/icon&#x27;;
import { MatButtonModule } from &#x27;@angular/material/button&#x27;;
import { MatFormFieldModule } from &#x27;@angular/material/form-field&#x27;;
import { MatInputModule } from &#x27;@angular/material/input&#x27;;
import { MatSelectModule } from &#x27;@angular/material/select&#x27;;
import { MatCheckboxModule } from &#x27;@angular/material/checkbox&#x27;;
import { MatTooltipModule } from &#x27;@angular/material/tooltip&#x27;;
import { MatProgressSpinnerModule } from &#x27;@angular/material/progress-spinner&#x27;;
import { MatMenuModule } from &#x27;@angular/material/menu&#x27;;
import { MatChipsModule } from &#x27;@angular/material/chips&#x27;;
import { MatDatepickerModule } from &#x27;@angular/material/datepicker&#x27;;
import { MatNativeDateModule } from &#x27;@angular/material/core&#x27;;
import { MatDialogModule, MatDialog } from &#x27;@angular/material/dialog&#x27;;

// Import Emerald components
import { AppCardComponent } from &#x27;../../shared/emerald/components/app-card/app-card.component&#x27;;
import { CardGridComponent } from &#x27;../../shared/emerald/components/card-grid/card-grid.component&#x27;;
import { PagerComponent } from &#x27;../../shared/emerald/components/pager/pager.component&#x27;;
import { PageHeaderComponent } from &#x27;../../shared/emerald/components/page-header/page-header.component&#x27;;
import { SkeletonLoaderComponent } from &#x27;../../shared/emerald/components/skeleton-loader/skeleton-loader.component&#x27;;
import { FloatingActionButtonComponent } from &#x27;../../shared/emerald/components/floating-action-button/floating-action-button.component&#x27;;

// Interfaces
interface SortOption {
  value: string;
  label: string;
  direction?: &#x27;asc&#x27; | &#x27;desc&#x27;;
}

interface HeaderAction {
  id: string;
  label: string;
  icon?: string;
  type?: &#x27;primary&#x27; | &#x27;secondary&#x27; | &#x27;danger&#x27;;
  primary?: boolean;
}

interface FilterItem {
  key: string;
  value: any;
  label: string;
}

interface SavedFilter {
  id: string;
  name: string;
  filter: any;
}

@Component({
  selector: &#x27;app-list-view&#x27;,
  templateUrl: &#x27;./list-view.component.html&#x27;,
  styleUrls: [&#x27;./list-view.component.scss&#x27;],
  standalone: true,
  imports: [
    CommonModule,
    RouterModule,
    ReactiveFormsModule,
    FormsModule,
    AdCardComponent,
    MatIconModule,
    MatButtonModule,
    MatFormFieldModule,
    MatInputModule,
    MatSelectModule,
    MatCheckboxModule,
    MatTooltipModule,
    MatProgressSpinnerModule,
    MatMenuModule,
    MatChipsModule,
    MatDatepickerModule,
    MatNativeDateModule,
    MatDialogModule,
    // Emerald components
    AppCardComponent,
    CardGridComponent,
    PagerComponent,
    PageHeaderComponent,
    SkeletonLoaderComponent,
    FloatingActionButtonComponent,
  ],
})
export class ListViewComponent implements OnInit, AfterViewInit {
  // View template references
  @ViewChild(&#x27;saveFilterDialog&#x27;) saveFilterDialog!: TemplateRef&lt;any&gt;;

  // Data
  ads: Ad[] &#x3D; [];
  filteredAds: Ad[] &#x3D; [];
  loading &#x3D; true;
  error: string | null &#x3D; null;
  filterForm: FormGroup;
  isAuthenticated &#x3D; false;

  // Pagination
  currentPage &#x3D; 1;
  itemsPerPage &#x3D; 20; // Default page size
  totalPages &#x3D; 1;

  // Sorting
  sortOptions: SortOption[] &#x3D; [
    { value: &#x27;newest&#x27;, label: &#x27;Newest First&#x27;, direction: &#x27;desc&#x27; },
    { value: &#x27;oldest&#x27;, label: &#x27;Oldest First&#x27;, direction: &#x27;asc&#x27; },
    { value: &#x27;nameAsc&#x27;, label: &#x27;Name (A-Z)&#x27;, direction: &#x27;asc&#x27; },
    { value: &#x27;nameDesc&#x27;, label: &#x27;Name (Z-A)&#x27;, direction: &#x27;desc&#x27; },
    { value: &#x27;popularityDesc&#x27;, label: &#x27;Most Popular&#x27;, direction: &#x27;desc&#x27; },
  ];
  currentSort &#x3D; &#x27;newest&#x27;;

  // Search debouncing
  private searchTimeout: ReturnType&lt;typeof setTimeout&gt;;

  // View options
  viewMode: &#x27;grid&#x27; | &#x27;list&#x27; | &#x27;compact&#x27; &#x3D; &#x27;grid&#x27;;

  // Filter sidebar
  filterSidebarOpen &#x3D; false;
  activeFilterCount &#x3D; 0;

  // Header actions
  headerActions: HeaderAction[] &#x3D; [
    { id: &#x27;new-ad&#x27;, label: &#x27;Create Ad&#x27;, icon: &#x27;add&#x27;, type: &#x27;primary&#x27; },
    { id: &#x27;refresh&#x27;, label: &#x27;Refresh&#x27;, icon: &#x27;refresh&#x27; },
    { id: &#x27;help&#x27;, label: &#x27;Help&#x27;, icon: &#x27;help_outline&#x27; },
  ];

  // Floating action button
  fabMenuItems &#x3D; [
    { icon: &#x27;fa-plus&#x27;, label: &#x27;Create Ad&#x27;, action: &#x27;create&#x27; },
    { icon: &#x27;fa-heart&#x27;, label: &#x27;View Favorites&#x27;, action: &#x27;favorites&#x27; },
    { icon: &#x27;fa-history&#x27;, label: &#x27;Recent Ads&#x27;, action: &#x27;recent&#x27; },
  ];

  // Saved filters
  savedFilters: SavedFilter[] &#x3D; [];
  newFilterName &#x3D; &#x27;&#x27;;

  constructor(
    private adService: AdService,
    private notificationService: NotificationService,
    private chatService: ChatService,
    private authService: AuthService,
    private userPreferencesService: UserPreferencesService,
    private fb: FormBuilder,
    private router: Router,
    private dialog: MatDialog
  ) {
    // Initialize form with nested structure for advanced filtering
    this.filterForm &#x3D; this.fb.group({
      searchQuery: [&#x27;&#x27;],
      categories: this.fb.group({
        escort: [false],
        massage: [false],
        striptease: [false],
      }),
      location: [[]],
      dateRange: this.fb.group({
        from: [null],
        to: [null],
      }),
      status: this.fb.group({
        online: [false],
        touring: [false],
        verified: [false],
      }),
    });

    // Load saved filters from localStorage
    this.loadSavedFilters();

    // Load user preferences for view mode
    const preferences &#x3D; this.userPreferencesService.getPreferences();

    // Set default view mode from user preferences
    if (preferences.defaultViewType &#x3D;&#x3D;&#x3D; &#x27;list&#x27;) {
      this.viewMode &#x3D; &#x27;list&#x27;;
    } else if (preferences.defaultViewType &#x3D;&#x3D;&#x3D; &#x27;tinder&#x27;) {
      this.viewMode &#x3D; &#x27;compact&#x27;;
    } else {
      this.viewMode &#x3D; &#x27;grid&#x27;; // Netflix view is grid view
    }
  }

  ngOnInit(): void {
    this.loadAds();
    this.authService.currentUser$.subscribe(user &#x3D;&gt; {
      this.isAuthenticated &#x3D; !!user;
    });

    // Subscribe to filter form changes
    this.filterForm.valueChanges.subscribe(() &#x3D;&gt; {
      this.updateActiveFilterCount();
    });

    // Subscribe to user preferences changes
    this.userPreferencesService.preferences$.subscribe(prefs &#x3D;&gt; {
      // Update view mode when preferences change
      if (prefs.defaultViewType &#x3D;&#x3D;&#x3D; &#x27;list&#x27;) {
        this.viewMode &#x3D; &#x27;list&#x27;;
      } else if (prefs.defaultViewType &#x3D;&#x3D;&#x3D; &#x27;tinder&#x27;) {
        this.viewMode &#x3D; &#x27;compact&#x27;;
      } else {
        this.viewMode &#x3D; &#x27;grid&#x27;; // Netflix view is grid view
      }
    });
  }

  /**
   * After the view is initialized, set up any necessary DOM interactions
   */
  ngAfterViewInit(): void {
    // Any post-view initialization code
  }

  /**
   * Loads advertisements from the server and maps the data to match template expectations.
   */
  loadAds(): void {
    this.loading &#x3D; true;
    this.error &#x3D; null;

    this.adService.getAds().subscribe({
      next: ads &#x3D;&gt; {
        // Map server data to match template expectations
        this.ads &#x3D; ads.map(ad &#x3D;&gt; ({
          ...ad,
          // Map viewCount to views for template compatibility
          views: ad.viewCount,
          // Ensure tags is defined (even if empty)
          tags: ad.tags || [],
          // Add isAdvertiserOnline property if not present
          isAdvertiserOnline: ad.isAdvertiserOnline || Math.random() &gt; 0.5, // Random for demo
        }));
        this.applyFilters();
        this.loading &#x3D; false;
      },
      error: err &#x3D;&gt; {
        this.error &#x3D; &#x27;Failed to load ads. Please try again.&#x27;;
        this.loading &#x3D; false;
        console.error(&#x27;Error loading ads:&#x27;, err);
      },
    });
  }

  /**
   * Apply all active filters to the ads list
   */
  applyFilters(): void {
    const filters &#x3D; this.filterForm.value;

    // Apply filters
    this.filteredAds &#x3D; this.ads.filter(ad &#x3D;&gt; {
      // Category filters
      if (filters.categories) {
        const categorySelected &#x3D;
          filters.categories.escort || filters.categories.massage || filters.categories.striptease;

        if (categorySelected) {
          const categoryMatches &#x3D;
            (filters.categories.escort &amp;&amp; ad.category &#x3D;&#x3D;&#x3D; &#x27;Escort&#x27;) ||
            (filters.categories.massage &amp;&amp; ad.category &#x3D;&#x3D;&#x3D; &#x27;Massage&#x27;) ||
            (filters.categories.striptease &amp;&amp; ad.category &#x3D;&#x3D;&#x3D; &#x27;Striptease&#x27;);

          if (!categoryMatches) return false;
        }
      }

      // Location filter
      if (filters.location &amp;&amp; filters.location.length &gt; 0) {
        if (!ad.location || !filters.location.includes(ad.location)) {
          return false;
        }
      }

      // Date range filter
      if (filters.dateRange) {
        if (filters.dateRange.from &amp;&amp; ad.createdAt) {
          const fromDate &#x3D; new Date(filters.dateRange.from);
          const adDate &#x3D; new Date(ad.createdAt);
          if (adDate &lt; fromDate) return false;
        }

        if (filters.dateRange.to &amp;&amp; ad.createdAt) {
          const toDate &#x3D; new Date(filters.dateRange.to);
          const adDate &#x3D; new Date(ad.createdAt);
          if (adDate &gt; toDate) return false;
        }
      }

      // Status filters
      if (filters.status) {
        if (filters.status.online &amp;&amp; !ad.isAdvertiserOnline) {
          return false;
        }

        if (filters.status.touring &amp;&amp; !ad.isTouring) {
          return false;
        }

        if (filters.status.verified &amp;&amp; !ad.isVerified) {
          return false;
        }
      }

      // Search query
      if (filters.searchQuery) {
        const query &#x3D; filters.searchQuery.toLowerCase();
        const matchesTitle &#x3D; ad.title.toLowerCase().includes(query);
        const matchesDescription &#x3D; ad.description.toLowerCase().includes(query);
        const matchesLocation &#x3D; ad.location?.toLowerCase().includes(query);
        const matchesTags &#x3D; ad.tags.some(tag &#x3D;&gt; tag.toLowerCase().includes(query));

        if (!matchesTitle &amp;&amp; !matchesDescription &amp;&amp; !matchesLocation &amp;&amp; !matchesTags) {
          return false;
        }
      }

      return true;
    });

    // Apply sorting
    this.sortAds();

    // Update pagination
    this.totalPages &#x3D; Math.ceil(this.filteredAds.length / this.itemsPerPage);
    this.currentPage &#x3D; 1;

    // Update active filter count
    this.updateActiveFilterCount();
  }

  /**
   * Sort the filtered ads based on the current sort option
   */
  sortAds(): void {
    switch (this.currentSort) {
      case &#x27;newest&#x27;:
        this.filteredAds.sort(
          (a, b) &#x3D;&gt; new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()
        );
        break;
      case &#x27;oldest&#x27;:
        this.filteredAds.sort(
          (a, b) &#x3D;&gt; new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()
        );
        break;
      case &#x27;nameAsc&#x27;:
        this.filteredAds.sort((a, b) &#x3D;&gt; a.title.localeCompare(b.title));
        break;
      case &#x27;nameDesc&#x27;:
        this.filteredAds.sort((a, b) &#x3D;&gt; b.title.localeCompare(a.title));
        break;
      case &#x27;popularityDesc&#x27;:
        this.filteredAds.sort((a, b) &#x3D;&gt; (b.views || 0) - (a.views || 0));
        break;
    }
  }

  /**
   * Change the current sort option
   */
  changeSort(sortValue: string): void {
    this.currentSort &#x3D; sortValue;
    this.sortAds();
  }

  /**
   * Get the label for the current sort option
   */
  getCurrentSortLabel(): string {
    const option &#x3D; this.sortOptions.find(opt &#x3D;&gt; opt.value &#x3D;&#x3D;&#x3D; this.currentSort);
    return option ? option.label : &#x27;Sort&#x27;;
  }

  /**
   * Get the ads for the current page
   */
  getCurrentPageAds(): Ad[] {
    const startIndex &#x3D; (this.currentPage - 1) * this.itemsPerPage;
    const endIndex &#x3D; startIndex + this.itemsPerPage;
    return this.filteredAds.slice(startIndex, endIndex);
  }

  /**
   * Navigate to a specific page
   */
  goToPage(page: number): void {
    if (page &gt;&#x3D; 1 &amp;&amp; page &lt;&#x3D; this.totalPages) {
      this.currentPage &#x3D; page;
    }
  }

  /**
   * Change the number of items displayed per page
   */
  changePageSize(size: number): void {
    this.itemsPerPage &#x3D; size;
    this.totalPages &#x3D; Math.ceil(this.filteredAds.length / this.itemsPerPage);

    // Adjust current page if it&#x27;s now out of bounds
    if (this.currentPage &gt; this.totalPages) {
      this.currentPage &#x3D; this.totalPages || 1;
    }
  }

  /**
   * Set the view mode (grid, list, or compact) and save to user preferences
   */
  setViewMode(mode: &#x27;grid&#x27; | &#x27;list&#x27; | &#x27;compact&#x27;): void {
    this.viewMode &#x3D; mode;

    // Map view mode to preference value
    let defaultViewType: &#x27;netflix&#x27; | &#x27;tinder&#x27; | &#x27;list&#x27;;

    if (mode &#x3D;&#x3D;&#x3D; &#x27;grid&#x27;) {
      defaultViewType &#x3D; &#x27;netflix&#x27;;
    } else if (mode &#x3D;&#x3D;&#x3D; &#x27;compact&#x27;) {
      defaultViewType &#x3D; &#x27;tinder&#x27;;
    } else {
      defaultViewType &#x3D; &#x27;list&#x27;;
    }

    // Save to user preferences
    this.userPreferencesService.setDefaultViewType(defaultViewType);
  }

  /**
   * Get the number of columns based on the current view mode
   */
  getColumnsForViewMode(): number {
    switch (this.viewMode) {
      case &#x27;list&#x27;:
        return 1;
      case &#x27;grid&#x27;:
        return 3;
      case &#x27;compact&#x27;:
        return 4;
      default:
        return 3;
    }
  }

  /**
   * Navigate to ad details page
   */
  viewAdDetails(adId: string): void {
    this.router.navigate([&#x27;/ad-details&#x27;, adId]);
  }

  /**
   * Share an ad with others
   */
  shareAd(adId: string): void {
    if (navigator.share) {
      // Use Web Share API if available
      navigator
        .share({
          title: &#x27;Check out this profile on DateNight.io&#x27;,
          text: &#x27;I found an interesting profile you might like&#x27;,
          url: &#x60;${window.location.origin}/ad-details/${adId}&#x60;,
        })
        .catch(err &#x3D;&gt; {
          console.error(&#x27;Error sharing:&#x27;, err);
        });
    } else {
      // Fallback: copy link to clipboard
      const url &#x3D; &#x60;${window.location.origin}/ad-details/${adId}&#x60;;
      navigator.clipboard
        .writeText(url)
        .then(() &#x3D;&gt; {
          this.notificationService.success(&#x27;Link copied to clipboard&#x27;);
        })
        .catch(err &#x3D;&gt; {
          console.error(&#x27;Error copying to clipboard:&#x27;, err);
          this.notificationService.error(&#x27;Failed to copy link&#x27;);
        });
    }
  }

  /**
   * Like an ad
   */
  likeAd(adId: string, event?: Event): void {
    if (event) event.stopPropagation();

    if (!this.isAuthenticated) {
      this.notificationService.error(&#x27;Please log in to like ads&#x27;);
      return;
    }

    // Using recordSwipe with &#x27;right&#x27; direction as a like action
    this.adService.recordSwipe(adId, &#x27;right&#x27;).subscribe({
      next: () &#x3D;&gt; {
        this.notificationService.success(&#x27;Added to your favorites&#x27;);
      },
      error: err &#x3D;&gt; {
        this.notificationService.error(&#x27;Failed to like ad&#x27;);
        console.error(&#x27;Error liking ad:&#x27;, err);
      },
    });
  }

  /**
   * Start a chat with an advertiser
   */
  startChat(adId: string, event?: Event): void {
    if (event) event.stopPropagation();

    if (!this.isAuthenticated) {
      this.notificationService.error(&#x27;Please log in to start a chat&#x27;);
      return;
    }

    this.chatService.createAdRoom(adId).subscribe({
      next: room &#x3D;&gt; {
        this.router.navigate([&#x27;/chat&#x27;, room._id]);
      },
      error: err &#x3D;&gt; {
        this.notificationService.error(&#x27;Failed to start chat&#x27;);
        console.error(&#x27;Error starting chat:&#x27;, err);
      },
    });
  }

  /**
   * Clear all active filters
   */
  clearFilters(): void {
    this.filterForm.reset({
      searchQuery: &#x27;&#x27;,
      categories: {
        escort: false,
        massage: false,
        striptease: false,
      },
      location: [],
      dateRange: {
        from: null,
        to: null,
      },
      status: {
        online: false,
        touring: false,
        verified: false,
      },
    });

    this.applyFilters();
  }

  /**
   * Handle search input changes with debouncing
   */
  onSearchChange(): void {
    clearTimeout(this.searchTimeout);
    this.searchTimeout &#x3D; setTimeout(() &#x3D;&gt; {
      this.applyFilters();
    }, 300);
  }

  /**
   * Toggle the filter sidebar
   */
  toggleFilterSidebar(): void {
    this.filterSidebarOpen &#x3D; !this.filterSidebarOpen;
  }

  /**
   * Update the count of active filters
   */
  updateActiveFilterCount(): void {
    const filters &#x3D; this.filterForm.value;
    let count &#x3D; 0;

    // Count category filters
    if (filters.categories) {
      if (filters.categories.escort) count++;
      if (filters.categories.massage) count++;
      if (filters.categories.striptease) count++;
    }

    // Count location filters
    if (filters.location &amp;&amp; filters.location.length &gt; 0) {
      count +&#x3D; filters.location.length;
    }

    // Count date range filters
    if (filters.dateRange) {
      if (filters.dateRange.from) count++;
      if (filters.dateRange.to) count++;
    }

    // Count status filters
    if (filters.status) {
      if (filters.status.online) count++;
      if (filters.status.touring) count++;
      if (filters.status.verified) count++;
    }

    // Count search query
    if (filters.searchQuery) count++;

    this.activeFilterCount &#x3D; count;
  }

  /**
   * Check if there are any active filters
   */
  hasActiveFilters(): boolean {
    return this.activeFilterCount &gt; 0;
  }

  /**
   * Get a list of active filters for display
   */
  getActiveFilters(): FilterItem[] {
    const filters &#x3D; this.filterForm.value;
    const activeFilters: FilterItem[] &#x3D; [];

    // Add category filters
    if (filters.categories) {
      if (filters.categories.escort) {
        activeFilters.push({ key: &#x27;categories.escort&#x27;, value: true, label: &#x27;Category: Escort&#x27; });
      }
      if (filters.categories.massage) {
        activeFilters.push({ key: &#x27;categories.massage&#x27;, value: true, label: &#x27;Category: Massage&#x27; });
      }
      if (filters.categories.striptease) {
        activeFilters.push({
          key: &#x27;categories.striptease&#x27;,
          value: true,
          label: &#x27;Category: Striptease&#x27;,
        });
      }
    }

    // Add location filters
    if (filters.location &amp;&amp; filters.location.length &gt; 0) {
      filters.location.forEach((loc: string) &#x3D;&gt; {
        activeFilters.push({ key: &#x27;location&#x27;, value: loc, label: &#x60;Location: ${loc}&#x60; });
      });
    }

    // Add date range filters
    if (filters.dateRange) {
      if (filters.dateRange.from) {
        const fromDate &#x3D; new Date(filters.dateRange.from).toLocaleDateString();
        activeFilters.push({
          key: &#x27;dateRange.from&#x27;,
          value: filters.dateRange.from,
          label: &#x60;From: ${fromDate}&#x60;,
        });
      }
      if (filters.dateRange.to) {
        const toDate &#x3D; new Date(filters.dateRange.to).toLocaleDateString();
        activeFilters.push({
          key: &#x27;dateRange.to&#x27;,
          value: filters.dateRange.to,
          label: &#x60;To: ${toDate}&#x60;,
        });
      }
    }

    // Add status filters
    if (filters.status) {
      if (filters.status.online) {
        activeFilters.push({ key: &#x27;status.online&#x27;, value: true, label: &#x27;Online Now&#x27; });
      }
      if (filters.status.touring) {
        activeFilters.push({ key: &#x27;status.touring&#x27;, value: true, label: &#x27;Touring&#x27; });
      }
      if (filters.status.verified) {
        activeFilters.push({ key: &#x27;status.verified&#x27;, value: true, label: &#x27;Verified&#x27; });
      }
    }

    // Add search query
    if (filters.searchQuery) {
      activeFilters.push({
        key: &#x27;searchQuery&#x27;,
        value: filters.searchQuery,
        label: &#x60;Search: ${filters.searchQuery}&#x60;,
      });
    }

    return activeFilters;
  }

  /**
   * Remove a specific filter
   */
  removeFilter(filter: FilterItem): void {
    // Handle nested form controls
    if (filter.key.includes(&#x27;.&#x27;)) {
      const [group, control] &#x3D; filter.key.split(&#x27;.&#x27;);

      // Handle array values in location
      if (group &#x3D;&#x3D;&#x3D; &#x27;location&#x27;) {
        const currentLocations &#x3D; [...this.filterForm.get(&#x27;location&#x27;)!.value];
        const index &#x3D; currentLocations.indexOf(filter.value);
        if (index !&#x3D;&#x3D; -1) {
          currentLocations.splice(index, 1);
          this.filterForm.get(&#x27;location&#x27;)!.setValue(currentLocations);
        }
      } else {
        // Handle nested form groups
        const formGroup &#x3D; this.filterForm.get(group) as FormGroup;
        if (formGroup) {
          formGroup.get(control)?.setValue(filter.key.startsWith(&#x27;dateRange&#x27;) ? null : false);
        }
      }
    } else {
      // Handle top-level form controls
      this.filterForm.get(filter.key)?.setValue(&#x27;&#x27;);
    }

    this.applyFilters();
  }

  /**
   * Handle header action clicks
   */
  onHeaderActionClick(action: HeaderAction): void {
    switch (action.id) {
      case &#x27;new-ad&#x27;:
        this.router.navigate([&#x27;/ad-management/create&#x27;]);
        break;
      case &#x27;refresh&#x27;:
        this.loadAds();
        break;
      case &#x27;help&#x27;:
        this.notificationService.info(&#x27;Help information will be displayed here&#x27;);
        break;
    }
  }

  /**
   * Handle floating action button click
   */
  onFabClick(): void {
    this.router.navigate([&#x27;/ad-management/create&#x27;]);
  }

  /**
   * Handle floating action button menu item click
   */
  onFabMenuItemClick(item: any): void {
    switch (item.action) {
      case &#x27;create&#x27;:
        this.router.navigate([&#x27;/ad-management/create&#x27;]);
        break;
      case &#x27;favorites&#x27;:
        this.loadSavedFilter(&#x27;favorite&#x27;);
        break;
      case &#x27;recent&#x27;:
        this.loadSavedFilter(&#x27;recent&#x27;);
        break;
    }
  }

  /**
   * Save the current filter configuration
   */
  saveCurrentFilter(): void {
    const dialogRef &#x3D; this.dialog.open(this.saveFilterDialog);

    dialogRef.afterClosed().subscribe(result &#x3D;&gt; {
      if (result) {
        const newFilter: SavedFilter &#x3D; {
          id: Date.now().toString(),
          name: result,
          filter: this.filterForm.value,
        };

        this.savedFilters.push(newFilter);
        this.saveSavedFilters();

        // Also save to user preferences
        this.userPreferencesService.saveFilter(result, this.filterForm.value);

        this.notificationService.success(&#x60;Filter &quot;${result}&quot; saved successfully&#x60;);
      }
    });
  }

  /**
   * Load a saved filter
   */
  loadSavedFilter(filterId: string): void {
    // Handle predefined filters
    if (filterId &#x3D;&#x3D;&#x3D; &#x27;favorite&#x27;) {
      this.clearFilters();
      this.filterForm.patchValue({
        status: { verified: true },
      });
      this.applyFilters();
      return;
    }

    if (filterId &#x3D;&#x3D;&#x3D; &#x27;recent&#x27;) {
      this.clearFilters();
      this.filterForm.patchValue({
        dateRange: {
          from: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 days ago
        },
      });
      this.applyFilters();
      return;
    }

    // First check user preferences for the filter
    const userFilter &#x3D; this.userPreferencesService.getSavedFilter(filterId);
    if (userFilter) {
      this.filterForm.patchValue(userFilter);
      this.applyFilters();
      this.notificationService.success(&#x60;Filter &quot;${filterId}&quot; loaded&#x60;);
      return;
    }

    // Fall back to local saved filters
    const savedFilter &#x3D; this.savedFilters.find(f &#x3D;&gt; f.id &#x3D;&#x3D;&#x3D; filterId);
    if (savedFilter) {
      this.filterForm.patchValue(savedFilter.filter);
      this.applyFilters();
      this.notificationService.success(&#x60;Filter &quot;${savedFilter.name}&quot; loaded&#x60;);

      // Migrate to user preferences for future use
      this.userPreferencesService.saveFilter(savedFilter.name, savedFilter.filter);
    }
  }

  /**
   * Save filters to localStorage
   */
  private saveSavedFilters(): void {
    localStorage.setItem(&#x27;savedFilters&#x27;, JSON.stringify(this.savedFilters));
  }

  /**
   * Load filters from localStorage
   */
  private loadSavedFilters(): void {
    // First try to load from user preferences
    const preferences &#x3D; this.userPreferencesService.getPreferences();
    if (preferences.savedFilters &amp;&amp; Object.keys(preferences.savedFilters).length &gt; 0) {
      // Convert user preferences format to our local format
      this.savedFilters &#x3D; Object.entries(preferences.savedFilters).map(([name, filter]) &#x3D;&gt; ({
        id: name,
        name: name,
        filter: filter,
      }));
    } else {
      // Fall back to localStorage for backward compatibility
      const savedFilters &#x3D; localStorage.getItem(&#x27;savedFilters&#x27;);
      if (savedFilters) {
        this.savedFilters &#x3D; JSON.parse(savedFilters);

        // Migrate to user preferences
        this.savedFilters.forEach(filter &#x3D;&gt; {
          this.userPreferencesService.saveFilter(filter.name, filter.filter);
        });
      }
    }
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'SavedFilter.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
