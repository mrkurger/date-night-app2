{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.554Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:32.557Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.558Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:32.559Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:43.360Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:45.384Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:48.453Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:52.498Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.424Z","url":"/api/payments/create-payment-intent","userId":"68384fffa8718e4d134c7c1e"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.614Z","url":"/api/payments/subscription-prices","userId":"68384fffa8718e4d134c7c1e"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.699Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.713Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.716Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.719Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.723Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.726Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:59.728Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.741Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:59.743Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.927Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.931Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.933Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.936Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.937Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.939Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:09.226Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:11.310Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:14.430Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:18.442Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:16:25.990Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:25.990Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:26.852Z","url":"/api/payments/create-payment-intent","userId":"6838501a0073d2f61949f027"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:27.251Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.275Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.300Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:27.302Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:27.309Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.322Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:16:27.327Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.334Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:16:27.344Z"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:27.439Z","url":"/api/payments/subscription-prices","userId":"6838501a0073d2f61949f027"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:31.182Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:31.192Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:31.199Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:31.203Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:31.205Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:31.212Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:43.715Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:45.803Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:48.929Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:55.178Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:26.843Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.849Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.852Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:26.854Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:26.855Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:26.856Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.908Z","url":"/api/payments/create-payment-intent","userId":"683850564024e75d3161d9cb"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.997Z","url":"/api/payments/subscription-prices","userId":"683850564024e75d3161d9cb"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.805Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.830Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.832Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:27.838Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.841Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.844Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:17:27.847Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.850Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:17:27.852Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:48.605Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:50.644Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:53.667Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:57.677Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:55:59.618Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:55:59.618Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.001Z","url":"/api/payments/create-payment-intent","userId":"6838595f6d7e0c217fe9fa47"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.030Z","url":"/api/payments/subscription-prices","userId":"6838595f6d7e0c217fe9fa47"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.063Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.065Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.067Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.068Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.069Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.069Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.171Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.175Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.176Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.184Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.185Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.186Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:56:00.186Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.187Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:56:00.187Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:21.737Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:23.757Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:26.804Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:30.824Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.241Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.245Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.247Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.248Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.249Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.250Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T13:22:33.251Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.251Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T13:22:33.252Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.327Z","url":"/api/payments/create-payment-intent","userId":"68385f99988514e40e1db240"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.358Z","url":"/api/payments/subscription-prices","userId":"68385f99988514e40e1db240"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.609Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.611Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.612Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.615Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.616Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.616Z"}
