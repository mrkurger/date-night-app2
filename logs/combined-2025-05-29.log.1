{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:53:34.576Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:53:34.736Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:53:34.787Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:53:35.801Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:53:36.806Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:53:36.808Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:53:36.812Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:53:36.838Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:53:36.923Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:53:37.946Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:53:38.980Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:53:38.980Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:53:42.153Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:53:47.038Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:00.994Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:54:00.994Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:00.994Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:00.994Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:00.994Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:00.994Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:00.994Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:00.994Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:01.873Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:01.893Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:01.903Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:01.906Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:01.912Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:01.915Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:54:01.919Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:01.922Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:54:01.924Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:54:01.877Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:01.936Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:01.943Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:01.948Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:01.954Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:01.956Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:01.958Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.386Z","url":"/api/payments/create-payment-intent","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.446Z","url":"/api/payments/create-payment-intent","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:02.455Z","url":"/api/payments/create-payment-intent","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.463Z","url":"/api/payments/create-subscription","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.467Z","url":"/api/payments/create-subscription","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.474Z","url":"/api/payments/cancel-subscription","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.480Z","url":"/api/payments/boost-ad","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.483Z","url":"/api/payments/boost-ad","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.493Z","url":"/api/payments/feature-ad","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:02.498Z","url":"/api/payments/feature-ad","userId":"68384adacc5cbf72ae9ccbd5"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:02.508Z","url":"/api/payments/subscription-prices","userId":"68384adacc5cbf72ae9ccbd5"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:54:03.399Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:54:03.407Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:54:14.257Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:54:14.437Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:54:14.484Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:54:15.500Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:16.503Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:54:16.504Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:54:16.513Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:54:16.519Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:54:16.524Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:54:17.534Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:18.537Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:54:18.537Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:21.588Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:25.604Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.089Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:54:31.089Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.089Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.089Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.089Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.089Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.089Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.089Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.828Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.835Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.836Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:31.837Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.841Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.843Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:54:31.844Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.845Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:54:31.845Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:31.978Z","url":"/api/payments/create-payment-intent","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:31.995Z","url":"/api/payments/create-payment-intent","userId":"68384af7b3b8f578542517ce"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:32.000Z","url":"/api/payments/create-payment-intent","userId":"68384af7b3b8f578542517ce"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:54:31.951Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:54:31.976Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.978Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:31.980Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:31.985Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:31.985Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:54:31.986Z"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.007Z","url":"/api/payments/create-subscription","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.012Z","url":"/api/payments/create-subscription","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.023Z","url":"/api/payments/cancel-subscription","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.032Z","url":"/api/payments/boost-ad","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.036Z","url":"/api/payments/boost-ad","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.041Z","url":"/api/payments/feature-ad","userId":"68384af7b3b8f578542517ce"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:54:32.044Z","url":"/api/payments/feature-ad","userId":"68384af7b3b8f578542517ce"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:54:32.054Z","url":"/api/payments/subscription-prices","userId":"68384af7b3b8f578542517ce"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:54:32.165Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:54:32.174Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:54:39.855Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:54:39.981Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:54:40.033Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:54:41.054Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:42.058Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:54:42.059Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:54:42.065Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:54:42.077Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:54:42.086Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:54:43.110Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:44.294Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:54:44.298Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:47.899Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:54:51.936Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.578Z","url":"/api/payments/create-payment-intent","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.622Z","url":"/api/payments/create-payment-intent","userId":"68384b140211ebbf48e631d4"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:00.639Z","url":"/api/payments/create-payment-intent","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.718Z","url":"/api/payments/create-subscription","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.739Z","url":"/api/payments/create-subscription","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.776Z","url":"/api/payments/cancel-subscription","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.802Z","url":"/api/payments/boost-ad","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.808Z","url":"/api/payments/boost-ad","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.835Z","url":"/api/payments/feature-ad","userId":"68384b140211ebbf48e631d4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:00.840Z","url":"/api/payments/feature-ad","userId":"68384b140211ebbf48e631d4"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:00.856Z","url":"/api/payments/subscription-prices","userId":"68384b140211ebbf48e631d4"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.071Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:01.071Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.071Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.071Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.071Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.071Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.071Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.071Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.778Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.787Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.790Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:01.791Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.794Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.796Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:01.797Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.802Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:01.805Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:55:01.795Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:01.838Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.842Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:01.846Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:01.851Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:01.855Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:01.864Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:55:02.390Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:55:02.395Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:11.347Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:11.649Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:11.724Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:55:12.736Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:13.739Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:55:13.740Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:55:13.743Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:55:13.748Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:55:13.752Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:55:14.762Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:15.765Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:55:15.765Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:18.819Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:22.832Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:26.991Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:26.991Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:26.991Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:26.991Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:26.991Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:26.991Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:26.991Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:26.991Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.022Z","url":"/api/payments/create-payment-intent","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.042Z","url":"/api/payments/create-payment-intent","userId":"68384b2f7f22b1ace347dd46"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:28.046Z","url":"/api/payments/create-payment-intent","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.051Z","url":"/api/payments/create-subscription","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.053Z","url":"/api/payments/create-subscription","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.059Z","url":"/api/payments/cancel-subscription","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.065Z","url":"/api/payments/boost-ad","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.067Z","url":"/api/payments/boost-ad","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.074Z","url":"/api/payments/feature-ad","userId":"68384b2f7f22b1ace347dd46"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:28.077Z","url":"/api/payments/feature-ad","userId":"68384b2f7f22b1ace347dd46"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:28.080Z","url":"/api/payments/subscription-prices","userId":"68384b2f7f22b1ace347dd46"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:28.267Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:28.271Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:28.272Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:28.273Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:28.274Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:28.275Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:28.275Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:28.276Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:28.277Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:55:28.738Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:28.764Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:28.770Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:28.773Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:28.776Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:28.777Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:28.778Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:55:29.090Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:55:29.093Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:34.256Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:34.404Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:34.456Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:55:35.478Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:36.483Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:55:36.484Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:55:36.487Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:55:36.494Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:55:36.501Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:55:37.512Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:38.516Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:55:38.517Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:41.556Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:45.609Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.395Z","url":"/api/payments/create-payment-intent","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.409Z","url":"/api/payments/create-payment-intent","userId":"68384b47d589efcf8ef3338d"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.416Z","url":"/api/payments/create-payment-intent","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.426Z","url":"/api/payments/create-subscription","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.431Z","url":"/api/payments/create-subscription","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.443Z","url":"/api/payments/cancel-subscription","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.458Z","url":"/api/payments/boost-ad","userId":"68384b47d589efcf8ef3338d"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.412Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:51.412Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.412Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.412Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.412Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.412Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.412Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.412Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.465Z","url":"/api/payments/boost-ad","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.471Z","url":"/api/payments/feature-ad","userId":"68384b47d589efcf8ef3338d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:55:51.476Z","url":"/api/payments/feature-ad","userId":"68384b47d589efcf8ef3338d"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.484Z","url":"/api/payments/subscription-prices","userId":"68384b47d589efcf8ef3338d"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:55:51.594Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.626Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.631Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.634Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:51.644Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:51.646Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:51.650Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.893Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.902Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.905Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:55:51.906Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:55:51.909Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.920Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:51.921Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:55:51.925Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:55:51.926Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:55:52.360Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:55:52.368Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:56.426Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:56.581Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:55:56.633Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:55:57.648Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:55:58.651Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:55:58.651Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:55:58.654Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:55:58.664Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:55:58.669Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:55:59.687Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:00.693Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:56:00.693Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:03.739Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:07.751Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.506Z","url":"/api/payments/create-payment-intent","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.520Z","url":"/api/payments/create-payment-intent","userId":"68384b5dd7ac5296b99dba87"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.462Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:56:13.462Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.462Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.462Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.462Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.462Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.462Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.462Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.525Z","url":"/api/payments/create-payment-intent","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.537Z","url":"/api/payments/create-subscription","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.544Z","url":"/api/payments/create-subscription","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.551Z","url":"/api/payments/cancel-subscription","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.562Z","url":"/api/payments/boost-ad","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.565Z","url":"/api/payments/boost-ad","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.571Z","url":"/api/payments/feature-ad","userId":"68384b5dd7ac5296b99dba87"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:13.581Z","url":"/api/payments/feature-ad","userId":"68384b5dd7ac5296b99dba87"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.585Z","url":"/api/payments/subscription-prices","userId":"68384b5dd7ac5296b99dba87"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:56:13.801Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.830Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.832Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.834Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:13.836Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:13.836Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:13.837Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.855Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.862Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.863Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:13.864Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:13.865Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.867Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:56:13.868Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:13.870Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:56:13.870Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:56:13.926Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:56:13.933Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:56:18.406Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:56:18.530Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:56:18.573Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:56:19.591Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:20.595Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:56:20.595Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:56:20.599Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:56:20.607Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:56:20.618Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:56:21.634Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:22.638Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:56:22.638Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:25.690Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:56:29.703Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.658Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:56:34.658Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:34.658Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:34.658Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.658Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:34.658Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.658Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.658Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:34.832Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.837Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.838Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:34.839Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:34.840Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.841Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:56:34.842Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:34.843Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:56:34.844Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.400Z","url":"/api/payments/create-payment-intent","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.435Z","url":"/api/payments/create-payment-intent","userId":"68384b738e30e363f9778fa2"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:35.446Z","url":"/api/payments/create-payment-intent","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.461Z","url":"/api/payments/create-subscription","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.465Z","url":"/api/payments/create-subscription","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.482Z","url":"/api/payments/cancel-subscription","userId":"68384b738e30e363f9778fa2"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:56:35.388Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:56:35.435Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:35.441Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:35.445Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:35.449Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:35.457Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:56:35.461Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.527Z","url":"/api/payments/boost-ad","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.531Z","url":"/api/payments/boost-ad","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.538Z","url":"/api/payments/feature-ad","userId":"68384b738e30e363f9778fa2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:56:35.544Z","url":"/api/payments/feature-ad","userId":"68384b738e30e363f9778fa2"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:56:35.551Z","url":"/api/payments/subscription-prices","userId":"68384b738e30e363f9778fa2"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:56:35.898Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:56:35.901Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:56:57.564Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:56:58.339Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:56:58.354Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:56:59.369Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:00.375Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:57:00.377Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:57:00.382Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:57:00.391Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:57:00.397Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:57:01.430Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:02.436Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:57:02.436Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:05.506Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:09.531Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.178Z","url":"/api/payments/create-payment-intent","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.194Z","url":"/api/payments/create-payment-intent","userId":"68384b9f2021db52ae7f4ab2"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.199Z","url":"/api/payments/create-payment-intent","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.209Z","url":"/api/payments/create-subscription","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.215Z","url":"/api/payments/create-subscription","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.225Z","url":"/api/payments/cancel-subscription","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.237Z","url":"/api/payments/boost-ad","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.243Z","url":"/api/payments/boost-ad","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.255Z","url":"/api/payments/feature-ad","userId":"68384b9f2021db52ae7f4ab2"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:19.277Z","url":"/api/payments/feature-ad","userId":"68384b9f2021db52ae7f4ab2"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.288Z","url":"/api/payments/subscription-prices","userId":"68384b9f2021db52ae7f4ab2"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:57:19.318Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:19.349Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.353Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.370Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:19.373Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:19.374Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:19.375Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:19.863Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:57:19.863Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.863Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.863Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:19.863Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:19.863Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:19.863Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:19.863Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:20.268Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:20.289Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:20.290Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:20.292Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:20.294Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:20.298Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:57:20.299Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:20.303Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:57:20.304Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:57:20.412Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:57:20.417Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:57:25.965Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:57:26.063Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:57:26.102Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:57:27.117Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:28.121Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:57:28.122Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:57:28.125Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:57:28.131Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:57:28.137Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:57:29.184Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:30.202Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:57:30.203Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:33.294Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:37.309Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:49.789Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:49.801Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:49.803Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:49.804Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:49.811Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:49.813Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:57:49.814Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:49.815Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:57:49.816Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.099Z","url":"/api/payments/create-payment-intent","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.139Z","url":"/api/payments/create-payment-intent","userId":"68384bbe1844d663e190d0a5"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.143Z","url":"/api/payments/create-payment-intent","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.149Z","url":"/api/payments/create-subscription","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.153Z","url":"/api/payments/create-subscription","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.167Z","url":"/api/payments/cancel-subscription","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.175Z","url":"/api/payments/boost-ad","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.178Z","url":"/api/payments/boost-ad","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.186Z","url":"/api/payments/feature-ad","userId":"68384bbe1844d663e190d0a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:57:50.189Z","url":"/api/payments/feature-ad","userId":"68384bbe1844d663e190d0a5"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.197Z","url":"/api/payments/subscription-prices","userId":"68384bbe1844d663e190d0a5"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:50.153Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:57:50.153Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.153Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.153Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:50.153Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.153Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:50.153Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:50.153Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:57:50.175Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:57:50.221Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.226Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:57:50.228Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:50.232Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:50.233Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:57:50.239Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:57:50.511Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:57:50.516Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:57:55.410Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:57:55.567Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:57:55.609Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:57:56.628Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:57.686Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:57:57.687Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:57:57.706Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:57:57.727Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:57:57.765Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:57:58.777Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:57:59.781Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:57:59.781Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:02.865Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:06.885Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.497Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.505Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.510Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:20.512Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.514Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.515Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:58:20.516Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.518Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:58:20.519Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.531Z","url":"/api/payments/create-payment-intent","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.546Z","url":"/api/payments/create-payment-intent","userId":"68384bdc9f6f603febf906b4"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.551Z","url":"/api/payments/create-payment-intent","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.561Z","url":"/api/payments/create-subscription","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.572Z","url":"/api/payments/create-subscription","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.581Z","url":"/api/payments/cancel-subscription","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.592Z","url":"/api/payments/boost-ad","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.597Z","url":"/api/payments/boost-ad","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.608Z","url":"/api/payments/feature-ad","userId":"68384bdc9f6f603febf906b4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:20.616Z","url":"/api/payments/feature-ad","userId":"68384bdc9f6f603febf906b4"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.623Z","url":"/api/payments/subscription-prices","userId":"68384bdc9f6f603febf906b4"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:58:20.666Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.697Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.702Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.710Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:20.713Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:20.713Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:20.714Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.695Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:58:20.695Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.695Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.695Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.695Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:20.695Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.695Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:20.695Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:58:21.222Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:58:21.226Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:58:27.647Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:58:27.808Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:58:27.863Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:58:28.883Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:29.888Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:58:29.889Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:58:29.893Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:58:29.898Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:58:29.905Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:58:30.920Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:31.924Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:58:31.925Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:34.977Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:38.991Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:44.681Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:58:44.681Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:44.681Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:44.681Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:44.681Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:44.681Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:44.681Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:44.681Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.865Z","url":"/api/payments/create-payment-intent","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.898Z","url":"/api/payments/create-payment-intent","userId":"68384bf4142d840da852b0ca"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:44.903Z","url":"/api/payments/create-payment-intent","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.910Z","url":"/api/payments/create-subscription","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.913Z","url":"/api/payments/create-subscription","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.924Z","url":"/api/payments/cancel-subscription","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.936Z","url":"/api/payments/boost-ad","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.939Z","url":"/api/payments/boost-ad","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.943Z","url":"/api/payments/feature-ad","userId":"68384bf4142d840da852b0ca"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:58:44.946Z","url":"/api/payments/feature-ad","userId":"68384bf4142d840da852b0ca"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:44.952Z","url":"/api/payments/subscription-prices","userId":"68384bf4142d840da852b0ca"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:45.901Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:45.918Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:45.920Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:45.920Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:45.925Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:45.927Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:58:45.928Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:45.937Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:58:45.938Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:58:46.024Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:58:46.086Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:46.120Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:58:46.125Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:46.130Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:46.132Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:58:46.132Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:58:46.620Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:58:46.626Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:58:51.624Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:58:51.774Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:58:51.830Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:58:52.871Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:53.877Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:58:53.877Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:58:53.880Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:58:53.885Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:58:53.890Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:58:54.897Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:55.901Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:58:55.902Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:58:59.017Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:03.093Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:59:10.065Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:10.086Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:10.088Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:10.089Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:10.090Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:10.093Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:10.094Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:10.780Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:10.784Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:10.785Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:10.786Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:10.787Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:10.788Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:10.790Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:10.792Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:10.792Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:11.701Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:11.701Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:11.701Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:11.701Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:11.701Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:11.701Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:11.701Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:11.701Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:11.945Z","url":"/api/payments/create-payment-intent","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:11.958Z","url":"/api/payments/create-payment-intent","userId":"68384c0ffe70ba4043298815"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:11.962Z","url":"/api/payments/create-payment-intent","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:11.970Z","url":"/api/payments/create-subscription","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:11.980Z","url":"/api/payments/create-subscription","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:11.989Z","url":"/api/payments/cancel-subscription","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:11.998Z","url":"/api/payments/boost-ad","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:12.001Z","url":"/api/payments/boost-ad","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:12.008Z","url":"/api/payments/feature-ad","userId":"68384c0ffe70ba4043298815"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:12.017Z","url":"/api/payments/feature-ad","userId":"68384c0ffe70ba4043298815"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:12.023Z","url":"/api/payments/subscription-prices","userId":"68384c0ffe70ba4043298815"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:59:12.383Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:59:12.387Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:59:16.237Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:59:16.354Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:59:16.366Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:59:17.380Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:18.385Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:59:18.385Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:59:18.389Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:59:18.396Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:59:18.403Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:59:19.414Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:20.419Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:59:20.420Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:23.466Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:27.477Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.194Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:32.194Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.194Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.194Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.194Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.194Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.194Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.194Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.371Z","url":"/api/payments/create-payment-intent","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.382Z","url":"/api/payments/create-payment-intent","userId":"68384c24f93e789ec49b646d"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.385Z","url":"/api/payments/create-payment-intent","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.391Z","url":"/api/payments/create-subscription","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.395Z","url":"/api/payments/create-subscription","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.408Z","url":"/api/payments/cancel-subscription","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.415Z","url":"/api/payments/boost-ad","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.418Z","url":"/api/payments/boost-ad","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.426Z","url":"/api/payments/feature-ad","userId":"68384c24f93e789ec49b646d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:32.430Z","url":"/api/payments/feature-ad","userId":"68384c24f93e789ec49b646d"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.441Z","url":"/api/payments/subscription-prices","userId":"68384c24f93e789ec49b646d"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.669Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.676Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.679Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:32.682Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.685Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.686Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:32.687Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.688Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:32.689Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:59:32.820Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:32.850Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.853Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:32.854Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:32.856Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:32.861Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:32.862Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:59:32.926Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:59:32.931Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:59:39.133Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:59:39.189Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T11:59:39.217Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T11:59:40.254Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:41.263Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T11:59:41.264Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:59:41.273Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T11:59:41.286Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T11:59:41.298Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T11:59:42.330Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:43.335Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T11:59:43.335Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:46.666Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T11:59:50.701Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:58.880Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:58.888Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:58.907Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:58.909Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:58.911Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:58.912Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:58.913Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:58.917Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:58.918Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T11:59:58.988Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:59.023Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.027Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.036Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:59.040Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:59.042Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T11:59:59.042Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.171Z","url":"/api/payments/create-payment-intent","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.185Z","url":"/api/payments/create-payment-intent","userId":"68384c3ffc949d82e0795a82"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.188Z","url":"/api/payments/create-payment-intent","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.198Z","url":"/api/payments/create-subscription","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.202Z","url":"/api/payments/create-subscription","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.208Z","url":"/api/payments/cancel-subscription","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.217Z","url":"/api/payments/boost-ad","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.222Z","url":"/api/payments/boost-ad","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.226Z","url":"/api/payments/feature-ad","userId":"68384c3ffc949d82e0795a82"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T11:59:59.233Z","url":"/api/payments/feature-ad","userId":"68384c3ffc949d82e0795a82"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.241Z","url":"/api/payments/subscription-prices","userId":"68384c3ffc949d82e0795a82"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:59.232Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T11:59:59.232Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.232Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.232Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:59.232Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T11:59:59.232Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:59.232Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T11:59:59.232Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T11:59:59.492Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T11:59:59.496Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:06.004Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:06.189Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:06.249Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:00:07.332Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:08.342Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:00:08.343Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:00:08.349Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:00:08.367Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:00:08.383Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:00:09.397Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:10.402Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:00:10.403Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:13.466Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:17.481Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.670Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:00:23.670Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.670Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.670Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.670Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.670Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.670Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.670Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.712Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.723Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.724Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:23.726Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.732Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.734Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:00:23.735Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.737Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:00:23.738Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:23.958Z","url":"/api/payments/create-payment-intent","userId":"68384c5712b2c6359a4c345d"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:00:23.902Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:23.927Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.936Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.938Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:23.941Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:23.941Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:23.942Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:23.976Z","url":"/api/payments/create-payment-intent","userId":"68384c5712b2c6359a4c345d"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:23.981Z","url":"/api/payments/create-payment-intent","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:23.988Z","url":"/api/payments/create-subscription","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:23.991Z","url":"/api/payments/create-subscription","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:23.999Z","url":"/api/payments/cancel-subscription","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:24.012Z","url":"/api/payments/boost-ad","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:24.016Z","url":"/api/payments/boost-ad","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:24.023Z","url":"/api/payments/feature-ad","userId":"68384c5712b2c6359a4c345d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:24.026Z","url":"/api/payments/feature-ad","userId":"68384c5712b2c6359a4c345d"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:24.031Z","url":"/api/payments/subscription-prices","userId":"68384c5712b2c6359a4c345d"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:00:24.086Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:00:24.090Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:29.606Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:29.759Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:29.805Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:00:30.821Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:31.826Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:00:31.827Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:00:31.830Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:00:31.837Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:00:31.845Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:00:32.855Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:33.858Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:00:33.858Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:36.900Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:40.920Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.135Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:00:48.135Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.135Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.135Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.135Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.135Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.135Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.135Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.303Z","url":"/api/payments/create-payment-intent","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.326Z","url":"/api/payments/create-payment-intent","userId":"68384c704e2a5cb89652818c"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.329Z","url":"/api/payments/create-payment-intent","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.334Z","url":"/api/payments/create-subscription","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.336Z","url":"/api/payments/create-subscription","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.341Z","url":"/api/payments/cancel-subscription","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.346Z","url":"/api/payments/boost-ad","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.348Z","url":"/api/payments/boost-ad","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.354Z","url":"/api/payments/feature-ad","userId":"68384c704e2a5cb89652818c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:00:48.357Z","url":"/api/payments/feature-ad","userId":"68384c704e2a5cb89652818c"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.361Z","url":"/api/payments/subscription-prices","userId":"68384c704e2a5cb89652818c"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.363Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.368Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.370Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:48.371Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.373Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.374Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:00:48.375Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.376Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:00:48.377Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:00:48.524Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:00:48.548Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.551Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:00:48.557Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:48.560Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:48.561Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:00:48.562Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:00:48.784Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:00:48.788Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:53.206Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:53.386Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:00:53.442Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:00:54.456Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:55.459Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:00:55.460Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:00:55.464Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:00:55.471Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:00:55.476Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:00:56.484Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:00:57.487Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:00:57.487Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:00.533Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:04.546Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.158Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:09.158Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.158Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.158Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.158Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.158Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.158Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.158Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.367Z","url":"/api/payments/create-payment-intent","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.382Z","url":"/api/payments/create-payment-intent","userId":"68384c85901db57dec057e2d"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.385Z","url":"/api/payments/create-payment-intent","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.393Z","url":"/api/payments/create-subscription","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.395Z","url":"/api/payments/create-subscription","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.398Z","url":"/api/payments/cancel-subscription","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.404Z","url":"/api/payments/boost-ad","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.407Z","url":"/api/payments/boost-ad","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.416Z","url":"/api/payments/feature-ad","userId":"68384c85901db57dec057e2d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:09.419Z","url":"/api/payments/feature-ad","userId":"68384c85901db57dec057e2d"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.425Z","url":"/api/payments/subscription-prices","userId":"68384c85901db57dec057e2d"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.656Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.662Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.664Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:09.665Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.666Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.667Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:09.674Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.676Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:09.677Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:01:09.646Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:09.668Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.675Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:09.677Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:09.678Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:09.679Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:09.680Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:01:10.068Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:01:10.078Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:14.341Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:14.458Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:14.471Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:01:15.483Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:16.487Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:01:16.487Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:01:16.490Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:01:16.495Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:01:16.502Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:01:17.511Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:18.514Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:01:18.514Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:21.556Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:25.583Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:30.987Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:30.993Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:30.994Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:30.999Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:31.001Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:31.002Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:31.003Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:31.004Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:31.005Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:30.968Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:30.968Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:30.968Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:30.968Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:30.968Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:30.968Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:30.968Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:30.968Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.187Z","url":"/api/payments/create-payment-intent","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.211Z","url":"/api/payments/create-payment-intent","userId":"68384c9b7255b590432f6760"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:31.214Z","url":"/api/payments/create-payment-intent","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.218Z","url":"/api/payments/create-subscription","userId":"68384c9b7255b590432f6760"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:01:31.166Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:31.189Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:31.194Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:31.196Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:31.197Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:31.198Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:31.199Z"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.220Z","url":"/api/payments/create-subscription","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.227Z","url":"/api/payments/cancel-subscription","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.234Z","url":"/api/payments/boost-ad","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.236Z","url":"/api/payments/boost-ad","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.246Z","url":"/api/payments/feature-ad","userId":"68384c9b7255b590432f6760"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:31.249Z","url":"/api/payments/feature-ad","userId":"68384c9b7255b590432f6760"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:31.255Z","url":"/api/payments/subscription-prices","userId":"68384c9b7255b590432f6760"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:01:31.640Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:01:31.644Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:35.736Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:35.868Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:35.902Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:01:36.925Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:37.931Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:01:37.932Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:01:37.934Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:01:37.939Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:01:37.944Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:01:38.958Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:39.969Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:01:39.969Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:43.012Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:01:47.103Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.915Z","url":"/api/payments/create-payment-intent","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.950Z","url":"/api/payments/create-payment-intent","userId":"68384cb07a64d0b0bf431f49"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:52.954Z","url":"/api/payments/create-payment-intent","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.960Z","url":"/api/payments/create-subscription","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.964Z","url":"/api/payments/create-subscription","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.970Z","url":"/api/payments/cancel-subscription","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.980Z","url":"/api/payments/boost-ad","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.983Z","url":"/api/payments/boost-ad","userId":"68384cb07a64d0b0bf431f49"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.992Z","url":"/api/payments/feature-ad","userId":"68384cb07a64d0b0bf431f49"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:52.934Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:52.934Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:52.934Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:52.934Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:52.934Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:52.934Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:52.934Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:52.934Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:01:52.998Z","url":"/api/payments/feature-ad","userId":"68384cb07a64d0b0bf431f49"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:53.003Z","url":"/api/payments/subscription-prices","userId":"68384cb07a64d0b0bf431f49"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:01:53.126Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:53.156Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:53.160Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:53.161Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:53.164Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:53.164Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:53.165Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:53.233Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:53.240Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:53.263Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:01:53.264Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:01:53.266Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:53.269Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:53.270Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:01:53.272Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:01:53.272Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:01:53.328Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:01:53.339Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:57.816Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:57.995Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:01:58.048Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:01:59.064Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:00.071Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:02:00.072Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:02:00.089Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:02:00.102Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:02:00.116Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:02:01.148Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:02.154Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:02:02.154Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:05.203Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:09.216Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.551Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:02:14.551Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.551Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.551Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.551Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.551Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.551Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.551Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.703Z","url":"/api/payments/create-payment-intent","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.720Z","url":"/api/payments/create-payment-intent","userId":"68384cc6451cdbac839e2ca6"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.725Z","url":"/api/payments/create-payment-intent","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.729Z","url":"/api/payments/create-subscription","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.732Z","url":"/api/payments/create-subscription","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.735Z","url":"/api/payments/cancel-subscription","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.740Z","url":"/api/payments/boost-ad","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.745Z","url":"/api/payments/boost-ad","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.749Z","url":"/api/payments/feature-ad","userId":"68384cc6451cdbac839e2ca6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:14.751Z","url":"/api/payments/feature-ad","userId":"68384cc6451cdbac839e2ca6"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.755Z","url":"/api/payments/subscription-prices","userId":"68384cc6451cdbac839e2ca6"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.779Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.785Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.786Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:14.787Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:14.792Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.793Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:02:14.794Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:14.795Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:02:14.795Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:02:15.103Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:15.158Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:15.168Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:15.170Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:15.172Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:15.173Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:15.175Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:02:15.303Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:02:15.306Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:02:19.767Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:02:19.906Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:02:19.964Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:02:20.977Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:21.980Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:02:21.981Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:02:21.984Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:02:21.990Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:02:21.994Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:02:23.013Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:24.022Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:02:24.022Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:27.061Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:31.073Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:35.832Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:02:35.832Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:35.832Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:35.832Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:35.832Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:35.832Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:35.832Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:35.832Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.003Z","url":"/api/payments/create-payment-intent","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.023Z","url":"/api/payments/create-payment-intent","userId":"68384cdbbcdcf56713823907"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:36.027Z","url":"/api/payments/create-payment-intent","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.035Z","url":"/api/payments/create-subscription","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.039Z","url":"/api/payments/create-subscription","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.045Z","url":"/api/payments/cancel-subscription","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.065Z","url":"/api/payments/boost-ad","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.068Z","url":"/api/payments/boost-ad","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.075Z","url":"/api/payments/feature-ad","userId":"68384cdbbcdcf56713823907"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:02:36.081Z","url":"/api/payments/feature-ad","userId":"68384cdbbcdcf56713823907"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:36.090Z","url":"/api/payments/subscription-prices","userId":"68384cdbbcdcf56713823907"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:02:36.263Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:36.302Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:36.305Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:36.306Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:36.309Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:36.311Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:36.317Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:36.481Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:36.488Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:36.491Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:02:36.493Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:02:36.496Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:36.498Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:02:36.498Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:02:36.500Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:02:36.502Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:02:36.905Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:02:36.911Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:02:41.634Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:02:41.772Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:02:41.829Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:02:42.843Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:43.847Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:02:43.848Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:02:43.854Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:02:43.859Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:02:43.864Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:02:44.873Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:45.886Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:02:45.887Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:49.371Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:02:53.410Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.564Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.571Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.573Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:02.574Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.575Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.576Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:02.577Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.578Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:02.579Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.839Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:02.839Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.839Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.839Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.839Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.839Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.839Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.839Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:03:02.918Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:02.945Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.952Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:02.954Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:02.956Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:02.956Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:02.957Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.102Z","url":"/api/payments/create-payment-intent","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.124Z","url":"/api/payments/create-payment-intent","userId":"68384cf7d6480900a6a43a5d"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:03.137Z","url":"/api/payments/create-payment-intent","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.168Z","url":"/api/payments/create-subscription","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.175Z","url":"/api/payments/create-subscription","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.193Z","url":"/api/payments/cancel-subscription","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.209Z","url":"/api/payments/boost-ad","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.223Z","url":"/api/payments/boost-ad","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.232Z","url":"/api/payments/feature-ad","userId":"68384cf7d6480900a6a43a5d"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:03.237Z","url":"/api/payments/feature-ad","userId":"68384cf7d6480900a6a43a5d"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:03.244Z","url":"/api/payments/subscription-prices","userId":"68384cf7d6480900a6a43a5d"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:03:03.656Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:03:03.663Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:03:08.249Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:03:08.406Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:03:08.458Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:03:09.475Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:10.480Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:03:10.481Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:03:10.487Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:03:10.497Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:03:10.516Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:03:11.547Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:12.555Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:03:12.555Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:15.698Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:19.710Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:26.604Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:26.604Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:26.604Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:26.604Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:26.604Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:26.604Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:26.604Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:26.604Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:26.940Z","url":"/api/payments/create-payment-intent","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.017Z","url":"/api/payments/create-payment-intent","userId":"68384d0e158327cca7411433"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:27.028Z","url":"/api/payments/create-payment-intent","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.058Z","url":"/api/payments/create-subscription","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.077Z","url":"/api/payments/create-subscription","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.092Z","url":"/api/payments/cancel-subscription","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.117Z","url":"/api/payments/boost-ad","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.125Z","url":"/api/payments/boost-ad","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.139Z","url":"/api/payments/feature-ad","userId":"68384d0e158327cca7411433"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:27.143Z","url":"/api/payments/feature-ad","userId":"68384d0e158327cca7411433"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:27.154Z","url":"/api/payments/subscription-prices","userId":"68384d0e158327cca7411433"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:03:28.326Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:03:28.341Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:29.060Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:29.098Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:29.100Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:29.101Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:29.160Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:29.162Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:29.163Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:29.170Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:29.174Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:03:28.848Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:29.032Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:29.043Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:29.065Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:29.088Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:29.132Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:29.171Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:03:35.830Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:03:35.988Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:03:36.046Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:03:37.140Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:38.153Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:03:38.154Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:03:38.161Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:03:38.184Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:03:38.201Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:03:39.216Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:40.225Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:03:40.225Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:43.411Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:03:47.500Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:03:57.643Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:57.659Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:57.660Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:57.664Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:57.665Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:57.666Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:57.666Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.329Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.333Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.334Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:03:58.334Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.335Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.336Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:58.336Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.337Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:58.337Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.596Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:03:58.596Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.596Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.596Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.596Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.596Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.596Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:03:58.596Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.824Z","url":"/api/payments/create-payment-intent","userId":"68384d2e470e646099e6cad8"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:03:58.867Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.886Z","url":"/api/payments/create-payment-intent","userId":"68384d2e470e646099e6cad8"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.888Z","url":"/api/payments/create-payment-intent","userId":"68384d2e470e646099e6cad8"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.891Z","url":"/api/payments/create-subscription","userId":"68384d2e470e646099e6cad8"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.896Z","url":"/api/payments/create-subscription","userId":"68384d2e470e646099e6cad8"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.899Z","url":"/api/payments/cancel-subscription","userId":"68384d2e470e646099e6cad8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.903Z","url":"/api/payments/boost-ad","userId":"68384d2e470e646099e6cad8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.904Z","url":"/api/payments/boost-ad","userId":"68384d2e470e646099e6cad8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.907Z","url":"/api/payments/feature-ad","userId":"68384d2e470e646099e6cad8"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:03:58.871Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:03:58.910Z","url":"/api/payments/feature-ad","userId":"68384d2e470e646099e6cad8"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:03:58.914Z","url":"/api/payments/subscription-prices","userId":"68384d2e470e646099e6cad8"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:04:04.295Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:04:04.454Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:04:04.503Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:04:05.538Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:06.555Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:04:06.557Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:04:06.573Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:04:06.597Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:04:06.610Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:04:07.625Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:08.627Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:04:08.628Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:11.691Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:15.715Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.155Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.173Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.175Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:23.177Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.180Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.188Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:04:23.197Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.202Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:04:23.219Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.781Z","url":"/api/payments/create-payment-intent","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.806Z","url":"/api/payments/create-payment-intent","userId":"68384d47910bcd245e88b938"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.815Z","url":"/api/payments/create-payment-intent","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.827Z","url":"/api/payments/create-subscription","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.833Z","url":"/api/payments/create-subscription","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.845Z","url":"/api/payments/cancel-subscription","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.873Z","url":"/api/payments/boost-ad","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.877Z","url":"/api/payments/boost-ad","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.891Z","url":"/api/payments/feature-ad","userId":"68384d47910bcd245e88b938"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:23.896Z","url":"/api/payments/feature-ad","userId":"68384d47910bcd245e88b938"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.910Z","url":"/api/payments/subscription-prices","userId":"68384d47910bcd245e88b938"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.900Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:04:23.900Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.900Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.900Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.900Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:23.900Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.900Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:23.900Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:04:24.419Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:24.464Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:24.471Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:24.475Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:24.485Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:24.488Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:24.491Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:04:25.252Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:04:25.261Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:04:31.222Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:04:31.369Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:04:31.429Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:04:32.445Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:33.448Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:04:33.449Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:04:33.453Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:04:33.458Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:04:33.464Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:04:34.506Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:35.519Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:04:35.519Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:38.625Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:04:42.648Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:52.561Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:04:52.561Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.561Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.561Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:52.561Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.561Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:52.561Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:52.561Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.747Z","url":"/api/payments/create-payment-intent","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.760Z","url":"/api/payments/create-payment-intent","userId":"68384d641a3f20cbccad0ce8"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.763Z","url":"/api/payments/create-payment-intent","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.770Z","url":"/api/payments/create-subscription","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.776Z","url":"/api/payments/create-subscription","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.783Z","url":"/api/payments/cancel-subscription","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.791Z","url":"/api/payments/boost-ad","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.794Z","url":"/api/payments/boost-ad","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.800Z","url":"/api/payments/feature-ad","userId":"68384d641a3f20cbccad0ce8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:04:52.804Z","url":"/api/payments/feature-ad","userId":"68384d641a3f20cbccad0ce8"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.814Z","url":"/api/payments/subscription-prices","userId":"68384d641a3f20cbccad0ce8"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:04:52.963Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:52.993Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.998Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:52.999Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:53.002Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:53.003Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:53.005Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:53.069Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:53.076Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:53.077Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:04:53.078Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:04:53.079Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:53.080Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:04:53.081Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:04:53.082Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:04:53.083Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:04:53.298Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:04:53.305Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:01.126Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:01.179Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:01.201Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:05:02.229Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:03.233Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:05:03.233Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:05:03.237Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:05:03.247Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:05:03.256Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:05:04.268Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:05.274Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:05:05.275Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:08.454Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:12.473Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.099Z","url":"/api/payments/create-payment-intent","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.117Z","url":"/api/payments/create-payment-intent","userId":"68384d83c8df38de1df7269b"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.121Z","url":"/api/payments/create-payment-intent","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.128Z","url":"/api/payments/create-subscription","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.132Z","url":"/api/payments/create-subscription","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.139Z","url":"/api/payments/cancel-subscription","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.150Z","url":"/api/payments/boost-ad","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.154Z","url":"/api/payments/boost-ad","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.162Z","url":"/api/payments/feature-ad","userId":"68384d83c8df38de1df7269b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:23.166Z","url":"/api/payments/feature-ad","userId":"68384d83c8df38de1df7269b"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.172Z","url":"/api/payments/subscription-prices","userId":"68384d83c8df38de1df7269b"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.214Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:05:23.214Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.214Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.214Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.214Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.214Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.214Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.214Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:05:23.292Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:05:23.295Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:05:23.231Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.258Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.262Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.265Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:23.269Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:23.271Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:23.271Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.417Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.426Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.428Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:23.429Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:23.431Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.434Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:05:23.435Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:23.437Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:05:23.438Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:28.606Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:28.756Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:28.814Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:05:29.828Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:30.832Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:05:30.834Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:05:30.839Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:05:30.848Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:05:30.859Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:05:31.872Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:32.876Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:05:32.876Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:35.964Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:39.982Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.042Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.048Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.050Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:50.051Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.053Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.054Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:05:50.055Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.056Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:05:50.057Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.023Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:05:50.023Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.023Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.023Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.023Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.023Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.023Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.023Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.702Z","url":"/api/payments/create-payment-intent","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.732Z","url":"/api/payments/create-payment-intent","userId":"68384d9ee4444334f50972f5"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.738Z","url":"/api/payments/create-payment-intent","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.756Z","url":"/api/payments/create-subscription","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.763Z","url":"/api/payments/create-subscription","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.776Z","url":"/api/payments/cancel-subscription","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.795Z","url":"/api/payments/boost-ad","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.804Z","url":"/api/payments/boost-ad","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.814Z","url":"/api/payments/feature-ad","userId":"68384d9ee4444334f50972f5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:05:50.819Z","url":"/api/payments/feature-ad","userId":"68384d9ee4444334f50972f5"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.827Z","url":"/api/payments/subscription-prices","userId":"68384d9ee4444334f50972f5"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:05:50.876Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:05:50.908Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.926Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:05:50.930Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:50.959Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:50.965Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:05:50.968Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:05:51.918Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:05:51.925Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:56.334Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:56.480Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:05:56.545Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:05:57.560Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:05:58.567Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:05:58.568Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:05:58.575Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:05:58.587Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:05:58.597Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:05:59.607Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:00.610Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:06:00.611Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:03.657Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:07.671Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.615Z","url":"/api/payments/create-payment-intent","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.626Z","url":"/api/payments/create-payment-intent","userId":"68384db46b49481ca77191db"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:12.628Z","url":"/api/payments/create-payment-intent","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.635Z","url":"/api/payments/create-subscription","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.638Z","url":"/api/payments/create-subscription","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.643Z","url":"/api/payments/cancel-subscription","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.648Z","url":"/api/payments/boost-ad","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.650Z","url":"/api/payments/boost-ad","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.654Z","url":"/api/payments/feature-ad","userId":"68384db46b49481ca77191db"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:12.659Z","url":"/api/payments/feature-ad","userId":"68384db46b49481ca77191db"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:12.663Z","url":"/api/payments/subscription-prices","userId":"68384db46b49481ca77191db"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:06:13.207Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:13.238Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:13.242Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:13.246Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:13.248Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:13.249Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:13.250Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:13.732Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:06:13.732Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:13.732Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:13.732Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:13.732Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:13.732Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:13.732Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:13.732Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:14.210Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:14.229Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:14.232Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:14.235Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:14.238Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:14.241Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:06:14.243Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:14.247Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:06:14.249Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:06:14.500Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:06:14.507Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:06:23.570Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:06:23.725Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:06:23.767Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:06:24.802Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:25.807Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:06:25.807Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:06:25.811Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:06:25.816Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:06:25.822Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:06:26.841Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:27.846Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:06:27.846Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:30.893Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:34.911Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:40.524Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.531Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.533Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:40.534Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:40.535Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.537Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:06:40.537Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.538Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:06:40.539Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.709Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:06:40.709Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:40.709Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:40.709Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.709Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:40.709Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.709Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:40.709Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:06:41.034Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:06:41.056Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:41.063Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:41.065Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:41.067Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:41.068Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:06:41.068Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:06:41.101Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:06:41.105Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.392Z","url":"/api/payments/create-payment-intent","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.405Z","url":"/api/payments/create-payment-intent","userId":"68384dd1309ebb0b530cef6a"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:41.411Z","url":"/api/payments/create-payment-intent","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.423Z","url":"/api/payments/create-subscription","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.427Z","url":"/api/payments/create-subscription","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.435Z","url":"/api/payments/cancel-subscription","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.445Z","url":"/api/payments/boost-ad","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.449Z","url":"/api/payments/boost-ad","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.473Z","url":"/api/payments/feature-ad","userId":"68384dd1309ebb0b530cef6a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:06:41.480Z","url":"/api/payments/feature-ad","userId":"68384dd1309ebb0b530cef6a"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:06:41.495Z","url":"/api/payments/subscription-prices","userId":"68384dd1309ebb0b530cef6a"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:06:49.549Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:06:49.615Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:06:49.669Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:06:50.686Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:51.689Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:06:51.690Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:06:51.694Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:06:51.702Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:06:51.710Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:06:52.720Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:53.724Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:06:53.725Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:06:56.814Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:00.828Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:06.860Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:06.860Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:06.860Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:06.860Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:06.860Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:06.860Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:06.860Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:06.860Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.026Z","url":"/api/payments/create-payment-intent","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.040Z","url":"/api/payments/create-payment-intent","userId":"68384debf9586fc4415667eb"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:07.042Z","url":"/api/payments/create-payment-intent","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.045Z","url":"/api/payments/create-subscription","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.047Z","url":"/api/payments/create-subscription","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.050Z","url":"/api/payments/cancel-subscription","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.059Z","url":"/api/payments/boost-ad","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.061Z","url":"/api/payments/boost-ad","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.064Z","url":"/api/payments/feature-ad","userId":"68384debf9586fc4415667eb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:07.066Z","url":"/api/payments/feature-ad","userId":"68384debf9586fc4415667eb"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:07.069Z","url":"/api/payments/subscription-prices","userId":"68384debf9586fc4415667eb"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:07.376Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:07.381Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:07.382Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:07.383Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:07.385Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:07.386Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:07.387Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:07.392Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:07.393Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:07:07.420Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:07.473Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:07.479Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:07.482Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:07.489Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:07.492Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:07.493Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:07:07.945Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:07:07.949Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:11.719Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:11.880Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:11.930Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:07:12.944Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:13.947Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:07:13.948Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:07:13.950Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:07:13.955Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:07:13.960Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:07:14.970Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:15.973Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:07:15.973Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:19.012Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:23.026Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.075Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:28.075Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.075Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.075Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.075Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.075Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.075Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.075Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:07:28.261Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.289Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.294Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.296Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:28.297Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:28.298Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:28.299Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:07:28.396Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:07:28.398Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.599Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.613Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.618Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:28.622Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:28.624Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.625Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:28.626Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:28.629Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:28.631Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.139Z","url":"/api/payments/create-payment-intent","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.162Z","url":"/api/payments/create-payment-intent","userId":"68384e00ee4d9a34780b03a5"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:29.179Z","url":"/api/payments/create-payment-intent","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.189Z","url":"/api/payments/create-subscription","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.195Z","url":"/api/payments/create-subscription","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.251Z","url":"/api/payments/cancel-subscription","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.274Z","url":"/api/payments/boost-ad","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.283Z","url":"/api/payments/boost-ad","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.301Z","url":"/api/payments/feature-ad","userId":"68384e00ee4d9a34780b03a5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:29.314Z","url":"/api/payments/feature-ad","userId":"68384e00ee4d9a34780b03a5"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:29.343Z","url":"/api/payments/subscription-prices","userId":"68384e00ee4d9a34780b03a5"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:34.386Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:34.564Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:34.625Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:07:35.640Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:36.644Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:07:36.644Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:07:36.648Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:07:36.655Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:07:36.664Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:07:37.690Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:38.702Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:07:38.702Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:41.755Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:45.766Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.414Z","url":"/api/payments/create-payment-intent","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.430Z","url":"/api/payments/create-payment-intent","userId":"68384e175aa22462f2f4ec85"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:51.436Z","url":"/api/payments/create-payment-intent","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.444Z","url":"/api/payments/create-subscription","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.449Z","url":"/api/payments/create-subscription","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.453Z","url":"/api/payments/cancel-subscription","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.463Z","url":"/api/payments/boost-ad","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.468Z","url":"/api/payments/boost-ad","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.474Z","url":"/api/payments/feature-ad","userId":"68384e175aa22462f2f4ec85"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:07:51.478Z","url":"/api/payments/feature-ad","userId":"68384e175aa22462f2f4ec85"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:51.485Z","url":"/api/payments/subscription-prices","userId":"68384e175aa22462f2f4ec85"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:51.885Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:51.885Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:51.885Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:51.885Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:51.885Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:51.885Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:51.885Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:51.885Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:52.435Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:52.443Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:52.449Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:52.449Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:52.451Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:52.452Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:52.453Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:52.454Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:07:52.455Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:07:52.631Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:07:52.664Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:52.667Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:07:52.671Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:52.674Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:52.675Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:07:52.676Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:07:52.710Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:07:52.715Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:56.568Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:56.729Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:07:56.798Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:07:57.815Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:07:58.820Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:07:58.821Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:07:58.825Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:07:58.833Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:07:58.840Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:08:00.100Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:01.125Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:08:01.128Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:04.227Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:08.261Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.415Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:15.415Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.415Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.415Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.415Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.415Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.415Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.415Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.462Z","url":"/api/payments/create-payment-intent","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.475Z","url":"/api/payments/create-payment-intent","userId":"68384e2f1a074a971a032d84"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.479Z","url":"/api/payments/create-payment-intent","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.486Z","url":"/api/payments/create-subscription","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.495Z","url":"/api/payments/create-subscription","userId":"68384e2f1a074a971a032d84"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:08:15.443Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.467Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.471Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.472Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:15.477Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:15.478Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:15.479Z"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.500Z","url":"/api/payments/cancel-subscription","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.508Z","url":"/api/payments/boost-ad","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.511Z","url":"/api/payments/boost-ad","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.518Z","url":"/api/payments/feature-ad","userId":"68384e2f1a074a971a032d84"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:15.524Z","url":"/api/payments/feature-ad","userId":"68384e2f1a074a971a032d84"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.531Z","url":"/api/payments/subscription-prices","userId":"68384e2f1a074a971a032d84"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.572Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.580Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.581Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:15.582Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:15.584Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.585Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:15.591Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:15.594Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:15.595Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:08:15.972Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:08:15.976Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:08:20.357Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:08:20.499Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:08:20.563Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:08:21.582Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:22.587Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:08:22.588Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:08:22.590Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:08:22.594Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:08:22.599Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:08:23.627Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:24.634Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:08:24.635Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:27.675Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:31.688Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.751Z","url":"/api/payments/create-payment-intent","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.766Z","url":"/api/payments/create-payment-intent","userId":"68384e44797b736e25ed2a52"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.771Z","url":"/api/payments/create-payment-intent","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.784Z","url":"/api/payments/create-subscription","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.793Z","url":"/api/payments/create-subscription","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.807Z","url":"/api/payments/cancel-subscription","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.844Z","url":"/api/payments/boost-ad","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.850Z","url":"/api/payments/boost-ad","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.860Z","url":"/api/payments/feature-ad","userId":"68384e44797b736e25ed2a52"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:36.865Z","url":"/api/payments/feature-ad","userId":"68384e44797b736e25ed2a52"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.874Z","url":"/api/payments/subscription-prices","userId":"68384e44797b736e25ed2a52"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.858Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:36.858Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.858Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.858Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.858Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.858Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.858Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.858Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.957Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.970Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.971Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:36.973Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:36.977Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.979Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:36.980Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:36.982Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:36.983Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:08:37.086Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:37.111Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:37.115Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:37.116Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:37.118Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:37.119Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:37.123Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:08:37.315Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:08:37.319Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:08:41.815Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:08:41.982Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:08:42.047Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:08:43.065Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:44.071Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:08:44.072Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:08:44.075Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:08:44.081Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:08:44.086Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:08:45.110Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:46.115Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:08:46.115Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:49.168Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:08:53.188Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.012Z","url":"/api/payments/create-payment-intent","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.022Z","url":"/api/payments/create-payment-intent","userId":"68384e5ae625e4df7dff0fa6"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.025Z","url":"/api/payments/create-payment-intent","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.032Z","url":"/api/payments/create-subscription","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.035Z","url":"/api/payments/create-subscription","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.039Z","url":"/api/payments/cancel-subscription","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.045Z","url":"/api/payments/boost-ad","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.047Z","url":"/api/payments/boost-ad","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.054Z","url":"/api/payments/feature-ad","userId":"68384e5ae625e4df7dff0fa6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:08:59.057Z","url":"/api/payments/feature-ad","userId":"68384e5ae625e4df7dff0fa6"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.064Z","url":"/api/payments/subscription-prices","userId":"68384e5ae625e4df7dff0fa6"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.103Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:59.103Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.103Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.103Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.103Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.103Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.103Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.103Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.234Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.240Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.241Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:59.242Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.244Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.245Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:59.246Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.247Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:08:59.248Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:08:59.262Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:08:59.284Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.287Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:08:59.288Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:59.290Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:59.290Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:08:59.295Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:08:59.666Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:08:59.670Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:04.739Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:04.908Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:04.957Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:09:05.970Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:06.974Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:09:06.975Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:09:06.981Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:09:06.990Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:09:06.999Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:09:08.070Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:09.077Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:09:09.078Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:12.264Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:16.400Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.555Z","url":"/api/payments/create-payment-intent","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.574Z","url":"/api/payments/create-payment-intent","userId":"68384e7605ae702430cc5afb"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.579Z","url":"/api/payments/create-payment-intent","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.591Z","url":"/api/payments/create-subscription","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.613Z","url":"/api/payments/create-subscription","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.626Z","url":"/api/payments/cancel-subscription","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.646Z","url":"/api/payments/boost-ad","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.651Z","url":"/api/payments/boost-ad","userId":"68384e7605ae702430cc5afb"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.593Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:09:26.593Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.593Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.593Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.593Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.593Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.593Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.593Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.662Z","url":"/api/payments/feature-ad","userId":"68384e7605ae702430cc5afb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:26.670Z","url":"/api/payments/feature-ad","userId":"68384e7605ae702430cc5afb"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.679Z","url":"/api/payments/subscription-prices","userId":"68384e7605ae702430cc5afb"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.800Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.809Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.811Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:26.812Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.822Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.824Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:09:26.826Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.827Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:09:26.828Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:09:26.807Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:26.882Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.895Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:26.897Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:26.900Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:26.903Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:26.905Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:09:27.655Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:09:27.662Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:31.849Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:31.992Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:32.041Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:09:33.055Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:34.059Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:09:34.060Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:09:34.062Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:09:34.067Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:09:34.071Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:09:35.082Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:36.087Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:09:36.087Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:39.134Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:43.147Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:48.909Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:09:48.909Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:48.909Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:48.909Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:48.909Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:48.909Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:48.909Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:48.909Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.097Z","url":"/api/payments/create-payment-intent","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.112Z","url":"/api/payments/create-payment-intent","userId":"68384e8da30613cecc3625c6"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:49.121Z","url":"/api/payments/create-payment-intent","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.126Z","url":"/api/payments/create-subscription","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.129Z","url":"/api/payments/create-subscription","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.133Z","url":"/api/payments/cancel-subscription","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.145Z","url":"/api/payments/boost-ad","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.148Z","url":"/api/payments/boost-ad","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.154Z","url":"/api/payments/feature-ad","userId":"68384e8da30613cecc3625c6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:09:49.159Z","url":"/api/payments/feature-ad","userId":"68384e8da30613cecc3625c6"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:49.166Z","url":"/api/payments/subscription-prices","userId":"68384e8da30613cecc3625c6"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:49.412Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:49.417Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:49.420Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:49.421Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:49.422Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:49.424Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:09:49.425Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:49.426Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:09:49.430Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:09:49.427Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:09:49.458Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:49.463Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:09:49.466Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:49.475Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:49.476Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:09:49.477Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:09:49.527Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:09:49.531Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:54.697Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:54.835Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:09:54.876Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:09:55.891Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:56.895Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:09:56.896Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:09:56.898Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:09:56.902Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:09:56.906Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:09:57.919Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:09:58.923Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:09:58.923Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:10:01.976Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:10:06.562Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.903Z","url":"/api/payments/create-payment-intent","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.921Z","url":"/api/payments/create-payment-intent","userId":"68384eaf4d1a88493c742e9b"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:23.925Z","url":"/api/payments/create-payment-intent","userId":"68384eaf4d1a88493c742e9b"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:23.883Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:10:23.883Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:23.883Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:23.883Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:23.883Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:23.883Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:23.883Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:23.883Z"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.938Z","url":"/api/payments/create-subscription","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.942Z","url":"/api/payments/create-subscription","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.950Z","url":"/api/payments/cancel-subscription","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.960Z","url":"/api/payments/boost-ad","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.964Z","url":"/api/payments/boost-ad","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.976Z","url":"/api/payments/feature-ad","userId":"68384eaf4d1a88493c742e9b"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:23.979Z","url":"/api/payments/feature-ad","userId":"68384eaf4d1a88493c742e9b"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:23.985Z","url":"/api/payments/subscription-prices","userId":"68384eaf4d1a88493c742e9b"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:10:25.211Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:25.250Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:25.260Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:25.262Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:25.265Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:25.266Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:25.267Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:25.786Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:25.794Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:25.795Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:25.797Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:25.799Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:25.803Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:10:25.804Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:25.806Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:10:25.808Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:10:26.454Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:10:26.462Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:10:33.126Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:10:33.679Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:10:33.832Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:10:34.843Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:10:35.847Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:10:35.847Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:10:35.850Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:10:35.854Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:10:35.857Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:10:36.898Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:10:37.903Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:10:37.904Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:10:41.031Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:10:45.049Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:10:52.927Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:52.956Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:52.965Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:52.968Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:52.973Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:52.974Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:52.980Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.267Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.277Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.280Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:10:53.285Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.287Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.290Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:10:53.291Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.293Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:10:53.294Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.491Z","url":"/api/payments/create-payment-intent","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.506Z","url":"/api/payments/create-payment-intent","userId":"68384ecdffccb98808ea81c8"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.511Z","url":"/api/payments/create-payment-intent","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.523Z","url":"/api/payments/create-subscription","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.527Z","url":"/api/payments/create-subscription","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.536Z","url":"/api/payments/cancel-subscription","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.549Z","url":"/api/payments/boost-ad","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.553Z","url":"/api/payments/boost-ad","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.564Z","url":"/api/payments/feature-ad","userId":"68384ecdffccb98808ea81c8"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:10:53.568Z","url":"/api/payments/feature-ad","userId":"68384ecdffccb98808ea81c8"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.576Z","url":"/api/payments/subscription-prices","userId":"68384ecdffccb98808ea81c8"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.554Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:10:53.554Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.554Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.554Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.554Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:10:53.554Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.554Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:10:53.554Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:10:53.858Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:10:53.866Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:10:58.434Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:10:58.567Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:10:58.617Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:10:59.631Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:00.635Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:11:00.636Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:11:00.638Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:11:00.643Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:11:00.648Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:11:01.766Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:02.782Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:11:02.782Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:05.837Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:09.854Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.340Z","url":"/api/payments/create-payment-intent","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.353Z","url":"/api/payments/create-payment-intent","userId":"68384ee441cd7f380b72618c"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.356Z","url":"/api/payments/create-payment-intent","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.361Z","url":"/api/payments/create-subscription","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.366Z","url":"/api/payments/create-subscription","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.370Z","url":"/api/payments/cancel-subscription","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.378Z","url":"/api/payments/boost-ad","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.380Z","url":"/api/payments/boost-ad","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.385Z","url":"/api/payments/feature-ad","userId":"68384ee441cd7f380b72618c"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:16.391Z","url":"/api/payments/feature-ad","userId":"68384ee441cd7f380b72618c"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.396Z","url":"/api/payments/subscription-prices","userId":"68384ee441cd7f380b72618c"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.494Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:16.494Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.494Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.494Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.494Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.494Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.494Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.494Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.759Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.764Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.765Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:16.766Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.767Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.769Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:16.770Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.771Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:16.772Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:11:16.827Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:16.857Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.866Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:16.867Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:16.869Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:16.870Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:16.871Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:11:17.420Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:11:17.424Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:11:21.884Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:11:22.049Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:11:22.113Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:11:23.126Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:24.129Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:11:24.129Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:11:24.132Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:11:24.136Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:11:24.140Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:11:25.149Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:26.153Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:11:26.153Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:29.196Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:33.207Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:37.974Z","url":"/api/payments/create-payment-intent","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:37.987Z","url":"/api/payments/create-payment-intent","userId":"68384ef985665783ec83cf2a"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:37.990Z","url":"/api/payments/create-payment-intent","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:37.994Z","url":"/api/payments/create-subscription","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:38.001Z","url":"/api/payments/create-subscription","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:38.007Z","url":"/api/payments/cancel-subscription","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:38.013Z","url":"/api/payments/boost-ad","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:38.015Z","url":"/api/payments/boost-ad","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:38.021Z","url":"/api/payments/feature-ad","userId":"68384ef985665783ec83cf2a"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:38.030Z","url":"/api/payments/feature-ad","userId":"68384ef985665783ec83cf2a"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.036Z","url":"/api/payments/subscription-prices","userId":"68384ef985665783ec83cf2a"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.036Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:38.036Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.036Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.036Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.036Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.036Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.036Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.036Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:11:38.218Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.245Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.252Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.254Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:38.256Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:38.257Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:38.259Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.287Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.295Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.297Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:38.298Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:38.299Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.303Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:38.310Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:38.311Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:38.313Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:11:38.478Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:11:38.484Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:11:42.841Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:11:43.023Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:11:43.067Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:11:44.082Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:45.085Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:11:45.086Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:11:45.089Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:11:45.093Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:11:45.098Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:11:46.108Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:47.112Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:11:47.113Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:50.194Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:11:54.207Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.849Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:58.849Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:58.849Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:58.849Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.849Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:58.849Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.849Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.849Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:58.871Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.877Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.878Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:58.880Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:58.882Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.883Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:58.884Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:58.886Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:11:58.887Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.049Z","url":"/api/payments/create-payment-intent","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.060Z","url":"/api/payments/create-payment-intent","userId":"68384f0f1325b15c65d86a16"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:59.063Z","url":"/api/payments/create-payment-intent","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.074Z","url":"/api/payments/create-subscription","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.077Z","url":"/api/payments/create-subscription","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.084Z","url":"/api/payments/cancel-subscription","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.092Z","url":"/api/payments/boost-ad","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.097Z","url":"/api/payments/boost-ad","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.101Z","url":"/api/payments/feature-ad","userId":"68384f0f1325b15c65d86a16"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:11:59.107Z","url":"/api/payments/feature-ad","userId":"68384f0f1325b15c65d86a16"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:59.112Z","url":"/api/payments/subscription-prices","userId":"68384f0f1325b15c65d86a16"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:11:59.266Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:11:59.293Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:59.305Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:11:59.306Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:59.311Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:59.312Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:11:59.315Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:11:59.744Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:11:59.749Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:04.152Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:04.298Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:04.363Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:12:05.375Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:06.379Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:12:06.379Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:12:06.389Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:12:06.397Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:12:06.404Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:12:07.412Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:08.415Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:12:08.415Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:11.471Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:15.483Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.677Z","url":"/api/payments/create-payment-intent","userId":"68384f23c293682e4f5ae0ea"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.649Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:12:19.649Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.649Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.649Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.649Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.649Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.649Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.649Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.694Z","url":"/api/payments/create-payment-intent","userId":"68384f23c293682e4f5ae0ea"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.697Z","url":"/api/payments/create-payment-intent","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.702Z","url":"/api/payments/create-subscription","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.704Z","url":"/api/payments/create-subscription","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.708Z","url":"/api/payments/cancel-subscription","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.718Z","url":"/api/payments/boost-ad","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.720Z","url":"/api/payments/boost-ad","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.725Z","url":"/api/payments/feature-ad","userId":"68384f23c293682e4f5ae0ea"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:19.729Z","url":"/api/payments/feature-ad","userId":"68384f23c293682e4f5ae0ea"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.736Z","url":"/api/payments/subscription-prices","userId":"68384f23c293682e4f5ae0ea"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:12:19.832Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.861Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.864Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.865Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:19.867Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:19.869Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:19.870Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.871Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.879Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.881Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:19.882Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:19.883Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.885Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:12:19.886Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:19.888Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:12:19.890Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:12:19.917Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:12:19.921Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:24.823Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:24.972Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:25.051Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:12:26.069Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:27.073Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:12:27.073Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:12:27.076Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:12:27.080Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:12:27.085Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:12:28.094Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:29.095Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:12:29.096Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:32.137Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:36.149Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.575Z","url":"/api/payments/create-payment-intent","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.588Z","url":"/api/payments/create-payment-intent","userId":"68384f380adc5380c2c86c1f"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.592Z","url":"/api/payments/create-payment-intent","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.600Z","url":"/api/payments/create-subscription","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.603Z","url":"/api/payments/create-subscription","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.613Z","url":"/api/payments/cancel-subscription","userId":"68384f380adc5380c2c86c1f"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.578Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:12:40.578Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.578Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.578Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.578Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.578Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.578Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.578Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.621Z","url":"/api/payments/boost-ad","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.624Z","url":"/api/payments/boost-ad","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.629Z","url":"/api/payments/feature-ad","userId":"68384f380adc5380c2c86c1f"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:12:40.633Z","url":"/api/payments/feature-ad","userId":"68384f380adc5380c2c86c1f"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.642Z","url":"/api/payments/subscription-prices","userId":"68384f380adc5380c2c86c1f"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:12:40.939Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:12:40.943Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.941Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.946Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.954Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:40.954Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:40.956Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.957Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:12:40.958Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:40.960Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:12:40.960Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:12:40.977Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:12:41.009Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:41.013Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:12:41.015Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:41.017Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:41.018Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:12:41.019Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:45.111Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:45.265Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:12:45.318Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:12:46.331Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:47.384Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:12:47.395Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:12:47.405Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:12:47.416Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:12:47.429Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:12:48.900Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:49.933Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:12:49.935Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:53.199Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:12:57.212Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.038Z","url":"/api/payments/create-payment-intent","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.050Z","url":"/api/payments/create-payment-intent","userId":"68384f4ff91f526a678e3fa5"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.053Z","url":"/api/payments/create-payment-intent","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.056Z","url":"/api/payments/create-subscription","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.060Z","url":"/api/payments/create-subscription","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.064Z","url":"/api/payments/cancel-subscription","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.069Z","url":"/api/payments/boost-ad","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.071Z","url":"/api/payments/boost-ad","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.074Z","url":"/api/payments/feature-ad","userId":"68384f4ff91f526a678e3fa5"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:03.076Z","url":"/api/payments/feature-ad","userId":"68384f4ff91f526a678e3fa5"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.083Z","url":"/api/payments/subscription-prices","userId":"68384f4ff91f526a678e3fa5"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.073Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:03.073Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.073Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.073Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.073Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.073Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.073Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.073Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.262Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.268Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.269Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:03.269Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.271Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.272Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:03.272Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.280Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:03.281Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:13:03.241Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:03.263Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.265Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:03.271Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:03.272Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:03.273Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:03.274Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:13:03.889Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:13:03.893Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:08.987Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:09.158Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:09.214Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:13:10.237Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:11.241Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:13:11.241Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:13:11.244Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:13:11.249Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:13:11.253Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:13:12.267Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:13.272Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:13:13.272Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:16.331Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:20.353Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:25.934Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:25.940Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:25.942Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:25.945Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:25.946Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:25.949Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:25.958Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:25.961Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:25.962Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:13:26.088Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:26.112Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.115Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.116Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:26.118Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:26.119Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:26.123Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:26.150Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:26.150Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.150Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.150Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:26.150Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.150Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:26.150Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:26.150Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.295Z","url":"/api/payments/create-payment-intent","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.317Z","url":"/api/payments/create-payment-intent","userId":"68384f66116e93683105349e"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.321Z","url":"/api/payments/create-payment-intent","userId":"68384f66116e93683105349e"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:13:26.323Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:13:26.327Z"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.329Z","url":"/api/payments/create-subscription","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.333Z","url":"/api/payments/create-subscription","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.339Z","url":"/api/payments/cancel-subscription","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.349Z","url":"/api/payments/boost-ad","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.351Z","url":"/api/payments/boost-ad","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.356Z","url":"/api/payments/feature-ad","userId":"68384f66116e93683105349e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:26.359Z","url":"/api/payments/feature-ad","userId":"68384f66116e93683105349e"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:26.366Z","url":"/api/payments/subscription-prices","userId":"68384f66116e93683105349e"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:32.052Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:32.204Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:32.264Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:13:33.279Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:34.283Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:13:34.283Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:13:34.286Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:13:34.290Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:13:34.295Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:13:35.402Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:36.407Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:13:36.408Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:39.471Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:43.481Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.783Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:48.783Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:48.783Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:48.783Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.783Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:48.783Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.783Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.783Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:48.900Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.908Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.910Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:48.912Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:48.913Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.916Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:48.917Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:48.919Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:13:48.920Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.004Z","url":"/api/payments/create-payment-intent","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.024Z","url":"/api/payments/create-payment-intent","userId":"68384f7c3c3671782f538ff4"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:49.027Z","url":"/api/payments/create-payment-intent","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.034Z","url":"/api/payments/create-subscription","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.037Z","url":"/api/payments/create-subscription","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.041Z","url":"/api/payments/cancel-subscription","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.052Z","url":"/api/payments/boost-ad","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.055Z","url":"/api/payments/boost-ad","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.060Z","url":"/api/payments/feature-ad","userId":"68384f7c3c3671782f538ff4"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:13:49.064Z","url":"/api/payments/feature-ad","userId":"68384f7c3c3671782f538ff4"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:49.069Z","url":"/api/payments/subscription-prices","userId":"68384f7c3c3671782f538ff4"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:13:49.103Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:13:49.107Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:13:49.067Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:13:49.092Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:49.099Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:13:49.100Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:49.103Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:49.104Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:13:49.104Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:55.444Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:55.572Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:13:55.585Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:13:56.606Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:57.617Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:13:57.621Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:13:57.637Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:13:57.656Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:13:57.683Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:13:58.700Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:13:59.704Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:13:59.704Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:02.746Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:06.767Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:10.662Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:14:10.662Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:10.662Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:10.662Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:10.662Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:10.662Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:10.662Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:10.662Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:14:11.683Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:14:11.687Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:11.716Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:11.722Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:11.723Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:11.724Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:11.726Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:11.727Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:14:11.727Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:11.729Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:14:11.729Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.759Z","url":"/api/payments/create-payment-intent","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.776Z","url":"/api/payments/create-payment-intent","userId":"68384f932115c4a89d351899"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:11.781Z","url":"/api/payments/create-payment-intent","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.787Z","url":"/api/payments/create-subscription","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.790Z","url":"/api/payments/create-subscription","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.796Z","url":"/api/payments/cancel-subscription","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.805Z","url":"/api/payments/boost-ad","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.807Z","url":"/api/payments/boost-ad","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.812Z","url":"/api/payments/feature-ad","userId":"68384f932115c4a89d351899"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:11.815Z","url":"/api/payments/feature-ad","userId":"68384f932115c4a89d351899"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:11.822Z","url":"/api/payments/subscription-prices","userId":"68384f932115c4a89d351899"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:14:11.808Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:11.833Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:11.839Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:11.842Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:11.844Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:11.846Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:11.847Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:14:15.845Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:14:16.063Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:14:16.119Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:14:17.134Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:18.137Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:14:18.137Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:14:18.140Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:14:18.144Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:14:18.149Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:14:19.160Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:20.164Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:14:20.164Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:23.204Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:27.237Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.681Z","url":"/api/payments/create-payment-intent","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.699Z","url":"/api/payments/create-payment-intent","userId":"68384fb0216e577df87feea6"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:40.703Z","url":"/api/payments/create-payment-intent","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.717Z","url":"/api/payments/create-subscription","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.737Z","url":"/api/payments/create-subscription","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.754Z","url":"/api/payments/cancel-subscription","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.809Z","url":"/api/payments/boost-ad","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.816Z","url":"/api/payments/boost-ad","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.835Z","url":"/api/payments/feature-ad","userId":"68384fb0216e577df87feea6"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:14:40.842Z","url":"/api/payments/feature-ad","userId":"68384fb0216e577df87feea6"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:40.853Z","url":"/api/payments/subscription-prices","userId":"68384fb0216e577df87feea6"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.332Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.349Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.351Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:41.353Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.357Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.360Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:14:41.364Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.367Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:14:41.368Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.331Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:14:41.331Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.331Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.331Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.331Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.331Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.331Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.331Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:14:41.677Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:14:41.716Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.721Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:14:41.723Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:41.727Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:41.728Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:14:41.730Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:14:42.119Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:14:42.130Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:14:51.558Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:14:51.629Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:14:51.662Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:14:52.707Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:53.712Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:14:53.713Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:14:53.719Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:14:53.724Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:14:53.729Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:14:54.737Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:55.741Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:14:55.741Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:14:58.789Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:02.806Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.219Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:09.219Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.219Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.219Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.219Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.219Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.219Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.219Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.380Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.389Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.390Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:09.391Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.393Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.395Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:09.395Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.397Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:09.398Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.425Z","url":"/api/payments/create-payment-intent","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.449Z","url":"/api/payments/create-payment-intent","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.455Z","url":"/api/payments/create-payment-intent","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.466Z","url":"/api/payments/create-subscription","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.476Z","url":"/api/payments/create-subscription","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.495Z","url":"/api/payments/cancel-subscription","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.513Z","url":"/api/payments/boost-ad","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.517Z","url":"/api/payments/boost-ad","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.529Z","url":"/api/payments/feature-ad","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:09.532Z","url":"/api/payments/feature-ad","userId":"68384fcda4a8c7d30d36f6e0"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.542Z","url":"/api/payments/subscription-prices","userId":"68384fcda4a8c7d30d36f6e0"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:15:09.710Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:09.749Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.755Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:09.758Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:09.763Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:09.765Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:09.768Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:15:09.960Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:15:09.964Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:15:15.530Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:15:15.700Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:15:15.760Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:15:16.771Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:17.774Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:15:17.774Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:15:17.778Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:15:17.782Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:15:17.787Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:15:18.800Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:19.807Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:15:19.808Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:22.888Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:26.903Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.032Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:32.032Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.032Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.032Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.032Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.032Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.032Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.032Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:15:32.027Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.060Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.062Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.064Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:32.067Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:32.068Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:32.068Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.313Z","url":"/api/payments/create-payment-intent","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.329Z","url":"/api/payments/create-payment-intent","userId":"68384fe46bb3c10557c22e39"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.334Z","url":"/api/payments/create-payment-intent","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.342Z","url":"/api/payments/create-subscription","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.347Z","url":"/api/payments/create-subscription","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.355Z","url":"/api/payments/cancel-subscription","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.363Z","url":"/api/payments/boost-ad","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.370Z","url":"/api/payments/boost-ad","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.375Z","url":"/api/payments/feature-ad","userId":"68384fe46bb3c10557c22e39"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:32.378Z","url":"/api/payments/feature-ad","userId":"68384fe46bb3c10557c22e39"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.384Z","url":"/api/payments/subscription-prices","userId":"68384fe46bb3c10557c22e39"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:15:32.524Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:15:32.527Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.540Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.546Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.550Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:32.552Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:32.553Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.556Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:32.557Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:32.558Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:32.559Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:15:41.164Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:15:41.294Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:15:41.339Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:15:42.356Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:43.360Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:15:43.361Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:15:43.363Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:15:43.368Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:15:43.372Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:15:44.381Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:45.385Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:15:45.385Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:48.453Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:15:52.499Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.380Z","url":"/api/payments/create-payment-intent","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.398Z","url":"/api/payments/create-payment-intent","userId":"68384fffa8718e4d134c7c1e"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.424Z","url":"/api/payments/create-payment-intent","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.436Z","url":"/api/payments/create-subscription","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.442Z","url":"/api/payments/create-subscription","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.454Z","url":"/api/payments/cancel-subscription","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.554Z","url":"/api/payments/boost-ad","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.569Z","url":"/api/payments/boost-ad","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.592Z","url":"/api/payments/feature-ad","userId":"68384fffa8718e4d134c7c1e"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:15:59.607Z","url":"/api/payments/feature-ad","userId":"68384fffa8718e4d134c7c1e"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.614Z","url":"/api/payments/subscription-prices","userId":"68384fffa8718e4d134c7c1e"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.699Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.713Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.717Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.719Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.723Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.726Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:59.728Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.741Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:59.743Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.660Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:15:59.881Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:15:59.927Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.931Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:15:59.933Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.936Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.937Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:15:59.939Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:16:01.017Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:16:01.031Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:16:06.938Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:16:07.120Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:16:07.182Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:16:08.221Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:09.226Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:16:09.226Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:16:09.230Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:16:09.236Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:16:09.244Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:16:10.286Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:11.311Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:16:11.319Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:14.430Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:18.442Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:16:25.990Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:25.990Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:25.990Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:26.674Z","url":"/api/payments/create-payment-intent","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:26.815Z","url":"/api/payments/create-payment-intent","userId":"6838501a0073d2f61949f027"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:26.852Z","url":"/api/payments/create-payment-intent","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.001Z","url":"/api/payments/create-subscription","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.172Z","url":"/api/payments/create-subscription","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.259Z","url":"/api/payments/cancel-subscription","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.328Z","url":"/api/payments/boost-ad","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.351Z","url":"/api/payments/boost-ad","userId":"6838501a0073d2f61949f027"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:27.252Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.275Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.300Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:27.302Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:27.309Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.322Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:16:27.327Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:27.334Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:16:27.344Z"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.380Z","url":"/api/payments/feature-ad","userId":"6838501a0073d2f61949f027"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:16:27.396Z","url":"/api/payments/feature-ad","userId":"6838501a0073d2f61949f027"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:27.439Z","url":"/api/payments/subscription-prices","userId":"6838501a0073d2f61949f027"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:16:30.908Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:16:30.948Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:16:31.075Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:16:31.182Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:31.192Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:16:31.199Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:31.204Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:31.205Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:16:31.212Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:16:41.082Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:16:41.302Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:16:41.362Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:16:42.708Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:43.715Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:16:43.720Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:16:43.726Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:16:43.739Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:16:43.772Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:16:44.798Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:45.803Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:16:45.804Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:48.930Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:16:55.390Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.867Z","url":"/api/payments/create-payment-intent","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.902Z","url":"/api/payments/create-payment-intent","userId":"683850564024e75d3161d9cb"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:17:26.728Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:26.844Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.849Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.852Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:26.854Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:26.855Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:26.857Z"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.909Z","url":"/api/payments/create-payment-intent","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.917Z","url":"/api/payments/create-subscription","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.922Z","url":"/api/payments/create-subscription","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.934Z","url":"/api/payments/cancel-subscription","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.960Z","url":"/api/payments/boost-ad","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.968Z","url":"/api/payments/boost-ad","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.984Z","url":"/api/payments/feature-ad","userId":"683850564024e75d3161d9cb"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:17:26.990Z","url":"/api/payments/feature-ad","userId":"683850564024e75d3161d9cb"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:26.997Z","url":"/api/payments/subscription-prices","userId":"683850564024e75d3161d9cb"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.499Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.805Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.830Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.832Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:17:27.838Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:17:27.841Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.844Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:17:27.847Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:17:27.850Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:17:27.852Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:17:28.726Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:17:28.734Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:55:46.313Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:55:46.522Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T12:55:46.589Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T12:55:47.600Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:48.605Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T12:55:48.606Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:55:48.609Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T12:55:48.615Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T12:55:48.634Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T12:55:49.642Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:50.644Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T12:55:50.645Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:53.667Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T12:55:57.677Z"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:55:59.618Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:55:59.618Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:55:59.618Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:55:59.984Z","url":"/api/payments/create-payment-intent","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.000Z","url":"/api/payments/create-payment-intent","userId":"6838595f6d7e0c217fe9fa47"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.002Z","url":"/api/payments/create-payment-intent","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.008Z","url":"/api/payments/create-subscription","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.010Z","url":"/api/payments/create-subscription","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.014Z","url":"/api/payments/cancel-subscription","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.019Z","url":"/api/payments/boost-ad","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.021Z","url":"/api/payments/boost-ad","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.026Z","url":"/api/payments/feature-ad","userId":"6838595f6d7e0c217fe9fa47"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T12:56:00.028Z","url":"/api/payments/feature-ad","userId":"6838595f6d7e0c217fe9fa47"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.031Z","url":"/api/payments/subscription-prices","userId":"6838595f6d7e0c217fe9fa47"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T12:56:00.043Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.063Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.065Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.067Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.068Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.069Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.069Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.171Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.175Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.176Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T12:56:00.184Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T12:56:00.185Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.186Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:56:00.186Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T12:56:00.187Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T12:56:00.187Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T12:56:00.403Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T12:56:00.406Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T13:22:19.480Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T13:22:19.657Z"}
{"level":"info","message":"Geocoding location: Oslo, Oslo, Norway","service":"date-night-api","timestamp":"2025-05-29T13:22:19.715Z"}
{"level":"info","message":"Geocoding location: NonExistentCity, NonExistentCounty, NonExistentCountry","service":"date-night-api","timestamp":"2025-05-29T13:22:20.735Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:21.737Z"}
{"level":"warn","message":"Could not geocode location: NonExistentCity, NonExistentCounty, NonExistentCountry. Using default coordinates.","service":"date-night-api","timestamp":"2025-05-29T13:22:21.737Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T13:22:21.740Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7523, 59.914","service":"date-night-api","timestamp":"2025-05-29T13:22:21.743Z"}
{"level":"info","message":"Reverse geocoding coordinates: 10.7522, 59.9139","service":"date-night-api","timestamp":"2025-05-29T13:22:21.747Z"}
{"level":"info","message":"Reverse geocoding coordinates: 0, 0","service":"date-night-api","timestamp":"2025-05-29T13:22:22.753Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:23.757Z"}
{"level":"warn","message":"Could not reverse geocode coordinates: 0, 0. Using generic result.","service":"date-night-api","timestamp":"2025-05-29T13:22:23.757Z"}
{"level":"error","message":"Error geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:26.804Z"}
{"level":"error","message":"Error reverse geocoding with Nominatim: Nominatim API error","service":"date-night-api","timestamp":"2025-05-29T13:22:30.824Z"}
{"level":"error","message":"Error creating payment intent: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:78:58)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.241Z"}
{"isOperational":true,"level":"error","message":"Error creating subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.createSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:145:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.246Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: User not found","service":"date-night-api","stack":"Error: User not found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:174:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:181:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.247Z"}
{"isOperational":true,"level":"error","message":"Error canceling subscription: No active subscription found","service":"date-night-api","stack":"Error: No active subscription found\n    at PaymentService.cancelSubscription (/Users/oivindlund/date-night-app/server/services/payment.service.js:179:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:190:7)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.248Z"}
{"level":"error","message":"Error fetching subscription prices: Stripe error","service":"date-night-api","stack":"Error: Stripe error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:220:48)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.249Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:220:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:278:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.250Z"}
{"isOperational":true,"level":"error","message":"Error boosting ad: You can only boost your own ads","service":"date-night-api","stack":"Error: You can only boost your own ads\n    at PaymentService.boostAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:229:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:289:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T13:22:33.251Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: Ad not found","service":"date-night-api","stack":"Error: Ad not found\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:281:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:344:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.252Z"}
{"isOperational":true,"level":"error","message":"Error featuring ad: You can only feature your own ads","service":"date-night-api","stack":"Error: You can only feature your own ads\n    at PaymentService.featureAd (/Users/oivindlund/date-night-app/server/services/payment.service.js:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/payment.service.test.ts:355:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T13:22:33.252Z"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.313Z","url":"/api/payments/create-payment-intent","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Valid amount is required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.324Z","url":"/api/payments/create-payment-intent","userId":"68385f99988514e40e1db240"}
{"error":{"message":"Payment service error","name":"Error","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Payment service error","method":"POST","service":"date-night-api","stack":"Error: Payment service error\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:153:60)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.327Z","url":"/api/payments/create-payment-intent","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.331Z","url":"/api/payments/create-subscription","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Price ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.337Z","url":"/api/payments/create-subscription","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"404 - No active subscription found","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.344Z","url":"/api/payments/cancel-subscription","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.348Z","url":"/api/payments/boost-ad","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.350Z","url":"/api/payments/boost-ad","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.353Z","url":"/api/payments/feature-ad","userId":"68385f99988514e40e1db240"}
{"error":"Error","level":"warn","message":"400 - Ad ID and payment method ID are required","method":"POST","service":"date-night-api","timestamp":"2025-05-29T13:22:33.355Z","url":"/api/payments/feature-ad","userId":"68385f99988514e40e1db240"}
{"error":{"message":"Failed to fetch prices","name":"Error","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"error","statusCode":500},"level":"error","message":"500 - Unhandled Error: Failed to fetch prices","method":"GET","service":"date-night-api","stack":"Error: Failed to fetch prices\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/integration/controllers/payment.controller.test.ts:507:62)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.358Z","url":"/api/payments/subscription-prices","userId":"68385f99988514e40e1db240"}
{"isOperational":true,"level":"error","message":"Error sending message: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:180:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:248:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error sending message: You are not a participant in this chat room","service":"date-night-api","stack":"Error: You are not a participant in this chat room\n    at ChatService.sendMessage (/Users/oivindlund/date-night-app/server/services/chat.service.js:187:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:260:7)","status":"fail","statusCode":403,"timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"error","message":"Error sending message: Database save failed","service":"date-night-api","stack":"Error: Database save failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:280:25)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"error","message":"Error fetching messages: Database connection lost","service":"date-night-api","stack":"Error: Database connection lost\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:375:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error creating direct room: One or both users not found","service":"date-night-api","stack":"Error: One or both users not found\n    at ChatService.createDirectRoom (/Users/oivindlund/date-night-app/server/services/chat.service.js:298:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:431:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"error","message":"Error creating direct room: DB connection failed","service":"date-night-api","stack":"Error: DB connection failed\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:440:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error getting rooms for user: User not found","service":"date-night-api","stack":"Error: User not found\n    at ChatService.getRoomsForUser (/Users/oivindlund/date-night-app/server/services/chat.service.js:439:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:502:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"isOperational":true,"level":"error","message":"Error marking messages as read: Chat room not found","service":"date-night-api","stack":"Error: Chat room not found\n    at ChatService.markMessagesAsRead (/Users/oivindlund/date-night-app/server/services/chat.service.js:544:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/chat.service.test.ts:538:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.391Z"}
{"level":"warn","message":"STRIPE_SECRET_KEY not set - Stripe functionality will be disabled","service":"date-night-api","timestamp":"2025-05-29T13:22:33.591Z"}
{"isOperational":true,"level":"error","message":"Error getting or creating wallet: User not found","service":"date-night-api","stack":"Error: User not found\n    at WalletService.getOrCreateWallet (/Users/oivindlund/date-night-app/server/services/wallet.service.js:65:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:464:7)","status":"fail","statusCode":404,"timestamp":"2025-05-29T13:22:33.609Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:535:15)\n    at /Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:397:39\n    at WalletService.<anonymous> (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:404:13)\n    at WalletService.mockConstructor [as getOrCreateWallet] (/Users/oivindlund/date-night-app/node_modules/jest-mock/build/index.js:148:19)\n    at WalletService.getOrCreateWallet [as getWalletBalance] (/Users/oivindlund/date-night-app/server/services/wallet.service.js:105:33)\n    at Object.getWalletBalance (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:538:34)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.611Z"}
{"level":"error","message":"Error getting wallet balance: Wallet not found","service":"date-night-api","stack":"Error: Wallet not found\n    at Object.<anonymous> (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:565:32)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-05-29T13:22:33.612Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Valid amount is required","service":"date-night-api","stack":"Error: Valid amount is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:407:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:646:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.615Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Unsupported currency: INVALID","service":"date-night-api","stack":"Error: Unsupported currency: INVALID\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:411:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:652:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.616Z"}
{"isOperational":true,"level":"error","message":"Error depositing funds with Stripe: Payment method ID is required","service":"date-night-api","stack":"Error: Payment method ID is required\n    at WalletService.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/services/wallet.service.js:415:15)\n    at Object.depositFundsWithStripe (/Users/oivindlund/date-night-app/server/tests/unit/services/wallet.service.test.ts:658:23)\n    at Promise.then.completed (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/oivindlund/date-night-app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/oivindlund/date-night-app/node_modules/jest-runner/build/testWorker.js:106:12)","status":"fail","statusCode":400,"timestamp":"2025-05-29T13:22:33.616Z"}
{"level":"info","message":"CSP configured in report-only mode","service":"date-night-api","timestamp":"2025-05-29T13:22:33.861Z"}
{"level":"info","message":"CSP configured in enforce mode","service":"date-night-api","timestamp":"2025-05-29T13:22:33.863Z"}
