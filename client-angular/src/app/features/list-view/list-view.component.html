# =================================================== # LIST VIEW COMPONENT TEMPLATE #
=================================================== # This template uses Nebular components for
consistent UI # ===================================================

<div class="list-view-container">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>Browse Profiles</h1>
      <p class="subtitle">Find your perfect match</p>
      <div class="header-actions">
        <button nbButton status="primary" (click)="onHeaderActionClick(headerActions[0])">
          <nb-icon icon="plus-outline"></nb-icon>
          Create Ad
        </button>
        <button nbButton ghost (click)="onHeaderActionClick(headerActions[1])">
          <nb-icon icon="refresh-outline"></nb-icon>
          Refresh
        </button>
        <button nbButton ghost (click)="onHeaderActionClick(headerActions[2])">
          <nb-icon icon="question-mark-circle-outline"></nb-icon>
          Help
        </button>
      </div>
    </div>

    <!-- Search and Filters Bar -->
    <div class="search-filters-bar">
      <div class="search-box">
        <nb-form-field>
          <nb-icon nbPrefix icon="search-outline"></nb-icon>
          <input
            nbInput
            fullWidth
            [formControl]="$any(filterForm.controls['searchQuery'])"
            (input)="onSearchChange()"
            placeholder="Search profiles..."
          />
        </nb-form-field>
      </div>

      <div class="view-controls">
        <!-- View Mode Toggle -->
        <div class="view-toggle">
          <button
            nbButton
            ghost
            [class.active]="viewMode === 'grid'"
            nbTooltip="Grid View"
            (click)="setViewMode('grid')"
          >
            <nb-icon icon="grid-outline"></nb-icon>
          </button>
          <button
            nbButton
            ghost
            [class.active]="viewMode === 'list'"
            nbTooltip="List View"
            (click)="setViewMode('list')"
          >
            <nb-icon icon="list-outline"></nb-icon>
          </button>
          <button
            nbButton
            ghost
            [class.active]="viewMode === 'compact'"
            nbTooltip="Compact View"
            (click)="setViewMode('compact')"
          >
            <nb-icon icon="layout-outline"></nb-icon>
          </button>
        </div>

        <!-- Sort Dropdown -->
        <button nbButton ghost [nbContextMenu]="sortMenu" nbContextMenuTag="sort-menu">
          <nb-icon icon="sort-outline"></nb-icon>
          <span>Sort: {{ getCurrentSortLabel() }}</span>
          <nb-icon icon="chevron-down-outline"></nb-icon>
        </button>

        <!-- Filter Button -->
        <button nbButton outline (click)="toggleFilterSidebar()">
          <nb-icon icon="funnel-outline"></nb-icon>
          <span>Filters</span>
          <nb-badge
            *ngIf="activeFilterCount > 0"
            status="primary"
            [text]="activeFilterCount.toString()"
          ></nb-badge>
        </button>

        <!-- Clear Filters Button -->
        <button nbButton status="danger" ghost (click)="clearFilters()" *ngIf="hasActiveFilters()">
          <nb-icon icon="close-outline"></nb-icon>
          <span>Clear</span>
        </button>
      </div>
    </div>

    <!-- Main Content Area with Filter Sidebar -->
    <div class="content-with-sidebar">
      <!-- Filter Sidebar -->
      <nb-sidebar [state]="filterSidebarOpen ? 'expanded' : 'collapsed'" fixed>
        <div class="filter-sidebar-header">
          <h3>Filters</h3>
          <button nbButton ghost size="small" (click)="toggleFilterSidebar()">
            <nb-icon icon="close-outline"></nb-icon>
          </button>
        </div>

        <div class="filter-sidebar-content">
          <form [formGroup]="filterForm">
            <nb-card>
              <nb-card-body>
                <h4>Categories</h4>
                <div class="filter-group">
                  <nb-checkbox formControlName="categories.escort">Escort</nb-checkbox>
                  <nb-checkbox formControlName="categories.massage">Massage</nb-checkbox>
                  <nb-checkbox formControlName="categories.striptease">Striptease</nb-checkbox>
                </div>

                <h4>Location</h4>
                <nb-select
                  fullWidth
                  formControlName="location"
                  multiple
                  placeholder="Select Location"
                >
                  <nb-option value="Oslo">Oslo</nb-option>
                  <nb-option value="Bergen">Bergen</nb-option>
                  <nb-option value="Trondheim">Trondheim</nb-option>
                  <nb-option value="Stavanger">Stavanger</nb-option>
                  <nb-option value="Kristiansand">Kristiansand</nb-option>
                  <nb-option value="Tromsø">Tromsø</nb-option>
                </nb-select>

                <h4>Date Range</h4>
                <div class="date-range-picker">
                  <nb-form-field>
                    <input
                      nbInput
                      fullWidth
                      [nbDatepicker]="fromPicker"
                      formControlName="dateRange.from"
                      placeholder="From"
                    />
                    <nb-datepicker #fromPicker></nb-datepicker>
                  </nb-form-field>

                  <nb-form-field>
                    <input
                      nbInput
                      fullWidth
                      [nbDatepicker]="toPicker"
                      formControlName="dateRange.to"
                      placeholder="To"
                    />
                    <nb-datepicker #toPicker></nb-datepicker>
                  </nb-form-field>
                </div>

                <h4>Status</h4>
                <div class="filter-group">
                  <nb-checkbox formControlName="status.online">Online Now</nb-checkbox>
                  <nb-checkbox formControlName="status.touring">Touring</nb-checkbox>
                  <nb-checkbox formControlName="status.verified">Verified</nb-checkbox>
                </div>

                <h4>Saved Filters</h4>
                <div class="saved-filters">
                  <button
                    nbButton
                    outline
                    (click)="loadSavedFilter('favorite')"
                    class="saved-filter-btn"
                  >
                    <nb-icon icon="heart-outline"></nb-icon> Favorites
                  </button>
                  <button
                    nbButton
                    outline
                    (click)="loadSavedFilter('recent')"
                    class="saved-filter-btn"
                  >
                    <nb-icon icon="clock-outline"></nb-icon> Recently Viewed
                  </button>
                  <button nbButton outline (click)="saveCurrentFilter()" class="saved-filter-btn">
                    <nb-icon icon="save-outline"></nb-icon> Save Current Filter
                  </button>
                </div>

                <div class="filter-actions">
                  <button nbButton ghost (click)="clearFilters()">Reset All</button>
                  <button nbButton status="primary" (click)="applyFilters()">Apply Filters</button>
                </div>
              </nb-card-body>
            </nb-card>
          </form>
        </div>
      </nb-sidebar>

      <!-- Content Area -->
      <div class="content-area" [class.sidebar-open]="filterSidebarOpen">
        <!-- Active Filters -->
        <div class="active-filters" *ngIf="hasActiveFilters()">
          <nb-tag-list>
            <nb-tag
              *ngFor="let filter of getActiveFilters()"
              [text]="filter.label"
              removable
              (remove)="removeFilter(filter)"
              status="primary"
            >
            </nb-tag>
          </nb-tag-list>
        </div>

        <!-- Loading State -->
        <nb-card *ngIf="loading">
          <nb-card-body class="loading-state">
            <nb-spinner size="large"></nb-spinner>
            <p>Loading profiles...</p>
          </nb-card-body>
        </nb-card>

        <!-- Error State -->
        <nb-alert *ngIf="error" status="danger">
          {{ error }}
        </nb-alert>

        <!-- Empty State -->
        <nb-card *ngIf="!loading && (!filteredAds || filteredAds.length === 0)">
          <nb-card-body class="empty-state">
            <nb-icon icon="alert-circle-outline" status="warning"></nb-icon>
            <h3>No Results Found</h3>
            <p>Try adjusting your filters or search criteria</p>
          </nb-card-body>
        </nb-card>

        <!-- Results Grid -->
        <div
          *ngIf="!loading && filteredAds && filteredAds.length > 0"
          class="results-grid"
          [class]="'view-mode-' + viewMode"
        >
          <nb-card *ngFor="let ad of getCurrentPageAds()" class="ad-card">
            <nb-card-body>
              <div class="ad-content">
                <div class="ad-header">
                  <h3>
                    <a [routerLink]="['/ads', ad._id]">{{ ad.title }}</a>
                  </h3>
                  <nb-actions size="small">
                    <nb-action
                      icon="heart-outline"
                      (click)="likeAd(ad._id, $event)"
                      nbTooltip="Add to Favorites"
                    ></nb-action>
                    <nb-action
                      icon="message-square-outline"
                      (click)="startChat(ad._id, $event)"
                      nbTooltip="Start Chat"
                    ></nb-action>
                    <nb-action
                      icon="share-outline"
                      (click)="shareAd(ad._id)"
                      nbTooltip="Share"
                    ></nb-action>
                  </nb-actions>
                </div>

                <div class="ad-meta">
                  <nb-tag status="primary" icon="map-outline">{{ ad.location }}</nb-tag>
                  <nb-tag status="info" icon="clock-outline">{{ ad.createdAt | date }}</nb-tag>
                  <nb-tag *ngIf="ad.isVerified" status="success" icon="checkmark-circle-2-outline"
                    >Verified</nb-tag
                  >
                  <nb-tag *ngIf="ad.isAdvertiserOnline" status="warning" icon="radio-outline"
                    >Online</nb-tag
                  >
                </div>

                <p class="ad-description">{{ ad.description }}</p>
              </div>
            </nb-card-body>
          </nb-card>
        </div>

        <!-- Pagination -->
        <div class="pagination" *ngIf="!loading && filteredAds && filteredAds.length > 0">
          <div class="pagination-controls">
            <nb-select [(ngModel)]="itemsPerPage" (selectedChange)="changePageSize($event)">
              <nb-option [value]="10">10 per page</nb-option>
              <nb-option [value]="20">20 per page</nb-option>
              <nb-option [value]="50">50 per page</nb-option>
              <nb-option [value]="100">100 per page</nb-option>
            </nb-select>

            <div class="page-buttons">
              <button nbButton ghost [disabled]="currentPage === 1" (click)="goToPage(1)">
                <nb-icon icon="arrow-ios-double-left-outline"></nb-icon>
              </button>
              <button
                nbButton
                ghost
                [disabled]="currentPage === 1"
                (click)="goToPage(currentPage - 1)"
              >
                <nb-icon icon="arrow-ios-back-outline"></nb-icon>
              </button>

              <div class="page-numbers">
                <button
                  nbButton
                  ghost
                  *ngFor="let page of getPageNumbers()"
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)"
                >
                  {{ page }}
                </button>
              </div>

              <button
                nbButton
                ghost
                [disabled]="currentPage === totalPages"
                (click)="goToPage(currentPage + 1)"
              >
                <nb-icon icon="arrow-ios-forward-outline"></nb-icon>
              </button>
              <button
                nbButton
                ghost
                [disabled]="currentPage === totalPages"
                (click)="goToPage(totalPages)"
              >
                <nb-icon icon="arrow-ios-double-right-outline"></nb-icon>
              </button>
            </div>

            <div class="page-info">
              Page {{ currentPage }} of {{ totalPages }} ({{ filteredAds.length }} total items)
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sort Menu Template -->
<ng-template #sortMenu>
  <nb-menu>
    
    
  </nb-menu>
</ng-template>

<!-- Save Filter Dialog Template -->
<ng-template #saveFilterDialog>
  <nb-card>
    <nb-card-header>Save Filter</nb-card-header>
    <nb-card-body>
      <nb-form-field>
        <input nbInput fullWidth [(ngModel)]="newFilterName" placeholder="Filter Name" />
      </nb-form-field>
    </nb-card-body>
    <nb-card-footer>
      <button nbButton status="basic" (click)="dialog.close()">Cancel</button>
      <button nbButton status="primary" (click)="dialog.close(newFilterName)">Save</button>
    </nb-card-footer>
  </nb-card>
</ng-template>
