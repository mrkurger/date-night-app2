<div class="list-view-container">
  <div class="container">
    <!-- Header Section -->
    <div class="list-header">
      <h1 class="section-title">Browse Profiles</h1>
      
      <!-- Search and Filters -->
      <div class="search-filters">
        <div class="search-box">
          <mat-form-field appearance="outline" class="search-input-field">
            <mat-label>Search profiles...</mat-label>
            <input matInput [formControl]="filterForm.controls['searchQuery']" (input)="onSearchChange()">
            <mat-icon matPrefix>search</mat-icon>
          </mat-form-field>
        </div>
        
        <div class="filter-actions">
          <!-- View Mode Toggle -->
          <button mat-icon-button color="primary" matTooltip="Toggle View" (click)="toggleViewMode()">
            <mat-icon>{{ viewMode === 'grid' ? 'view_list' : 'grid_view' }}</mat-icon>
          </button>
          
          <!-- Sort Dropdown -->
          <button mat-button [matMenuTriggerFor]="sortMenu" class="sort-button">
            <mat-icon>sort</mat-icon>
            <span>Sort</span>
          </button>
          <mat-menu #sortMenu="matMenu">
            <button mat-menu-item *ngFor="let option of sortOptions" 
                    [class.active]="currentSort === option.value" 
                    (click)="changeSort(option.value)">
              {{ option.label }}
            </button>
          </mat-menu>
          
          <!-- Filter Button -->
          <button mat-button color="primary" (click)="openFilters()">
            <mat-icon>filter_list</mat-icon>
            <span>Filters</span>
          </button>
          
          <!-- Clear Filters Button -->
          <button mat-button color="warn" (click)="clearFilters()" *ngIf="filterForm.dirty">
            <mat-icon>clear</mat-icon>
            <span>Clear</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="loading-text">Loading profiles...</p>
    </div>
    
    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <p class="error-text">{{ error }}</p>
      <button mat-raised-button color="primary" (click)="loadAds()">
        <mat-icon>refresh</mat-icon>
        Try Again
      </button>
    </div>
    
    <!-- List View -->
    <div class="list-content" *ngIf="!loading && !error">
      <!-- Empty State -->
      <div class="empty-container" *ngIf="filteredAds.length === 0">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <p class="empty-text">No profiles found</p>
        <p class="empty-subtext">Try adjusting your filters or search query</p>
        <button mat-raised-button color="primary" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>
      
      <!-- Grid/List View using Emerald CardGrid -->
      <emerald-card-grid
        *ngIf="filteredAds.length > 0"
        [items]="getCurrentPageAds()"
        [columns]="viewMode === 'list' ? 1 : 3"
        [gap]="16"
        [loading]="loading"
        [layout]="viewMode === 'list' ? 'grid' : 'grid'"
        (itemClick)="viewAdDetails($event._id)">
        <ng-template #itemTemplate let-ad>
          <emerald-app-card
            [ad]="ad"
            [layout]="viewMode === 'list' ? 'list' : 'netflix'"
            [isOnline]="ad.isAdvertiserOnline"
            [showActions]="true"
            [showDescription]="true"
            (viewDetails)="viewAdDetails($event)"
            (like)="likeAd($event)"
            (chat)="startChat($event)"
            (share)="shareAd($event)">
          </emerald-app-card>
        </ng-template>
      </emerald-card-grid>
      
      <!-- Pagination using Emerald Pager -->
      <div class="pagination-container" *ngIf="totalPages > 1">
        <emerald-pager
          [currentPage]="currentPage"
          [totalPages]="totalPages"
          [showPageSize]="true"
          [pageSize]="itemsPerPage"
          [pageSizes]="[10, 20, 50, 100]"
          style="default"
          size="medium"
          align="center"
          (pageChange)="goToPage($event)"
          (pageSizeChange)="changePageSize($event)">
        </emerald-pager>
      </div>
    </div>
  </div>
</div>

<!-- Filters Modal -->
<div class="modal fade" id="filtersModal" tabindex="-1" aria-labelledby="filtersModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="filtersModalLabel">Filter Profiles</h5>
        <button type="button" class="btn-close" (click)="closeFilters()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="filterForm">
          <mat-form-field appearance="outline" class="w-100 mb-3">
            <mat-label>Category</mat-label>
            <mat-select formControlName="category">
              <mat-option value="">All Categories</mat-option>
              <mat-option value="Escort">Escort</mat-option>
              <mat-option value="Striptease">Striptease</mat-option>
              <mat-option value="Massage">Massage</mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-100 mb-3">
            <mat-label>Location</mat-label>
            <mat-select formControlName="location">
              <mat-option value="">All Locations</mat-option>
              <mat-option value="Oslo">Oslo</mat-option>
              <mat-option value="Bergen">Bergen</mat-option>
              <mat-option value="Trondheim">Trondheim</mat-option>
              <mat-option value="Stavanger">Stavanger</mat-option>
            </mat-select>
          </mat-form-field>
          
          <div class="mb-3">
            <mat-checkbox formControlName="touringOnly" color="primary">
              Show only touring profiles
            </mat-checkbox>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button mat-button (click)="closeFilters()">Cancel</button>
        <button mat-raised-button color="primary" (click)="applyFilters(); closeFilters()">Apply Filters</button>
      </div>
    </div>
  </div>
</div>