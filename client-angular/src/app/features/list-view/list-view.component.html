<div class="list-view-container">
  <div class="container">
    <!-- Page Header with Emerald Component -->
    <emerald-page-header
      title="Browse Profiles"
      subtitle="Find your perfect match"
      [actions]="headerActions"
      (actionClick)="onHeaderActionClick($event)"
    >
    </emerald-page-header>

    <!-- Search and Filters Bar -->
    <div class="search-filters-bar">
      <div class="search-box">
        <mat-form-field appearance="outline" class="search-input-field">
          <mat-label>Search profiles...</mat-label>
          <input
            matInput
            [formControl]="filterForm.controls['searchQuery']"
            (input)="onSearchChange()"
          />
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      </div>

      <div class="view-controls">
        <!-- View Mode Toggle -->
        <div class="view-toggle">
          <button
            mat-icon-button
            [class.active]="viewMode === 'grid'"
            matTooltip="Grid View"
            (click)="setViewMode('grid')"
          >
            <mat-icon>grid_view</mat-icon>
          </button>
          <button
            mat-icon-button
            [class.active]="viewMode === 'list'"
            matTooltip="List View"
            (click)="setViewMode('list')"
          >
            <mat-icon>view_list</mat-icon>
          </button>
          <button
            mat-icon-button
            [class.active]="viewMode === 'compact'"
            matTooltip="Compact View"
            (click)="setViewMode('compact')"
          >
            <mat-icon>view_comfy</mat-icon>
          </button>
        </div>

        <!-- Sort Dropdown -->
        <button mat-button [matMenuTriggerFor]="sortMenu" class="sort-button">
          <mat-icon>sort</mat-icon>
          <span>Sort: {{ getCurrentSortLabel() }}</span>
          <mat-icon>arrow_drop_down</mat-icon>
        </button>
        <mat-menu #sortMenu="matMenu">
          <button
            mat-menu-item
            *ngFor="let option of sortOptions"
            [class.active]="currentSort === option.value"
            (click)="changeSort(option.value)"
          >
            <mat-icon *ngIf="currentSort === option.value">check</mat-icon>
            <span>{{ option.label }}</span>
            <mat-icon *ngIf="option.direction === 'asc'">arrow_upward</mat-icon>
            <mat-icon *ngIf="option.direction === 'desc'">arrow_downward</mat-icon>
          </button>
        </mat-menu>

        <!-- Filter Button -->
        <button mat-stroked-button color="primary" (click)="toggleFilterSidebar()">
          <mat-icon>filter_list</mat-icon>
          <span>Filters</span>
          <span class="filter-badge" *ngIf="activeFilterCount > 0">{{ activeFilterCount }}</span>
        </button>

        <!-- Clear Filters Button -->
        <button mat-button color="warn" (click)="clearFilters()" *ngIf="filterForm.dirty">
          <mat-icon>clear</mat-icon>
          <span>Clear</span>
        </button>
      </div>
    </div>

    <!-- Main Content Area with Filter Sidebar -->
    <div class="content-with-sidebar">
      <!-- Filter Sidebar -->
      <div class="filter-sidebar" [class.open]="filterSidebarOpen">
        <div class="filter-sidebar-header">
          <h3>Filters</h3>
          <button mat-icon-button (click)="toggleFilterSidebar()">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <div class="filter-sidebar-content">
          <form [formGroup]="filterForm">
            <h4>Categories</h4>
            <div class="filter-group">
              <mat-checkbox formControlName="categories.escort" color="primary"
                >Escort</mat-checkbox
              >
              <mat-checkbox formControlName="categories.massage" color="primary"
                >Massage</mat-checkbox
              >
              <mat-checkbox formControlName="categories.striptease" color="primary"
                >Striptease</mat-checkbox
              >
            </div>

            <h4>Location</h4>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Select Location</mat-label>
              <mat-select formControlName="location" multiple>
                <mat-option value="Oslo">Oslo</mat-option>
                <mat-option value="Bergen">Bergen</mat-option>
                <mat-option value="Trondheim">Trondheim</mat-option>
                <mat-option value="Stavanger">Stavanger</mat-option>
                <mat-option value="Kristiansand">Kristiansand</mat-option>
                <mat-option value="Tromsø">Tromsø</mat-option>
              </mat-select>
            </mat-form-field>

            <h4>Date Range</h4>
            <div class="date-range-picker">
              <mat-form-field appearance="outline">
                <mat-label>From</mat-label>
                <input matInput [matDatepicker]="fromPicker" formControlName="dateRange.from" />
                <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
                <mat-datepicker #fromPicker></mat-datepicker>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>To</mat-label>
                <input matInput [matDatepicker]="toPicker" formControlName="dateRange.to" />
                <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
                <mat-datepicker #toPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <h4>Status</h4>
            <div class="filter-group">
              <mat-checkbox formControlName="status.online" color="primary"
                >Online Now</mat-checkbox
              >
              <mat-checkbox formControlName="status.touring" color="primary">Touring</mat-checkbox>
              <mat-checkbox formControlName="status.verified" color="primary"
                >Verified</mat-checkbox
              >
            </div>

            <h4>Saved Filters</h4>
            <div class="saved-filters">
              <button
                mat-stroked-button
                (click)="loadSavedFilter('favorite')"
                class="saved-filter-btn"
              >
                <mat-icon>favorite</mat-icon> Favorites
              </button>
              <button
                mat-stroked-button
                (click)="loadSavedFilter('recent')"
                class="saved-filter-btn"
              >
                <mat-icon>history</mat-icon> Recently Viewed
              </button>
              <button mat-stroked-button (click)="saveCurrentFilter()" class="saved-filter-btn">
                <mat-icon>save</mat-icon> Save Current Filter
              </button>
            </div>

            <div class="filter-actions">
              <button mat-button (click)="clearFilters()">Reset All</button>
              <button mat-raised-button color="primary" (click)="applyFilters()">
                Apply Filters
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Active Filters Display -->
        <div class="active-filters" *ngIf="hasActiveFilters()">
          <span class="active-filters-label">Active Filters:</span>
          <div class="filter-chips">
            <mat-chip-set>
              <mat-chip
                *ngFor="let filter of getActiveFilters()"
                [removable]="true"
                (removed)="removeFilter(filter)"
              >
                {{ filter.label }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <mat-chip color="warn" (click)="clearFilters()">
                Clear All
                <mat-icon>clear</mat-icon>
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading">
          <emerald-skeleton-loader
            type="card"
            [count]="viewMode === 'list' ? 5 : 9"
            [animated]="true"
          >
          </emerald-skeleton-loader>
        </div>

        <!-- Error State -->
        <div class="error-container" *ngIf="error && !loading">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <p class="error-text">{{ error }}</p>
          <button mat-raised-button color="primary" (click)="loadAds()">
            <mat-icon>refresh</mat-icon>
            Try Again
          </button>
        </div>

        <!-- Empty State -->
        <div class="empty-container" *ngIf="filteredAds.length === 0 && !loading && !error">
          <mat-icon class="empty-icon">search_off</mat-icon>
          <p class="empty-text">No profiles found</p>
          <p class="empty-subtext">Try adjusting your filters or search query</p>
          <button mat-raised-button color="primary" (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
            Clear Filters
          </button>
        </div>

        <!-- List/Grid View using Emerald CardGrid -->
        <emerald-card-grid
          *ngIf="filteredAds.length > 0 && !loading && !error"
          [items]="getCurrentPageAds()"
          [columns]="getColumnsForViewMode()"
          [gap]="16"
          [layout]="viewMode === 'list' ? 'grid' : 'grid'"
          (itemClick)="viewAdDetails($event._id)"
        >
          <ng-template #itemTemplate let-ad>
            <emerald-app-card
              [ad]="ad"
              [layout]="
                viewMode === 'list' ? 'list' : viewMode === 'compact' ? 'compact' : 'netflix'
              "
              [isOnline]="ad.isAdvertiserOnline"
              [showActions]="true"
              [showDescription]="viewMode !== 'compact'"
              (viewDetails)="viewAdDetails($event)"
              (like)="likeAd($event)"
              (chat)="startChat($event)"
              (share)="shareAd($event)"
            >
            </emerald-app-card>
          </ng-template>
        </emerald-card-grid>

        <!-- Pagination using Emerald Pager -->
        <div class="pagination-container" *ngIf="totalPages > 1 && filteredAds.length > 0">
          <emerald-pager
            [currentPage]="currentPage"
            [totalPages]="totalPages"
            [showPageSize]="true"
            [pageSize]="itemsPerPage"
            [pageSizes]="[10, 20, 50, 100]"
            style="default"
            size="medium"
            align="center"
            (pageChange)="goToPage($event)"
            (pageSizeChange)="changePageSize($event)"
          >
          </emerald-pager>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Action Button -->
<emerald-floating-action-button
  icon="fa-plus"
  label="Create New Ad"
  color="primary"
  size="large"
  position="bottom-right"
  [showTooltip]="true"
  tooltipText="Create a new advertisement"
  [hasMenu]="true"
  [menuItems]="fabMenuItems"
  (buttonClick)="onFabClick()"
  (menuItemClick)="onFabMenuItemClick($event)"
>
</emerald-floating-action-button>

<!-- Save Filter Dialog -->
<ng-template #saveFilterDialog>
  <h2 mat-dialog-title>Save Filter</h2>
  <mat-dialog-content>
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Filter Name</mat-label>
      <input matInput [(ngModel)]="newFilterName" placeholder="My Custom Filter" />
    </mat-form-field>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button
      mat-raised-button
      color="primary"
      [mat-dialog-close]="newFilterName"
      [disabled]="!newFilterName"
    >
      Save
    </button>
  </mat-dialog-actions>
</ng-template>
