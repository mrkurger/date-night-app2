<div class="ad-stats-container">
  <h2>Statistics for "{{ adTitle }}"</h2>

  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div *ngIf="!loading" class="stats-content">
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>Performance Summary (Last 7 Days)</mat-card-title>
      </mat-card-header>
      <mat-card-content class="summary-metrics">
        <div class="metric">
          <div class="metric-value">{{ getTotalViews(dataSource.data.slice(0, 7)) }}</div>
          <div class="metric-label">Total Views</div>
        </div>
        <div class="metric">
          <div class="metric-value">{{ getTotalClicks(dataSource.data.slice(0, 7)) }}</div>
          <div class="metric-label">Total Clicks</div>
        </div>
        <div class="metric">
          <div class="metric-value">{{ getTotalInquiries(dataSource.data.slice(0, 7)) }}</div>
          <div class="metric-label">Total Inquiries</div>
        </div>
        <div class="metric">
          <div class="metric-value">
            {{ getConversionRate(dataSource.data.slice(0, 7)) }}%
          </div>
          <div class="metric-label">Conversion Rate</div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Chart placeholders - in a real app, you would use a charting library like ngx-charts -->
    <div class="charts-container">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Daily Views</mat-card-title>
        </mat-card-header>
        <mat-card-content class="chart-placeholder">
          <div class="chart-bars">
            <div class="bar" 
                 *ngFor="let item of viewsData" 
                 [style.height]="getBarHeight(item, viewsData)"
                 [title]="item.value">
            </div>
          </div>
          <div class="chart-labels">
            <div *ngFor="let item of viewsData" class="chart-label">
              {{ item.name | date:'MM/dd' }}
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Daily Clicks</mat-card-title>
        </mat-card-header>
        <mat-card-content class="chart-placeholder">
          <div class="chart-bars">
            <div class="bar" 
                 *ngFor="let item of clicksData" 
                 [style.height]="getBarHeight(item, clicksData)"
                 [title]="item.value">
            </div>
          </div>
          <div class="chart-labels">
            <div *ngFor="let item of clicksData" class="chart-label">
              {{ item.name | date:'MM/dd' }}
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Detailed stats table -->
    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>Detailed Statistics</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Filter</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Search by date">
        </mat-form-field>

        <div class="table-container mat-elevation-z8">
          <table mat-table [dataSource]="dataSource" matSort>
            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Date </th>
              <td mat-cell *matCellDef="let row"> {{row.date | date}} </td>
            </ng-container>

            <!-- Views Column -->
            <ng-container matColumnDef="views">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Views </th>
              <td mat-cell *matCellDef="let row"> {{row.views}} </td>
            </ng-container>

            <!-- Clicks Column -->
            <ng-container matColumnDef="clicks">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Clicks </th>
              <td mat-cell *matCellDef="let row"> {{row.clicks}} </td>
            </ng-container>

            <!-- Inquiries Column -->
            <ng-container matColumnDef="inquiries">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Inquiries </th>
              <td mat-cell *matCellDef="let row"> {{row.inquiries}} </td>
            </ng-container>

            <!-- Conversion Rate Column -->
            <ng-container matColumnDef="conversionRate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Conversion Rate </th>
              <td mat-cell *matCellDef="let row"> {{row.conversionRate}}% </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of stats"></mat-paginator>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>