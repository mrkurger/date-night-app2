<div class="ad-form-container">
  <h2>{{ isEditMode ? 'Edit Advertisement' : 'Create New Advertisement' }}</h2>

  <div *ngIf="loading" class="loading-spinner">
    <nb-spinner status="primary" size="large"></nb-spinner>
  </div>

  <form [formGroup]="adForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <nb-card>
      <nb-card-body>
        <div class="form-row">
          <nb-form-field class="full-width">
            <label for="title">Title</label>
            <input
              nbInput
              fullWidth
              formControlName="title"
              placeholder="Enter a catchy title"
              id="title"
            />
            <nb-hint
              *ngIf="adForm.get('title')?.hasError('required') && adForm.get('title')?.touched"
              status="danger"
            >
              Title is required
            </nb-hint>
            <nb-hint *ngIf="adForm.get('title')?.hasError('maxlength')" status="danger">
              Title cannot exceed 100 characters
            </nb-hint>
          </nb-form-field>
        </div>

        <div class="form-row">
          <nb-form-field class="full-width">
            <label for="description">Description</label>
            <textarea
              nbInput
              fullWidth
              formControlName="description"
              rows="5"
              placeholder="Describe your services in detail"
              id="description"
            ></textarea>
            <nb-hint
              *ngIf="
                adForm.get('description')?.hasError('required') &&
                adForm.get('description')?.touched
              "
              status="danger"
            >
              Description is required
            </nb-hint>
            <nb-hint *ngIf="adForm.get('description')?.hasError('maxlength')" status="danger">
              Description cannot exceed 1000 characters
            </nb-hint>
          </nb-form-field>
        </div>

        <div class="form-row two-columns">
          <nb-form-field>
            <label for="category">Category</label>
            <nb-select
              formControlName="category"
              placeholder="Select category"
              fullWidth
              id="category"
            >
              <nb-option *ngFor="let category of categories" [value]="category">
                {{ category }}
              </nb-option>
            </nb-select>
            <nb-hint
              *ngIf="
                adForm.get('category')?.hasError('required') && adForm.get('category')?.touched
              "
              status="danger"
            >
              Category is required
            </nb-hint>
          </nb-form-field>

          <nb-form-field>
            <label for="price">Price (USD)</label>
            <div class="input-with-prefix">
              <span class="prefix">$</span>
              <input nbInput type="number" formControlName="price" placeholder="0" id="price" />
            </div>
            <nb-hint
              *ngIf="adForm.get('price')?.hasError('required') && adForm.get('price')?.touched"
              status="danger"
            >
              Price is required
            </nb-hint>
            <nb-hint *ngIf="adForm.get('price')?.hasError('min')" status="danger">
              Price cannot be negative
            </nb-hint>
          </nb-form-field>
        </div>

        <div class="form-row two-columns">
          <nb-form-field>
            <label for="county">County</label>
            <nb-select
              formControlName="county"
              placeholder="Select county"
              fullWidth
              id="county"
              (selectedChange)="onCountyChange()"
            >
              <nb-option *ngFor="let county of counties" [value]="county">
                {{ county }}
              </nb-option>
            </nb-select>
            <nb-hint
              *ngIf="adForm.get('county')?.hasError('required') && adForm.get('county')?.touched"
              status="danger"
            >
              County is required
            </nb-hint>
          </nb-form-field>

          <nb-form-field>
            <label for="city">City</label>
            <nb-select formControlName="city" placeholder="Select city" fullWidth id="city">
              <nb-option *ngFor="let city of cities" [value]="city.name">
                {{ city.name }}
              </nb-option>
            </nb-select>
            <nb-hint
              *ngIf="adForm.get('city')?.hasError('required') && adForm.get('city')?.touched"
              status="danger"
            >
              City is required
            </nb-hint>
          </nb-form-field>
        </div>

        <div class="form-row">
          <nb-checkbox formControlName="isActive" status="primary">
            Make this advertisement active immediately
          </nb-checkbox>
        </div>
      </nb-card-body>

      <nb-card-footer class="actions-footer">
        <button nbButton status="basic" type="button" (click)="onCancel()">Cancel</button>
        <button nbButton status="primary" type="submit" [disabled]="adForm.invalid">
          {{ isEditMode ? 'Update' : 'Create' }} Advertisement
        </button>
      </nb-card-footer>
    </nb-card>
  </form>
</div>

<style>
  .input-with-prefix {
    display: flex;
    align-items: center;
  }
  .prefix {
    margin-right: 0.5rem;
  }
  .actions-footer {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
  }
</style>
