<app-main-layout activeView="netflix">
  <div class="netflix-container">
    <!-- Hero Section with Emerald PageHeader -->
    <emerald-page-header 
      *ngIf="featuredAd"
      [title]="featuredAd.title"
      [subtitle]="featuredAd.location"
      [backgroundImage]="getMediaUrl(featuredAd)"
      [avatarUrl]="featuredAd.advertiserImage"
      [avatarName]="featuredAd.advertiserName"
      [avatarIsOnline]="featuredAd.isAdvertiserOnline"
      [actions]="[
        {id: 'view', label: 'View Profile', icon: 'fas fa-info-circle', primary: true},
        {id: 'favorite', label: 'Add to Favorites', icon: 'fas fa-heart'},
        {id: 'chat', label: 'Start Chat', icon: 'fas fa-comment'}
      ]"
      (actionClick)="onHeroAction($event, featuredAd._id)">
      <p class="hero-description">{{ featuredAd.description }}</p>
    </emerald-page-header>

    <!-- Main Content -->
    <div class="netflix-content">
      <!-- Filters Bar -->
      <div class="filters-bar">
        <div class="container">
          <div class="filters-content">
            <h2 class="section-title">Browse Profiles</h2>
            <button class="filter-button" (click)="openFilters()">
              <i class="fas fa-sliders-h"></i> Filters
            </button>
          </div>
        </div>
      </div>

      <!-- Loading State with Emerald SkeletonLoader -->
      <div class="loading-container" *ngIf="loading">
        <emerald-skeleton-loader
          type="card"
          [count]="5"
          [animated]="true">
        </emerald-skeleton-loader>
        <p class="loading-text">Loading content...</p>
      </div>

      <!-- Error State -->
      <div class="error-container" *ngIf="error && !loading">
        <div class="error-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <p class="error-text">{{ error }}</p>
        <button class="btn btn-primary retry-button" (click)="loadAds()">
          <i class="fas fa-redo"></i> Try Again
        </button>
      </div>

      <!-- Netflix-style Rows with Emerald CardGrid and AppCard -->
      <div class="netflix-rows" *ngIf="!loading && !error">
        <div class="row-section" *ngFor="let category of categories; let i = index">
          <div class="container">
            <h2 class="row-title">{{ category }}</h2>

            <!-- Empty state handling -->
            <div class="empty-row" *ngIf="adsByCategory[category]?.length === 0">
              <p class="empty-row-text">No profiles in this category</p>
            </div>

            <!-- Using Emerald CardGrid for each row -->
            <emerald-card-grid
              *ngIf="adsByCategory[category]?.length > 0"
              [items]="adsByCategory[category]"
              [layout]="cardGridConfig.layout"
              [gap]="cardGridConfig.gap"
              [animated]="cardGridConfig.animated"
              [itemsPerRow]="cardGridConfig.itemsPerRow"
              (itemClick)="viewAdDetails($event._id)">
              <ng-template #itemTemplate let-ad>
                <emerald-app-card
                  [ad]="ad"
                  layout="netflix"
                  [isOnline]="ad.isAdvertiserOnline"
                  (viewDetails)="viewAdDetails($event)"
                  (like)="likeAd($event)"
                  (chat)="startChat($event)">
                </emerald-app-card>
              </ng-template>
            </emerald-card-grid>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Action Button for Filters -->
  <emerald-floating-action-button
    icon="fa-sliders-h"
    label="Filters"
    color="primary"
    position="bottom-right"
    [showTooltip]="true"
    tooltipText="Filter Profiles"
    (buttonClick)="openFilters()">
  </emerald-floating-action-button>

  <!-- Filters Modal -->
  <div class="modal fade" id="filtersModal" tabindex="-1" aria-labelledby="filtersModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="filtersModalLabel">Filter Profiles</h5>
          <button type="button" class="btn-close" (click)="closeFilters()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="filterForm">
            <div class="mb-3">
              <label for="category" class="form-label">Category</label>
              <select class="form-select" id="category" formControlName="category">
                <option value="">All Categories</option>
                <option value="Escort">Escort</option>
                <option value="Striptease">Striptease</option>
                <option value="Massage">Massage</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="location" class="form-label">Location</label>
              <select class="form-select" id="location" formControlName="location">
                <option value="">All Locations</option>
                <option value="Oslo">Oslo</option>
                <option value="Bergen">Bergen</option>
                <option value="Trondheim">Trondheim</option>
                <option value="Stavanger">Stavanger</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Currently Touring</label>
              <!-- Using Emerald Toggle -->
              <emerald-toggle
                label="Show only touring profiles"
                labelPosition="right"
                color="primary"
                [value]="filterForm.get('touringOnly')?.value"
                (change)="filterForm.get('touringOnly')?.setValue($event)">
              </emerald-toggle>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="resetFilters()">
            <i class="fas fa-undo"></i> Reset
          </button>
          <button type="button" class="btn btn-secondary" (click)="closeFilters()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="applyFilters(); closeFilters()">
            <i class="fas fa-check"></i> Apply Filters
          </button>
        </div>
      </div>
    </div>
  </div>
</app-main-layout>