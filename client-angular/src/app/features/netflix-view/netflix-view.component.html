<div class="netflix-container">
  <!-- Hero Section with PrimeNG Card -->
  <p-card *ngIf="featuredAd" styleClass="hero-card">
    <ng-template pTemplate="header">
      <div class="hero-header">
        <div class="user-info">
          <div class="user-avatar-wrapper">
            <p-avatar
              [image]="getAdvertiserImage(featuredAd)"
              [label]="getAdvertiserName(featuredAd) | slice : 0 : 1"
              shape="circle"
              size="large"
              [styleClass]="featuredAd.isAdvertiserOnline ? 'online-avatar' : 'offline-avatar'"
            ></p-avatar>
          </div>
          <div class="user-details">
            <span class="user-name">{{ getAdvertiserName(featuredAd) }}</span>
            <span class="user-location">{{ getLocationString(featuredAd) }}</span>
          </div>
        </div>
        <div class="hero-actions">
          <button
            pButton
            pRipple
            icon="pi pi-info-circle"
            (click)="onHeroAction('view', getAdIdAsString(featuredAd._id))"
            label="View Profile"
          ></button>
          <button
            pButton
            pRipple
            icon="pi pi-heart"
            (click)="onHeroAction('favorite', getAdIdAsString(featuredAd._id))"
            label="Add to Favorites"
            class="p-button-outlined"
          ></button>
          <button
            pButton
            pRipple
            icon="pi pi-comments"
            (click)="onHeroAction('chat', getAdIdAsString(featuredAd._id))"
            label="Start Chat"
            class="p-button-outlined"
          ></button>
        </div>
      </div>
    </ng-template>

    <div class="hero-content" [style.backgroundImage]="'url(' + getMediaUrl(featuredAd) + ')'">
      <h1>{{ featuredAd.title }}</h1>
      <p class="hero-description">{{ featuredAd.description }}</p>

      <!-- Tags -->
      <div class="hero-tags" *ngIf="featuredAd.tags && featuredAd.tags.length > 0">
        <p-tag
          *ngFor="let tag of featuredAd.tags.slice(0, 5)"
          [value]="tag"
          severity="primary"
          [rounded]="true"
        ></p-tag>
      </div>
    </div>
  </p-card>

  <!-- Main Content -->
  <div class="netflix-content">
    <!-- Filters Bar -->
    <div class="filters-bar">
      <div class="container">
        <div class="filters-content">
          <h2 class="section-title">Browse Profiles</h2>
          <button
            pButton
            pRipple
            icon="pi pi-filter"
            (click)="openFilters()"
            label="Filters"
            class="p-button-outlined"
          ></button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <p-progressSpinner [strokeWidth]="4"></p-progressSpinner>
      <p class="loading-text">Loading profiles...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: var(--red-500)"></i>
      <p class="error-text">{{ error }}</p>
      <button pButton pRipple icon="pi pi-refresh" (click)="loadAds()" label="Try Again"></button>
    </div>

    <!-- Netflix-style Rows -->
    <div class="netflix-rows" *ngIf="!loading && !error">
      <div class="row-section" *ngFor="let category of categories; let i = index">
        <div class="container">
          <h2 class="row-title">{{ category }}</h2>

          <!-- Empty state handling -->
          <div class="empty-row" *ngIf="adsByCategory[category]?.length === 0">
            <p class="empty-row-text">No profiles in this category</p>
          </div>

          <!-- Grid of Cards -->
          <div class="card-grid" *ngIf="adsByCategory[category]?.length > 0">
            <p-card
              *ngFor="let ad of adsByCategory[category]"
              class="netflix-card"
              (click)="viewAdDetails(ad.id)"
              [style]="{ cursor: 'pointer' }"
            >
              <ng-template pTemplate="header">
                <div class="card-user-info">
                  <p-avatar
                    [image]="ad.advertiserImage"
                    [label]="ad.advertiserName | slice : 0 : 1"
                    shape="circle"
                    size="small"
                    [styleClass]="ad.isAdvertiserOnline ? 'online-avatar' : 'offline-avatar'"
                  ></p-avatar>
                  <span class="advertiser-name">{{ ad.advertiserName }}</span>
                </div>
              </ng-template>

              <div class="card-content" [style.backgroundImage]="'url(' + getMediaUrl(ad) + ')'">
                <h3>{{ ad.title }}</h3>
                <p>{{ ad.description?.substring(0, 100) + '...' }}</p>

                <!-- Tags -->
                <div class="card-tags" *ngIf="ad.tags?.length > 0">
                  <p-tag
                    *ngFor="let tag of ad.tags.slice(0, 3)"
                    [value]="tag"
                    severity="primary"
                    [rounded]="true"
                  ></p-tag>
                </div>
              </div>

              <ng-template pTemplate="footer">
                <div class="card-actions">
                  <button
                    pButton
                    pRipple
                    icon="pi pi-info-circle"
                    class="p-button-rounded p-button-text"
                    pTooltip="View Details"
                    (click)="$event.stopPropagation(); onCardAction({ id: 'view', itemId: ad.id })"
                  ></button>
                  <button
                    pButton
                    pRipple
                    icon="pi pi-heart"
                    class="p-button-rounded p-button-text"
                    pTooltip="Add to Favorites"
                    (click)="
                      $event.stopPropagation(); onCardAction({ id: 'favorite', itemId: ad.id })
                    "
                  ></button>
                  <button
                    pButton
                    pRipple
                    icon="pi pi-comments"
                    class="p-button-rounded p-button-text"
                    pTooltip="Start Chat"
                    (click)="$event.stopPropagation(); onCardAction({ id: 'chat', itemId: ad.id })"
                  ></button>
                </div>
              </ng-template>
            </p-card>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Action Button -->
<button
  pButton
  pRipple
  icon="pi pi-filter"
  class="floating-action-button p-button-rounded p-button-lg"
  (click)="openFilters()"
  pTooltip="Filter Profiles"
></button>

<!-- Filters Dialog -->
<p-dialog
  [(visible)]="showFiltersDialog"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '90vw', maxWidth: '500px' }"
  header="Filter Profiles"
>
  <form [formGroup]="filterForm">
    <div class="field">
      <label for="category">Category</label>
      <p-dropdown
        id="category"
        formControlName="category"
        [options]="[
          { label: 'All Categories', value: '' },
          { label: 'Escort', value: 'Escort' },
          { label: 'Striptease', value: 'Striptease' },
          { label: 'Massage', value: 'Massage' },
          { label: 'Companion', value: 'Companion' },
          { label: 'Other', value: 'Other' }
        ]"
        placeholder="Select a category"
        [style]="{ width: '100%' }"
      ></p-dropdown>
    </div>

    <div class="field">
      <label for="location">Location</label>
      <p-dropdown
        id="location"
        formControlName="location"
        [options]="[
          { label: 'All Locations', value: '' },
          { label: 'Oslo', value: 'Oslo' },
          { label: 'Bergen', value: 'Bergen' },
          { label: 'Trondheim', value: 'Trondheim' },
          { label: 'Stavanger', value: 'Stavanger' },
          { label: 'Tromsø', value: 'Tromsø' },
          { label: 'Kristiansand', value: 'Kristiansand' }
        ]"
        placeholder="Select a location"
        [style]="{ width: '100%' }"
      ></p-dropdown>
    </div>

    <div class="field-checkbox">
      <p-inputSwitch formControlName="touringOnly"></p-inputSwitch>
      <label for="touringOnly" class="ml-2">Show only touring profiles</label>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      icon="pi pi-refresh"
      (click)="resetFilters()"
      label="Reset"
      class="p-button-text"
    ></button>
    <button
      pButton
      pRipple
      icon="pi pi-check"
      (click)="applyFilters(); showFiltersDialog = false"
      label="Apply"
    ></button>
  </ng-template>
</p-dialog>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>
