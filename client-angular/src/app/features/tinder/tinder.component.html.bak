<app-main-layout activeView="tinder">
  <div class="tinder-container">
    <div class="tinder-header">
      <h1 class="tinder-title">Discover</h1>
      <div class="tinder-filters">
        <button nbButton status="primary" (click)="openFilters(filtersDialog)">
          <nb-icon icon="options-2-outline"></nb-icon>
          Filters
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <nb-spinner size="large"></nb-spinner>
      <p class="loading-text">Finding matches for you...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <nb-icon icon="alert-circle-outline" status="danger" class="error-icon"></nb-icon>
      <p class="error-text">{{ error }}</p>
      <button nbButton status="primary" (click)="loadSwipeAds()">
        <nb-icon icon="refresh-outline"></nb-icon>
        Try Again
      </button>
    </div>

    <!-- Empty State -->
    <div class="empty-container" *ngIf="!loading && !error && (!ads || ads.length === 0)">
      <nb-icon icon="search-outline" class="empty-icon"></nb-icon>
      <p class="empty-text">No more profiles to show</p>
      <p class="empty-subtext">Try adjusting your filters or check back later</p>
    </div>

    <!-- Tinder Card Area -->
    <div class="swipe-area" *ngIf="!loading && !error && currentAd">
      <!-- Current Card -->
      <app-tinder-card
        [title]="currentAd.title"
        [subtitle]="getLocationString(currentAd)"
        [description]="currentAd.description"
        [media]="getCardMedia(currentAd)"
        [tags]="currentAd.tags"
        [itemId]="getAdIdAsString(currentAd._id)"
        [age]="currentAd.age.toString()"
        [state]="cardState"
        [swipeable]="true"
        (swipe)="onSwipe($event)"
        (actionClick)="onCardAction($event)"
        (mediaChange)="onMediaChange($event)"
      >
      </app-tinder-card>
    </div>

    <!-- Next Card Preview (for smooth transitions) -->
    <div class="next-card-preview" *ngIf="nextAd">
      <app-tinder-card
        [title]="nextAd.title"
        [subtitle]="getLocationString(nextAd)"
        [description]="nextAd.description"
        [media]="getCardMedia(nextAd)"
        [tags]="nextAd.tags"
        [itemId]="getAdIdAsString(nextAd._id)"
        [age]="nextAd.age.toString()"
        [swipeable]="false"
      >
      </app-tinder-card>
    </div>
  </div>

  <!-- Filters Dialog -->
  <ng-template #filtersDialog let-ref="dialogRef">
    <nb-card>
      <nb-card-header>
        <div class="dialog-header">
          <h5>
            <nb-icon icon="funnel-outline"></nb-icon>
            Filter Profiles
          </h5>
          <button nbButton ghost (click)="ref.close()">
            <nb-icon icon="close-outline"></nb-icon>
          </button>
        </div>
      </nb-card-header>
      <nb-card-body>
        <form [formGroup]="filterForm">
          <nb-form-field>
            <label>
              <nb-icon icon="pricetags-outline"></nb-icon>
              Category
            </label>
            <nb-select fullWidth formControlName="category">
              <nb-option value="">All Categories</nb-option>
              <nb-option value="Escort">Escort</nb-option>
              <nb-option value="Striptease">Striptease</nb-option>
              <nb-option value="Massage">Massage</nb-option>
              <nb-option value="Companion">Companion</nb-option>
              <nb-option value="Other">Other</nb-option>
            </nb-select>
          </nb-form-field>

          <nb-form-field>
            <label>
              <nb-icon icon="pin-outline"></nb-icon>
              Location
            </label>
            <nb-select fullWidth formControlName="location">
              <nb-option value="">All Locations</nb-option>
              <nb-option *ngFor="let county of counties" [value]="county">{{ county }}</nb-option>
            </nb-select>
          </nb-form-field>

          <nb-form-field>
            <label>
              <nb-icon icon="paper-plane-outline"></nb-icon>
              Touring Status
            </label>
            <nb-toggle formControlName="touringOnly">Show only touring profiles</nb-toggle>
          </nb-form-field>
        </form>
      </nb-card-body>
      <nb-card-footer>
        <div class="dialog-footer">
          <button nbButton status="basic" (click)="resetFilters()">
            <nb-icon icon="refresh-outline"></nb-icon>
            Reset
          </button>
          <button nbButton status="primary" (click)="applyFilters(); ref.close()">
            <nb-icon icon="checkmark-outline"></nb-icon>
            Apply Filters
          </button>
        </div>
      </nb-card-footer>
    </nb-card>
  </ng-template>
</app-main-layout>
