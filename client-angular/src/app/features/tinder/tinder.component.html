<app-main-layout activeView="tinder">
  <div class="tinder-container">
    <div class="tinder-header">
      <h1 class="tinder-title">Discover</h1>
      <div class="tinder-filters">
        <button class="filter-button" (click)="openFilters()">
          <i class="fas fa-sliders-h"></i> Filters
        </button>
      </div>
    </div>

    <!-- Loading State with Emerald SkeletonLoader -->
    <div class="loading-container" *ngIf="loading">
      <emerald-skeleton-loader type="card" [count]="1" [animated]="true" [layout]="'tinder'">
      </emerald-skeleton-loader>
      <p class="loading-text">Finding matches for you...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <div class="error-icon">
        <i class="fas fa-exclamation-circle"></i>
      </div>
      <p class="error-text">{{ error }}</p>
      <button class="retry-button" (click)="loadSwipeAds()">
        <i class="fas fa-redo"></i> Try Again
      </button>
    </div>

    <!-- Empty State -->
    <div class="empty-container" *ngIf="!loading && !error && (!ads || ads.length === 0)">
      <div class="empty-icon">
        <i class="fas fa-search"></i>
      </div>
      <p class="empty-text">No more profiles to show</p>
      <p class="empty-subtext">Try adjusting your filters or check back later</p>
    </div>

    <!-- Tinder Card Area -->
    <div class="swipe-area" *ngIf="!loading && !error && currentAd">
      <!-- Current Card -->
      <emerald-tinder-card
        [title]="currentAd.title"
        [subtitle]="currentAd.location"
        [description]="currentAd.description"
        [media]="getCardMedia(currentAd)"
        [tags]="currentAd.tags"
        [itemId]="currentAd._id"
        [age]="currentAd.age.toString()"
        [state]="cardState"
        [swipeable]="true"
        (swipe)="onSwipe($event)"
        (actionClick)="onCardAction($event)"
        (mediaChange)="onMediaChange($event)"
      >
      </emerald-tinder-card>
    </div>

    <!-- Next Card Preview (for smooth transitions) -->
    <div class="next-card-preview" *ngIf="nextAd">
      <emerald-tinder-card
        [title]="nextAd.title"
        [subtitle]="nextAd.location"
        [description]="nextAd.description"
        [media]="getCardMedia(nextAd)"
        [tags]="nextAd.tags"
        [itemId]="nextAd._id"
        [age]="nextAd.age.toString()"
        [swipeable]="false"
      >
      </emerald-tinder-card>
    </div>
  </div>

  <!-- Floating Action Button for Filters -->
  <emerald-floating-action-button
    icon="fa-sliders-h"
    label="Filters"
    color="primary"
    position="bottom-right"
    [showTooltip]="true"
    tooltipText="Filter Profiles"
    (buttonClick)="openFilters()"
  >
  </emerald-floating-action-button>

  <!-- Filters Modal -->
  <div
    class="modal fade"
    id="filtersModal"
    tabindex="-1"
    aria-labelledby="filtersModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="filtersModalLabel">
            <i class="fas fa-filter"></i> Filter Profiles
          </h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeFilters()"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="filterForm">
            <div class="mb-3">
              <label for="category" class="form-label"> <i class="fas fa-tag"></i> Category </label>
              <select class="form-select" id="category" formControlName="category">
                <option value="">All Categories</option>
                <option value="Escort">Escort</option>
                <option value="Striptease">Striptease</option>
                <option value="Massage">Massage</option>
                <option value="Companion">Companion</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="location" class="form-label">
                <i class="fas fa-map-marker-alt"></i> Location
              </label>
              <select class="form-select" id="location" formControlName="location">
                <option value="">All Locations</option>
                <option *ngFor="let county of counties" [value]="county">{{ county }}</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label d-block mb-2">
                <i class="fas fa-plane"></i> Touring Status
              </label>
              <!-- Using Emerald Toggle -->
              <emerald-toggle
                label="Show only touring profiles"
                labelPosition="right"
                color="primary"
                [formControl]="filterForm.get('touringOnly') as any"
              >
              </emerald-toggle>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="resetFilters()">
            <i class="fas fa-undo"></i> Reset
          </button>
          <button type="button" class="btn btn-secondary" (click)="closeFilters()">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="button" class="btn btn-primary" (click)="applyFilters()">
            <i class="fas fa-check"></i> Apply Filters
          </button>
        </div>
      </div>
    </div>
  </div>
</app-main-layout>
