<div class="chat-list-container">
  <!-- Header -->
  <div class="chat-list-header">
    <h4 class="chat-list-title">Messages</h4>
    <button nbButton status="primary" size="small" (click)="createNewChat()">
      <nb-icon icon="plus-outline"></nb-icon>
      <span>New Chat</span>
    </button>
  </div>

  <!-- Loading State -->
  <div class="state-container loading-state" *ngIf="loading">
    <nb-spinner status="primary" size="medium"></nb-spinner>
    <p>Loading conversations...</p>
  </div>

  <!-- Error State -->
  <div class="state-container error-state" *ngIf="error && !loading">
    <nb-icon icon="alert-circle-outline" status="danger" class="state-icon"></nb-icon>
    <p>Failed to load conversations</p>
    <button nbButton status="primary" outline size="small" (click)="loadRooms()">
      <nb-icon icon="refresh-outline"></nb-icon> Retry
    </button>
  </div>

  <!-- Empty State -->
  <div class="state-container empty-state" *ngIf="!loading && !error && rooms.length === 0">
    <nb-icon icon="message-square-outline" class="state-icon"></nb-icon>
    <p>No conversations yet</p>
    <button nbButton status="primary" size="small" (click)="createNewChat()">
      Start a new conversation
    </button>
  </div>

  <!-- Room List -->
  <nb-list class="room-list" *ngIf="!loading && !error && rooms.length > 0">
    <nb-list-item
      *ngFor="let room of rooms"
      class="room-item"
      [class.active]="room.id === selectedRoomId"
      (click)="goToRoom(room.id)"
    >
      <app-avatar
        [imageUrl]="room.avatar || '/assets/img/default-profile.jpg'"
        [name]="getOtherUserName(room)"
        [status]="isRoomOnline(room) ? 'online' : 'offline'"
        size="medium"
      >
      </app-avatar>
      <div class="room-details">
        <div class="room-header">
          <span class="room-name">{{ getOtherUserName(room) }}</span>
          <span class="room-time">{{ getLastMessageTime(room) | timeAgo }}</span>
        </div>
        <div class="room-message-preview">
          <p class="last-message-text">{{ getLastMessagePreview(room) }}</p>
          <nb-badge
            *ngIf="hasUnreadMessages(room)"
            [text]="room.unreadCount"
            status="primary"
            position="center-right"
            class="unread-indicator"
          >
          </nb-badge>
        </div>
      </div>
      <div class="room-actions">
        <button
          nbButton
          ghost
          size="tiny"
          nbTooltip="{{ room.pinned ? 'Unpin' : 'Pin' }}"
          (click)="togglePin($event, room)"
          [class.active]="room.pinned"
        >
          <nb-icon icon="pin-outline"></nb-icon>
        </button>
        <button nbButton ghost size="tiny" nbTooltip="Archive" (click)="archiveRoom($event, room)">
          <nb-icon icon="archive-outline"></nb-icon>
        </button>
      </div>
    </nb-list-item>
  </nb-list>
</div>
