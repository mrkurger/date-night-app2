<div class="chat-list-container">
  <!-- Header -->
  <div class="chat-list-header">
    <h4 class="chat-list-title">Messages</h4>
    <button pButton type="button" class="p-button-primary" (click)="createNewChat()">
      <i class="pi pi-plus"></i>
      <span>New Chat</span>
    </button>
  </div>

  <!-- Loading State -->
  <div class="state-container loading-state" *ngIf="loading">
    <p-progressSpinner [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
    <p>Loading conversations...</p>
  </div>

  <!-- Error State -->
  <div class="state-container error-state" *ngIf="error && !loading">
    <i class="pi pi-exclamation-circle text-danger" style="font-size: 2rem"></i>
    <p>Failed to load conversations</p>
    <button pButton type="button" class="p-button-outlined p-button-primary" (click)="loadRooms()">
      <i class="pi pi-refresh"></i> Retry
    </button>
  </div>

  <!-- Empty State -->
  <div class="state-container empty-state" *ngIf="!loading && !error && rooms.length === 0">
    <i class="pi pi-comments" style="font-size: 2rem"></i>
    <p>No conversations yet</p>
    <button pButton type="button" class="p-button-primary" (click)="createNewChat()">
      Start a new conversation
    </button>
  </div>

  <!-- Room List -->
  <p-dataView [value]="rooms" class="room-list" *ngIf="!loading && !error && rooms.length > 0">
    <ng-template let-room pTemplate="listItem">
      <div
        class="room-item p-d-flex"
        [class.active]="room.id === selectedRoomId"
        (click)="goToRoom(room.id)"
      >
        <app-avatar
          [imageUrl]="room.avatar || '/assets/img/default-profile.jpg'"
          [name]="getOtherUserName(room)"
          [status]="isRoomOnline(room) ? 'online' : 'offline'"
          size="medium"
        >
        </app-avatar>

        <div class="room-details p-d-flex p-flex-column p-flex-grow-1">
          <div class="room-header p-d-flex p-jc-between">
            <span class="room-name">{{ getOtherUserName(room) }}</span>
            <span class="room-time">{{ getLastMessageTime(room) | timeAgo }}</span>
          </div>
          <div class="room-message-preview p-d-flex p-ai-center p-jc-between">
            <p class="last-message-text">{{ getLastMessagePreview(room) }}</p>
            <p-badge
              *ngIf="hasUnreadMessages(room)"
              [value]="room.unreadCount.toString()"
              severity="primary"
            >
            </p-badge>
          </div>
        </div>

        <div class="room-actions p-d-flex">
          <button
            pButton
            type="button"
            class="p-button-text p-button-rounded p-button-sm"
            [pTooltip]="room.pinned ? 'Unpin' : 'Pin'"
            (click)="togglePin($event, room)"
            [class.active]="room.pinned"
          >
            <i class="pi" [class.pi-star-fill]="room.pinned" [class.pi-star]="!room.pinned"></i>
          </button>
          <button
            pButton
            type="button"
            class="p-button-text p-button-rounded p-button-sm"
            pTooltip="Archive"
            (click)="archiveRoom($event, room)"
          >
            <i class="pi pi-inbox"></i>
          </button>
        </div>
      </div>
    </ng-template>
  </p-dataView>
</div>
