<div class="revenue-analytics">
  <p-card>
    <nb-card-header class="d-flex justify-content-between align-items-center">
      <h5>Revenue Analytics</h5>
      <div>
        <nb-select [(ngModel)]="selectedPeriod" (selectedChange)="onPeriodChange()">
          <nb-option value="day">Today</nb-option>
          <nb-option value="week">This Week</nb-option>
          <nb-option value="month">This Month</nb-option>
          <nb-option value="year">This Year</nb-option>
        </nb-select>
      </div>
    </nb-card-header>

    <nb-card-body>
      <div class="row">
        <div class="col-md-4">
          <p-card>
            <nb-card-body>
              <div class="stat-card">
                <div class="stat-title">Total Revenue</div>
                <div class="stat-value">${{ totalRevenue | number: '1.2-2' }}</div>
                <div
                  class="stat-delta"
                  [class.positive]="revenueDelta > 0"
                  [class.negative]="revenueDelta < 0"
                >
                  {{ revenueDelta > 0 ? '+' : '' }}{{ revenueDelta }}%
                </div>
              </div>
            </nb-card-body>
          </nb-card>
        </div>

        <div class="col-md-4">
          <p-card>
            <nb-card-body>
              <div class="stat-card">
                <div class="stat-title">Active Subscriptions</div>
                <div class="stat-value">{{ activeSubscriptions }}</div>
                <div
                  class="stat-delta"
                  [class.positive]="subscriptionDelta > 0"
                  [class.negative]="subscriptionDelta < 0"
                >
                  {{ subscriptionDelta > 0 ? '+' : '' }}{{ subscriptionDelta }}
                </div>
              </div>
            </nb-card-body>
          </nb-card>
        </div>

        <div class="col-md-4">
          <p-card>
            <nb-card-body>
              <div class="stat-card">
                <div class="stat-title">Average Revenue Per User</div>
                <div class="stat-value">${{ arpu | number: '1.2-2' }}</div>
                <div
                  class="stat-delta"
                  [class.positive]="arpuDelta > 0"
                  [class.negative]="arpuDelta < 0"
                >
                  {{ arpuDelta > 0 ? '+' : '' }}{{ arpuDelta }}%
                </div>
              </div>
            </nb-card-body>
          </nb-card>
        </div>
      </div>

      <nb-tabset>
        <nb-tab tabTitle="Revenue Trend">
          <div class="chart-container">
            <ngx-charts-line-chart
              [results]="revenueTrend"
              [gradient]="true"
              [xAxis]="true"
              [yAxis]="true"
              [legend]="true"
              [showXAxisLabel]="true"
              [showYAxisLabel]="true"
              xAxisLabel="Date"
              yAxisLabel="Revenue ($)"
              [autoScale]="true"
              [timeline]="true"
            >
            </ngx-charts-line-chart>
          </div>
        </nb-tab>

        <nb-tab tabTitle="Revenue by Plan">
          <div class="chart-container">
            <ngx-charts-pie-chart
              [results]="revenueByPlan"
              [gradient]="true"
              [legend]="true"
              [labels]="true"
              [doughnut]="true"
            >
            </ngx-charts-pie-chart>
          </div>
        </nb-tab>

        <nb-tab tabTitle="Churn Rate">
          <div class="chart-container">
            <ngx-charts-bar-vertical
              [results]="churnRate"
              [gradient]="true"
              [xAxis]="true"
              [yAxis]="true"
              [showXAxisLabel]="true"
              [showYAxisLabel]="true"
              xAxisLabel="Month"
              yAxisLabel="Churn Rate (%)"
            >
            </ngx-charts-bar-vertical>
          </div>
        </nb-tab>
      </nb-tabset>
    </nb-card-body>
  </nb-card>
</div>
