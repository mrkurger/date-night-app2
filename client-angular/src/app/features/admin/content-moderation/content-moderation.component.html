<div class="content-moderation">
  <div class="header">
    <h2>Content Moderation</h2>
    <p>Review and moderate user-submitted content</p>
  </div>
  
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3>Pending Media</h3>
      <button class="btn btn-primary" (click)="loadPendingMedia()">
        <i class="fa fa-refresh"></i> Refresh
      </button>
    </div>
    
    <div class="card-body">
      <div *ngIf="loading" class="text-center p-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      
      <div *ngIf="error" class="alert alert-danger">
        {{ error }}
      </div>
      
      <div *ngIf="!loading && !error && pendingMedia.length === 0" class="text-center p-4">
        <i class="fa fa-check-circle fa-3x text-success mb-3"></i>
        <h4>All caught up!</h4>
        <p>There are no media items pending moderation at this time.</p>
      </div>
      
      <div *ngIf="!loading && pendingMedia.length > 0">
        <div *ngFor="let ad of pendingMedia" class="ad-container mb-4">
          <div class="ad-header">
            <h4>{{ ad.title }}</h4>
            <p>Advertiser: {{ ad.advertiser.username }}</p>
          </div>
          
          <div class="media-grid">
            <div *ngFor="let media of ad.media" class="media-item" 
                 [ngClass]="{'pending': media.moderationStatus === 'pending'}">
              <div class="media-content">
                <div *ngIf="media.type === 'image'" class="image-container">
                  <img [src]="media.url" alt="Media">
                </div>
                <div *ngIf="media.type === 'video'" class="video-container">
                  <video controls>
                    <source [src]="media.url" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>
                </div>
              </div>
              
              <div class="media-info">
                <div class="media-type">
                  <i class="fa" [ngClass]="getMediaTypeIcon(media.type)"></i>
                  {{ media.type }}
                </div>
                
                <div class="media-status" 
                     [ngClass]="{'status-pending': media.moderationStatus === 'pending'}">
                  {{ media.moderationStatus }}
                </div>
                
                <div class="media-actions">
                  <button class="btn btn-primary" (click)="openModerationModal(ad, media)">
                    Moderate
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Moderation Modal -->
<div class="modal fade" id="moderationModal" tabindex="-1" aria-labelledby="moderationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="moderationModalLabel">Moderate Content</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="selectedMedia" class="row">
          <div class="col-md-6">
            <div class="media-preview">
              <div *ngIf="selectedMedia.type === 'image'" class="image-container">
                <img [src]="selectedMedia.url" alt="Media">
              </div>
              <div *ngIf="selectedMedia.type === 'video'" class="video-container">
                <video controls>
                  <source [src]="selectedMedia.url" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              </div>
            </div>
            
            <div class="media-details mt-3">
              <p><strong>Ad:</strong> {{ selectedMedia.adTitle }}</p>
              <p><strong>Type:</strong> {{ selectedMedia.type }}</p>
              <p><strong>Upload Date:</strong> {{ selectedMedia.uploadDate | date:'medium' }}</p>
            </div>
          </div>
          
          <div class="col-md-6">
            <form [formGroup]="moderationForm" (ngSubmit)="submitModeration()">
              <div class="mb-3">
                <label class="form-label">Moderation Decision</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" formControlName="status" id="statusApproved" value="approved">
                  <label class="form-check-label" for="statusApproved">
                    <i class="fa fa-check text-success"></i> Approve
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" formControlName="status" id="statusRejected" value="rejected">
                  <label class="form-check-label" for="statusRejected">
                    <i class="fa fa-times text-danger"></i> Reject
                  </label>
                </div>
              </div>
              
              <div class="mb-3" *ngIf="moderationForm.get('status')?.value === 'rejected'">
                <label for="notes" class="form-label">Rejection Reason</label>
                <textarea 
                  class="form-control" 
                  id="notes" 
                  rows="3" 
                  formControlName="notes"
                  placeholder="Provide a reason for rejection"
                ></textarea>
                <div *ngIf="moderationForm.get('notes')?.errors?.['maxlength']" class="text-danger">
                  Notes cannot exceed 500 characters
                </div>
              </div>
              
              <div class="moderation-guidelines">
                <h6>Content Guidelines</h6>
                <ul>
                  <li>No explicit nudity or pornographic content</li>
                  <li>No violence, hate speech, or illegal activities</li>
                  <li>No copyrighted material without permission</li>
                  <li>No misleading or deceptive content</li>
                  <li>Images must be clear and relevant to the ad</li>
                </ul>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="submitModeration()" [disabled]="moderationForm.invalid">
          Submit Decision
        </button>
      </div>
    </div>
  </div>
</div>