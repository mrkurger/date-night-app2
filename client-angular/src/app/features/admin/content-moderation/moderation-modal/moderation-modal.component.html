<div class="p-dialog-content">
  <!-- No separate header needed as it's moved to parent p-dialog -->
  <!-- Media Preview -->
  <div class="media-preview" *ngIf="media" [ngClass]="{ fullscreen: isFullscreen }">
    <!-- Media Error State -->
    <div *ngIf="mediaError" class="media-error">
      <i class="fas fa-exclamation-triangle"></i>
      <p>Unable to load media content</p>
      <small>The media may be unavailable or in an unsupported format</small>
    </div>

    <!-- Image Preview -->
    <img
      *ngIf="!mediaError && media.type === 'image'"
      [src]="safeMediaUrl"
      alt="Content preview"
      (error)="onMediaError()"
    />

    <!-- Video Preview -->
    <video
      *ngIf="!mediaError && media.type === 'video'"
      [src]="safeMediaUrl"
      controls
      (error)="onMediaError()"
    ></video>

    <!-- Fullscreen Toggle -->
    <button class="fullscreen-toggle" (click)="toggleFullscreen()" *ngIf="!mediaError">
      <i class="fas" [ngClass]="isFullscreen ? 'fa-compress' : 'fa-expand'"></i>
    </button>
  </div>

  <!-- Media Information -->
  <div class="media-info" *ngIf="media">
    <div class="media-detail">
      <label>Ad Title:</label>
      <span>{{ media.adTitle }}</span>
    </div>
    <div class="media-detail">
      <label>Media Type:</label>
      <span>{{ media.type | titlecase }}</span>
    </div>
    <div class="media-detail">
      <label>Uploaded:</label>
      <span>{{ media.createdAt | date: 'medium' }}</span>
    </div>
  </div>

  <!-- Moderation Form -->
  <form [formGroup]="form" class="moderation-form">
    <div class="p-field">
      <label class="p-mb-2">Moderation Decision</label>
      <div class="p-d-flex p-jc-between p-mb-3">
        <p-button
          styleClass="p-button-outlined p-button-success status-option"
          [ngClass]="{ 'p-button-active': form.get('status')?.value === 'approved' }"
          (onClick)="form.get('status')?.setValue('approved')"
          label="Approve"
          icon="fas fa-check-circle"
        >
          <ng-template pTemplate="content">
            <div class="status-option-content">
              <i class="fas fa-check-circle p-mr-2"></i>
              <div>
                <div class="status-label">Approve</div>
                <small>Content meets platform guidelines</small>
              </div>
            </div>
          </ng-template>
        </p-button>

        <p-button
          styleClass="p-button-outlined p-button-danger status-option"
          [ngClass]="{ 'p-button-active': form.get('status')?.value === 'rejected' }"
          (onClick)="form.get('status')?.setValue('rejected')"
          label="Reject"
          icon="fas fa-times-circle"
        >
          <ng-template pTemplate="content">
            <div class="status-option-content">
              <i class="fas fa-times-circle p-mr-2"></i>
              <div>
                <div class="status-label">Reject</div>
                <small>Content violates platform guidelines</small>
              </div>
            </div>
          </ng-template>
        </p-button>
      </div>
    </div>

    <div class="p-field notes-field">
      <label class="p-mb-2">Moderation Notes</label>
      <textarea
        pInputTextarea
        formControlName="notes"
        rows="4"
        [autoResize]="true"
        placeholder="Provide detailed explanation for your decision..."
      ></textarea>
      <div
        class="p-d-flex p-jc-end p-mt-1 char-count"
        [ngClass]="{
          'p-text-warning': form.get('notes')?.value?.length > 400,
          'p-text-danger': form.get('notes')?.value?.length > 450,
        }"
      >
        {{ form.get('notes')?.value?.length || 0 }}/500 characters
      </div>
      <small class="p-error" *ngIf="form.get('notes')?.invalid && form.get('notes')?.touched">
        Notes are required and must be less than 500 characters.
      </small>
    </div>
  </form>

  <!-- Moderation Guidelines -->
  <div class="moderation-guidelines">
    <h5><i class="fas fa-info-circle"></i> Moderation Guidelines</h5>
    <ul>
      <li>
        <strong>Reject</strong> content that contains explicit nudity, violence, or illegal
        activities
      </li>
      <li><strong>Reject</strong> content that includes minors in inappropriate contexts</li>
      <li><strong>Reject</strong> content that contains personally identifiable information</li>
      <li><strong>Approve</strong> content that follows platform guidelines for adult content</li>
      <li>Always provide clear notes explaining your decision, especially for rejections</li>
    </ul>
  </div>
</div>

<div class="p-dialog-footer">
  <p-button
    label="Cancel"
    icon="fas fa-times"
    styleClass="p-button-secondary"
    (onClick)="onClose.emit()"
  >
  </p-button>
  <p-button
    *ngIf="form.get('status')?.value === 'rejected'"
    label="Reject Content"
    icon="fas fa-ban"
    styleClass="p-button-danger"
    [disabled]="form.invalid"
    (onClick)="validateAndSubmit()"
  >
  </p-button>
  <p-button
    *ngIf="form.get('status')?.value === 'approved'"
    label="Approve Content"
    icon="fas fa-check"
    styleClass="p-button-success"
    [disabled]="form.invalid"
    (onClick)="validateAndSubmit()"
  >
  </p-button>
</div>
