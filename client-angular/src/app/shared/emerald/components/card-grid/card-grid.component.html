<!-- Emerald CardGrid Component -->
<!-- Documentation: https://docs-emerald.condorlabs.io/CardGrid -->

<!-- Loading State -->
<div *ngIf="loading" class="nb-card-grid" [ngStyle]="getGridStyle()">
  <div
    *ngFor="let i of getSkeletonArray()"
    class="nb-card-grid__item"
    [ngClass]="{ 'nb-card-grid__item--animated': animated }"
  >
    <nb-skeleton type="card" [animated]="true"></nb-skeleton>
  </div>
</div>

<!-- Netflix Layout -->
<div *ngIf="!loading && layout === 'netflix'" class="nb-card-grid nb-card-grid--netflix">
  <div class="nb-card-grid__netflix-row">
    <div class="nb-card-grid__netflix-items">
      <div
        *ngFor="let item of items"
        class="nb-card-grid__item nb-card-grid__item--netflix"
        [ngClass]="{ 'nb-card-grid__item--animated': animated }"
        [style.margin-right.px]="gap"
        (click)="onItemClick(item)"
      >
        <ng-container *ngIf="itemTemplate; else defaultTemplate">
          <ng-container
            *ngTemplateOutlet="itemTemplate; context: { $implicit: item }"
          ></ng-container>
        </ng-container>
        <ng-template #defaultTemplate>
          <nb-card
            *ngIf="item.title"
            [title]="item.title"
            [subtitle]="item.subtitle"
            [description]="item.description"
            [imageUrl]="item.imageUrl"
            [avatarUrl]="item.avatarUrl"
            [avatarName]="item.avatarName"
            [isOnline]="item.isOnline"
            [tags]="item.tags"
            [actions]="item.actions"
            [itemId]="item.id"
            [layout]="cardLayout"
            (click)="handleCardClick(item.id)"
            (actionClick)="handleActionClick($event)"
          ></nb-card>
          <div *ngIf="!item.title" class="nb-card-grid__default-item">
            {{ item.name || item.label || 'Item' }}
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Grid or Masonry Layout -->
<div
  *ngIf="!loading && layout !== 'netflix'"
  class="nb-card-grid"
  [ngClass]="{ 'nb-card-grid--masonry': layout === 'masonry' }"
  [ngStyle]="getGridStyle()"
>
  <div
    *ngFor="let item of items"
    class="nb-card-grid__item"
    [ngClass]="{
      'nb-card-grid__item--animated': animated,
      'nb-card-grid__item--masonry': layout === 'masonry',
    }"
    (click)="onItemClick(item)"
  >
    <ng-container *ngIf="itemTemplate; else defaultTemplate">
      <ng-container *ngTemplateOutlet="itemTemplate; context: { $implicit: item }"></ng-container>
    </ng-container>
    <ng-template #defaultTemplate>
      <nb-card
        *ngIf="item.title"
        [title]="item.title"
        [subtitle]="item.subtitle"
        [description]="item.description"
        [imageUrl]="item.imageUrl"
        [avatarUrl]="item.avatarUrl"
        [avatarName]="item.avatarName"
        [isOnline]="item.isOnline"
        [tags]="item.tags"
        [actions]="item.actions"
        [itemId]="item.id"
        [layout]="cardLayout"
        (click)="handleCardClick(item.id)"
        (actionClick)="handleActionClick($event)"
      ></nb-card>
      <div *ngIf="!item.title" class="nb-card-grid__default-item">
        {{ item.name || item.label || 'Item' }}
      </div>
    </ng-template>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!loading && items.length === 0" class="nb-card-grid__empty">
  <div class="nb-card-grid__empty-content">
    <i class="fas fa-search"></i>
    <p>No items found</p>
  </div>
</div>
