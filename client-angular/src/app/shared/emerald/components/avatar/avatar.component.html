<!-- Avatar Component -->
<!-- Using Nebular components -->

<div class="nb-user-container">
  <div
    class="nb-user"
    [ngClass]="{
      'nb-user--small': size === 'small',
      'nb-user--medium': size === 'medium',
      'nb-user--large': size === 'large',
    }"
    (click)="toggleDropdown($event)"
  >
    <!-- Avatar Image -->
    <img
      *ngIf="imageUrl"
      [src]="imageUrl"
      [alt]="name || 'User avatar'"
      class="nb-user__image"
      (error)="onImageError($event)"
    />

    <!-- Fallback to Initials -->
    <span class="nb-user__initials" *ngIf="!imageUrl">{{ getInitials() }}</span>

    <!-- Online Status Indicator -->
    <span
      *ngIf="isOnline !== undefined"
      class="nb-user__status"
      [ngClass]="{
        'nb-user__status--online': isOnline,
        'nb-user__status--offline': !isOnline,
      }"
    >
    </span>

    <!-- Dropdown Toggle Indicator -->
    <span *ngIf="showDropdown" class="nb-user__dropdown-indicator">
      <nb-icon [icon]="isDropdownOpen ? 'chevron-up-outline' : 'chevron-down-outline'" size="tiny">
      </nb-icon>
    </span>
  </div>

  <!-- Dropdown Menu -->
  <nb-context-menu
    *ngIf="showDropdown"
    [items]="contextMenuItems"
    [class.hidden]="!isDropdownOpen"
    (close)="closeDropdown()"
    (click)="$event.stopPropagation()"
  >
  </nb-context-menu>

  <!-- Custom Dropdown Menu (fallback for complex items) -->
  <div *ngIf="showDropdown && isDropdownOpen && !useNebularContextMenu" class="nb-user__dropdown">
    <div class="nb-user__dropdown-arrow"></div>

    <ul class="nb-user__dropdown-menu">
      <ng-container *ngFor="let item of dropdownItems">
        <!-- Divider -->
        <li *ngIf="item.divider" class="nb-user__dropdown-divider"></li>

        <!-- Menu Item -->
        <li *ngIf="!item.divider" class="nb-user__dropdown-item">
          <a
            *ngIf="item.route"
            [routerLink]="item.route"
            class="nb-user__dropdown-link"
            (click)="onItemClick(item, $event)"
          >
            <nb-icon
              *ngIf="item.icon"
              [icon]="getIconName(item.icon)"
              class="nb-user__dropdown-icon"
            >
            </nb-icon>
            <span class="nb-user__dropdown-label">{{ item.label }}</span>
          </a>

          <button
            *ngIf="!item.route"
            class="nb-user__dropdown-button"
            (click)="onItemClick(item, $event)"
          >
            <nb-icon
              *ngIf="item.icon"
              [icon]="getIconName(item.icon)"
              class="nb-user__dropdown-icon"
            >
            </nb-icon>
            <span class="nb-user__dropdown-label">{{ item.label }}</span>
          </button>
        </li>
      </ng-container>
    </ul>
  </div>
</div>
