<!-- Emerald Avatar Component -->
<!-- Documentation: https://docs-emerald.condorlabs.io/Avatar -->

<div class="emerald-avatar-container">
  <div
    class="emerald-avatar"
    [ngClass]="{
      'emerald-avatar--small': size === 'small',
      'emerald-avatar--medium': size === 'medium',
      'emerald-avatar--large': size === 'large',
    }"
    (click)="toggleDropdown($event)"
  >
    <!-- Avatar Image -->
    <img
      *ngIf="imageUrl"
      [src]="imageUrl"
      [alt]="name || 'User avatar'"
      class="emerald-avatar__image"
      (error)="onImageError($event)"
    />

    <!-- Fallback to Initials -->
    <span class="emerald-avatar__initials" *ngIf="!imageUrl">{{ getInitials() }}</span>

    <!-- Online Status Indicator -->
    <span
      *ngIf="isOnline !== undefined"
      class="emerald-avatar__status"
      [ngClass]="{
        'emerald-avatar__status--online': isOnline,
        'emerald-avatar__status--offline': !isOnline,
      }"
    >
    </span>

    <!-- Dropdown Toggle Indicator -->
    <span *ngIf="showDropdown" class="emerald-avatar__dropdown-indicator">
      <i
        class="fas"
        [ngClass]="{ 'fa-chevron-down': !isDropdownOpen, 'fa-chevron-up': isDropdownOpen }"
      ></i>
    </span>
  </div>

  <!-- Dropdown Menu -->
  <div *ngIf="showDropdown && isDropdownOpen" class="emerald-avatar__dropdown">
    <div class="emerald-avatar__dropdown-arrow"></div>

    <ul class="emerald-avatar__dropdown-menu">
      <ng-container *ngFor="let item of dropdownItems">
        <!-- Divider -->
        <li *ngIf="item.divider" class="emerald-avatar__dropdown-divider"></li>

        <!-- Menu Item -->
        <li *ngIf="!item.divider" class="emerald-avatar__dropdown-item">
          <a
            *ngIf="item.route"
            [routerLink]="item.route"
            class="emerald-avatar__dropdown-link"
            (click)="onItemClick(item, $event)"
          >
            <i *ngIf="item.icon" class="emerald-avatar__dropdown-icon {{ item.icon }}"></i>
            <span class="emerald-avatar__dropdown-label">{{ item.label }}</span>
          </a>

          <button
            *ngIf="!item.route"
            class="emerald-avatar__dropdown-button"
            (click)="onItemClick(item, $event)"
          >
            <i *ngIf="item.icon" class="emerald-avatar__dropdown-icon {{ item.icon }}"></i>
            <span class="emerald-avatar__dropdown-label">{{ item.label }}</span>
          </button>
        </li>
      </ng-container>
    </ul>
  </div>
</div>
