<!-- AppCard Component using Nebular UI -->

<nb-card
  [ngClass]="{
    'nb-card-tinder': layout === 'tinder',
    'nb-card-netflix': layout === 'netflix',
    'nb-card-list': layout === 'list',
  }"
  (click)="onViewDetails()"
>
  <!-- Card Background Image -->
  <div class="nb-card-media" [style.background-image]="'url(' + backgroundImageUrl + ')'">
    <!-- Online/Offline Status Badge -->
    <nb-badge
      [text]="isOnline ? 'Online' : 'Offline'"
      [status]="isOnline ? 'success' : 'danger'"
      position="top-left"
      class="status-badge"
    ></nb-badge>

    <!-- Media Navigation Dots -->
    <div class="nb-card-media-dots" *ngIf="getMediaCount() > 1">
      <div
        *ngFor="let dot of getMediaDots(); let i = index"
        class="nb-card-media-dot"
        [ngClass]="{ 'nb-card-media-dot-active': i === currentMediaIndex }"
        (click)="
          $event.stopPropagation(); currentMediaIndex = i; backgroundImageUrl = getCurrentMediaUrl()
        "
      ></div>
    </div>

    <!-- Media Navigation Buttons -->
    <button
      *ngIf="getMediaCount() > 1"
      nbButton
      ghost
      size="small"
      class="nb-card-media-nav nb-card-media-nav-prev"
      (click)="prevMedia($event)"
      aria-label="Previous image"
    >
      <nb-icon icon="chevron-left-outline"></nb-icon>
    </button>
    <button
      *ngIf="getMediaCount() > 1"
      nbButton
      ghost
      size="small"
      class="nb-card-media-nav nb-card-media-nav-next"
      (click)="nextMedia($event)"
      aria-label="Next image"
    >
      <nb-icon icon="chevron-right-outline"></nb-icon>
    </button>

    <!-- Content Overlay with Blur Effect -->
    <div class="nb-card-content-overlay">
      <nb-card-body class="nb-card-content">
        <h3 class="nb-card-title" *ngIf="ad">{{ ad.title }}</h3>
        <h3 class="nb-card-title" *ngIf="!ad">Untitled</h3>

        <div class="nb-card-meta" *ngIf="ad">
          <div class="nb-card-location" *ngIf="ad.location">
            <nb-icon icon="map-outline"></nb-icon>
            <span>{{ ad.location }}</span>
          </div>

          <div class="nb-card-price" *ngIf="ad.price">
            <nb-icon icon="pricetags-outline"></nb-icon>
            <span>{{ formatPrice(ad.price) }}</span>
          </div>
        </div>

        <p class="nb-card-description" *ngIf="ad && showDescription && ad.description">
          {{ getTruncatedDescription() }}
        </p>
      </nb-card-body>
    </div>
  </div>

  <!-- Card Actions -->
  <nb-card-footer class="nb-card-actions" *ngIf="showActions">
    <!-- Bottom Left Floating Action Button -->
    <button
      nbButton
      status="primary"
      shape="round"
      class="nb-card-fab nb-card-fab-left"
      (click)="onLike($event)"
      aria-label="Like"
    >
      <nb-icon icon="heart-outline"></nb-icon>
    </button>

    <!-- Bottom Right Floating Action Button -->
    <button
      nbButton
      status="info"
      shape="round"
      class="nb-card-fab nb-card-fab-right"
      (click)="onChat($event)"
      aria-label="Chat"
    >
      <nb-icon icon="message-circle-outline"></nb-icon>
    </button>

    <!-- Tinder-specific Swipe Actions -->
    <div class="nb-card-swipe-actions" *ngIf="layout === 'tinder'">
      <button
        nbButton
        status="danger"
        shape="round"
        class="nb-card-swipe-button nb-card-swipe-button-left"
        (click)="onSwipe('left', $event)"
        aria-label="Swipe left"
      >
        <nb-icon icon="close-outline"></nb-icon>
      </button>
      <button
        nbButton
        status="success"
        shape="round"
        class="nb-card-swipe-button nb-card-swipe-button-right"
        (click)="onSwipe('right', $event)"
        aria-label="Swipe right"
      >
        <nb-icon icon="heart-outline"></nb-icon>
      </button>
    </div>
  </nb-card-footer>
</nb-card>
