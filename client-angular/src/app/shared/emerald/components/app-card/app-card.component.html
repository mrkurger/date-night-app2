<!-- AppCard Component using PrimeNG UI -->

<p-card
  [ngClass]="{
    'p-card-tinder': layout === 'tinder',
    'p-card-netflix': layout === 'netflix',
    'p-card-list': layout === 'list',
  }"
  (click)="onViewDetails()"
>
  <!-- Card Background Image -->
  <div class="p-card-media" [style.background-image]="'url(' + backgroundImageUrl + ')'">
    <!-- Online/Offline Status Badge -->
    <p-badge
      [value]="isOnline ? 'Online' : 'Offline'"
      [severity]="isOnline ? 'success' : 'danger'"
      class="status-badge"
    ></p-badge>

    <!-- Media Navigation Dots -->
    <div class="p-card-media-dots" *ngIf="getMediaCount() > 1">
      <div
        *ngFor="let dot of getMediaDots(); let i = index"
        class="p-card-media-dot"
        [ngClass]="{ 'p-card-media-dot-active': i === currentMediaIndex }"
        (click)="
          $event.stopPropagation(); currentMediaIndex = i; backgroundImageUrl = getCurrentMediaUrl()
        "
      ></div>
    </div>

    <!-- Media Navigation Buttons -->
    <p-button
      *ngIf="getMediaCount() > 1"
      [outlined]="true"
      [rounded]="true"
      size="small"
      class="p-card-media-nav p-card-media-nav-prev"
      (onClick)="prevMedia($event)"
      icon="pi pi-chevron-left"
      aria-label="Previous image"
    ></p-button>
    <p-button
      *ngIf="getMediaCount() > 1"
      [outlined]="true"
      [rounded]="true"
      size="small"
      class="p-card-media-nav p-card-media-nav-next"
      (onClick)="nextMedia($event)"
      icon="pi pi-chevron-right"
      aria-label="Next image"
    ></p-button>

    <!-- Content Overlay with Blur Effect -->
    <div class="p-card-content-overlay">
      <div class="p-card-content">
        <h3 class="p-card-title" *ngIf="ad">{{ ad.title }}</h3>
        <h3 class="p-card-title" *ngIf="!ad">Untitled</h3>

        <div class="p-card-meta" *ngIf="ad">
          <div class="p-card-location" *ngIf="ad.location">
            <i class="pi pi-map-marker"></i>
            <span>{{ ad.location }}</span>
          </div>

          <div class="p-card-price" *ngIf="ad.price">
            <i class="pi pi-tag"></i>
            <span>{{ formatPrice(ad.price) }}</span>
          </div>
        </div>

        <p class="p-card-description" *ngIf="ad && showDescription && ad.description">
          {{ getTruncatedDescription() }}
        </p>
      </div>
    </div>
  </div>

  <!-- Card Actions -->
  <ng-template pTemplate="footer" *ngIf="showActions">
    <div class="p-card-actions">
      <!-- Bottom Left Floating Action Button -->
      <p-button
        [rounded]="true"
        severity="primary"
        class="p-card-fab p-card-fab-left"
        (onClick)="onLike($event)"
        icon="pi pi-heart"
        aria-label="Like"
      ></p-button>

      <!-- Bottom Right Floating Action Button -->
      <p-button
        [rounded]="true"
        severity="info"
        class="p-card-fab p-card-fab-right"
        (onClick)="onShare($event)"
        icon="pi pi-share-alt"
        aria-label="Share"
      ></p-button>

      <!-- View Details Button -->
      <p-button
        [rounded]="true"
        class="p-card-action-btn"
        (onClick)="onViewDetails($event)"
        icon="pi pi-eye"
        aria-label="View Details"
      ></p-button>

      <!-- Chat Button -->
      <p-button
        [rounded]="true"
        severity="success"
        class="p-card-action-btn"
        (onClick)="onChat($event)"
        icon="pi pi-comments"
        aria-label="Chat"
      ></p-button>
    </div>
  </ng-template>
</p-card>
