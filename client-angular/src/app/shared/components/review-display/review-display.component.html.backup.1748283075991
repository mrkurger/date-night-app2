<p-card class="review-card" [class.pending]="review.status === 'pending'" >
  <!-- Review Header -->
  <p-card-header >
    <img
      nb-card-avatar
      [src]="review.reviewer.profileImage || '/assets/img/default-profile.jpg'"
      [alt]="review.reviewer.username"
    />
    <p-card-title >
      {{ review.title }}
      <span class="verified-badge" *ngIf="review.isVerifiedMeeting" nbTooltip="Verified Meeting">
        <nb-icon icon="verified"></nb-icon>
      </span>
    </nb-card-title>
    <p-card-subtitle >
      <span class="reviewer-name">{{ review.reviewer.username }}</span>
      <span class="review-date">{{ review.createdAt | timeAgo }}</span>

      <span class="status-badge" *ngIf="review.status === 'pending'"> Pending Approval </span>
    </nb-card-subtitle>

    <div class="review-rating">
      <app-star-rating
        [rating]="review.rating"
        [readonly]="true"
        [showRatingText]="true"
      ></app-star-rating>
    </div>
  </ng-template>

  <!-- Review Content -->
  <p-card-body >
    <div class="review-content">
      {{ review.content }}
    </div>

    <!-- Category Ratings -->
    <div
      class="category-ratings"
      *ngIf="
        hasCategoryRating('communication') ||
        hasCategoryRating('appearance') ||
        hasCategoryRating('location') ||
        hasCategoryRating('value')
      "
    >
      <h4>Category Ratings</h4>

      <div class="category-grid">
        <div class="category-item" *ngIf="hasCategoryRating('communication')">
          <div class="category-label">Communication</div>
          <app-star-rating
            [rating]="getCategoryRating('communication')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('appearance')">
          <div class="category-label">Appearance</div>
          <app-star-rating
            [rating]="getCategoryRating('appearance')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('location')">
          <div class="category-label">Location</div>
          <app-star-rating
            [rating]="getCategoryRating('location')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('value')">
          <div class="category-label">Value</div>
          <app-star-rating
            [rating]="getCategoryRating('value')"
            [readonly]="true"
            [small]="true"
          ></app-star-rating>
        </div>
      </div>
    </div>

    <!-- Meeting Date -->
    <div class="meeting-date" *ngIf="review.isVerifiedMeeting && review.meetingDate">
      <nb-icon icon="event"></nb-icon>
      <span>Met on {{ review.meetingDate | date: 'mediumDate' }}</span>
    </div>

    <!-- Advertiser Response -->
    <div class="advertiser-response" *ngIf="review.advertiserResponse">
      <nb-divider></nb-divider>
      <div class="response-header">
        <img
          class="response-avatar"
          [src]="review.advertiser.profileImage || '/assets/img/default-profile.jpg'"
          [alt]="review.advertiser.username"
        />
        <div class="response-meta">
          <div class="response-name">
            <strong>Response from {{ review.advertiser.username }}</strong>
          </div>
          <div class="response-date">{{ review.advertiserResponse.date | timeAgo }}</div>
        </div>
      </div>
      <div class="response-content">
        {{ review.advertiserResponse.content }}
      </div>
    </div>
  </ng-template>

  <!-- Review Actions -->
  <p-card-actions *ngIf="showActions && review.status === 'approved'" >
    <button nbButton
      color="primary"
      (click)="onMarkHelpful()"
      [disabled]="isCurrentUserReviewer"
      nbTooltip="Mark this review as helpful"
    >
      <nb-icon icon="thumb_up"></nb-icon>
      Helpful ({{ review.helpfulVotes }})
    </button>

    <button nbButton
      color="warn"
      (click)="onReportReview()"
      [disabled]="isCurrentUserReviewer"
      nbTooltip="Report this review"
    >
      <nb-icon icon="flag"></nb-icon>
      Report
    </button>

    <span class="spacer"></span>

    <!-- Advertiser Actions -->
    <button nbButton
      color="primary"
      *ngIf="isCurrentUserAdvertiser && !review.advertiserResponse"
      (click)="onRespondToReview()"
      nbTooltip="Respond to this review"
    >
      <nb-icon icon="reply"></nb-icon>
      Respond
    </button>

    <!-- Reviewer Actions -->
    <button nbButton
      color="primary"
      *ngIf="isCurrentUserReviewer"
      (click)="onEditReview()"
      nbTooltip="Edit your review"
    >
      <nb-icon icon="edit"></nb-icon>
      Edit
    </button>

    <button nbButton
      color="warn"
      *ngIf="isCurrentUserReviewer"
      (click)="onDeleteReview()"
      nbTooltip="Delete your review"
    >
      <nb-icon icon="delete"></nb-icon>
      Delete
    </button>
  </ng-template>
</p-card>
