<p-card class="review-card" [class.pending]="review.status === 'pending'">
  <!-- Review Header -->
  <ng-template pTemplate="header">
    <img
      class="card-avatar"
      [src]="review.reviewer.profileImage || '/assets/img/default-profile.jpg'"
      [alt]="review.reviewer.username"
    />
    <div class="card-title">
      {{ review.title }}
      <span class="verified-badge" *ngIf="review.isVerifiedMeeting" pTooltip="Verified Meeting">
        <i class="pi pi-verified"></i>
      </span>
    </div>
    <div class="card-subtitle">
      <span class="reviewer-name">{{ review.reviewer.username }}</span>
      <span class="review-date">{{ review.createdAt | timeAgo }}</span>

      <span class="status-badge" *ngIf="review.status === 'pending'"> Pending Approval </span>
    </div>

    <div class="review-rating">
      <p-rating [ngModel]="review.rating" [readonly]="true" [stars]="5" [cancel]="false">
      </p-rating>
      <span class="rating-text">{{ review.rating }}/5</span>
    </div>
  </ng-template>

  <!-- Review Content -->
  <ng-template pTemplate="content">
    <div class="review-content">
      {{ review.content }}
    </div>

    <!-- Category Ratings -->
    <div
      class="category-ratings"
      *ngIf="
        hasCategoryRating('communication') ||
        hasCategoryRating('appearance') ||
        hasCategoryRating('location') ||
        hasCategoryRating('value')
      "
    >
      <h4>Category Ratings</h4>

      <div class="category-grid">
        <div class="category-item" *ngIf="hasCategoryRating('communication')">
          <div class="category-label">Communication</div>
          <p-rating
            [ngModel]="getCategoryRating('communication')"
            [readonly]="true"
            [stars]="5"
            [cancel]="false"
            styleClass="small-rating"
          >
          </p-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('appearance')">
          <div class="category-label">Appearance</div>
          <p-rating
            [ngModel]="getCategoryRating('appearance')"
            [readonly]="true"
            [stars]="5"
            [cancel]="false"
            styleClass="small-rating"
          >
          </p-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('location')">
          <div class="category-label">Location</div>
          <p-rating
            [ngModel]="getCategoryRating('location')"
            [readonly]="true"
            [stars]="5"
            [cancel]="false"
            styleClass="small-rating"
          >
          </p-rating>
        </div>

        <div class="category-item" *ngIf="hasCategoryRating('value')">
          <div class="category-label">Value</div>
          <p-rating
            [ngModel]="getCategoryRating('value')"
            [readonly]="true"
            [stars]="5"
            [cancel]="false"
            styleClass="small-rating"
          >
          </p-rating>
        </div>
      </div>
    </div>

    <!-- Meeting Date -->
    <div class="meeting-date" *ngIf="review.isVerifiedMeeting && review.meetingDate">
      <i class="pi pi-event"></i>
      <span>Met on {{ review.meetingDate | date: 'mediumDate' }}</span>
    </div>

    <!-- Advertiser Response -->
    <div class="advertiser-response" *ngIf="review.advertiserResponse">
      <p-divider></p-divider>
      <div class="response-header">
        <img
          class="response-avatar"
          [src]="review.advertiser.profileImage || '/assets/img/default-profile.jpg'"
          [alt]="review.advertiser.username"
        />
        <div class="response-meta">
          <div class="response-name">
            <strong>Response from {{ review.advertiser.username }}</strong>
          </div>
          <div class="response-date">{{ review.advertiserResponse.date | timeAgo }}</div>
        </div>
      </div>
      <div class="response-content">
        {{ review.advertiserResponse.content }}
      </div>
    </div>
  </ng-template>

  <!-- Review Actions -->
  <ng-template pTemplate="footer" *ngIf="showActions && review.status === 'approved'">
    <p-button
      label="Helpful ({{ review.helpfulVotes }})"
      icon="pi pi-thumbs-up"
      (click)="onMarkHelpful()"
      [disabled]="isCurrentUserReviewer"
      pTooltip="Mark this review as helpful"
    >
    </p-button>

    <p-button
      label="Report"
      icon="pi pi-flag"
      severity="danger"
      (click)="onReportReview()"
      [disabled]="isCurrentUserReviewer"
      pTooltip="Report this review"
    >
    </p-button>

    <span class="spacer"></span>

    <!-- Advertiser Actions -->
    <p-button
      label="Respond"
      icon="pi pi-reply"
      *ngIf="isCurrentUserAdvertiser && !review.advertiserResponse"
      (click)="onRespondToReview()"
      pTooltip="Respond to this review"
    >
    </p-button>

    <!-- Reviewer Actions -->
    <p-button
      label="Edit"
      icon="pi pi-pencil"
      *ngIf="isCurrentUserReviewer"
      (click)="onEditReview()"
      pTooltip="Edit your review"
    >
    </p-button>

    <p-button
      label="Delete"
      icon="pi pi-trash"
      severity="danger"
      *ngIf="isCurrentUserReviewer"
      (click)="onDeleteReview()"
      pTooltip="Delete your review"
    >
    </p-button>
  </ng-template>
</p-card>
