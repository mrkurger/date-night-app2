<div class="onboarding-overlay" *ngIf="isVisible">
  <div class="onboarding-modal" [attr.data-step]="currentStepIndex + 1">
    <div class="onboarding-header">
      <h2 class="onboarding-title">{{ currentStep.title }}</h2>
      <button class="onboarding-close" (click)="skipOnboarding()" aria-label="Close onboarding">
        <i class="pi pi-times"></i>
      </button>
    </div>

    <div class="onboarding-content">
      <!-- Media Section (Image or Video) -->
      <div class="onboarding-media" *ngIf="currentStep.image || currentStep.videoUrl">
        <img
          *ngIf="currentStep.image"
          [src]="currentStep.image"
          [alt]="currentStep.title"
          class="onboarding-image"
        />
        <video
          *ngIf="currentStep.videoUrl"
          [src]="currentStep.videoUrl"
          controls
          class="onboarding-video"
        ></video>
      </div>

      <!-- Description -->
      <p class="onboarding-description">{{ currentStep.description }}</p>
    </div>

    <!-- Progress Indicator -->
    <div class="onboarding-progress" *ngIf="showProgress">
      <nb-progress-bar mode="determinate" [value]="progress"></nb-progress-bar>
      <span class="progress-text">{{ currentStepIndex + 1 }} of {{ steps.length }}</span>
    </div>

    <!-- Navigation Dots -->
    <div class="onboarding-dots" *ngIf="showDots">
      <button
        *ngFor="let step of steps; let i = index"
        class="dot"
        [class.active]="i === currentStepIndex"
        (click)="goToStep(i)"
        [attr.aria-label]="'Go to step ' + (i + 1)"
      ></button>
    </div>

    <!-- Actions -->
    <div class="onboarding-actions">
      <button
        *ngIf="currentStepIndex > 0"
        nbButton
        ghost
        class="btn-previous"
        (click)="previousStep()"
      >
        <i class="pi pi-arrow-left"></i> Previous
      </button>

      <button
        *ngIf="showSkip && currentStepIndex < steps.length - 1"
        nbButton
        ghost
        class="btn-skip"
        (click)="skipOnboarding()"
      >
        Skip
      </button>

      <button
        nbButton
        status="primary"
        class="btn-next"
        *ngIf="!currentStep.ctaLink && !currentStep.ctaAction"
        (click)="nextStep()"
      >
        {{ currentStepIndex < steps.length - 1 ? 'Next' : 'Finish' }}
        <nb-icon *ngIf="currentStepIndex < steps.length - 1" icon="arrow-forward-outline"></nb-icon>
      </button>

      <a
        *ngIf="currentStep.ctaLink"
        nbButton
        status="primary"
        class="btn-cta"
        [routerLink]="currentStep.ctaLink"
        (click)="nextStep()"
      >
        {{ currentStep.ctaText || 'Continue' }}
      </a>

      <button
        *ngIf="!currentStep.ctaLink && currentStep.ctaAction"
        nbButton
        status="primary"
        class="btn-cta"
        (click)="handleCtaClick()"
      >
        {{ currentStep.ctaText || 'Continue' }}
      </button>
    </div>
  </div>
</div>
