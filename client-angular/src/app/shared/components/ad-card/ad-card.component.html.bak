<div
  class="ad-card"
  [ngClass]="{
    'ad-card-list': layout === 'list',
    'ad-card-compact': layout === 'compact',
    'ad-card-featured': isFeatured,
    'ad-card-new': isNew,
    'ad-card-trending': isTrending,
    'ad-card-size-small': cardSize === 'small',
    'ad-card-size-medium': cardSize === 'medium',
    'ad-card-size-large': cardSize === 'large',
    'ad-card-density-comfortable': contentDensity === 'comfortable',
    'ad-card-density-compact': contentDensity === 'compact',
    'ad-card-density-condensed': contentDensity === 'condensed',
  }"
  (click)="onViewDetails()"
>
  <!-- Card Media Section -->
  <div class="ad-card-media">
    <!-- Primary Image -->
    <img
      [src]="getPrimaryImage()"
      [alt]="ad.title"
      class="ad-card-image"
      (error)="onImageError($event)"
    />

    <!-- Image Count Badge -->
    <div class="image-count" *ngIf="getImageCount() > 1">
      <nb-icon icon="photo_library"></nb-icon>
      <span>{{ getImageCount() }}</span>
    </div>

    <!-- Status Badges -->
    <div class="status-badges" *ngIf="showBadges">
      <span class="badge badge-featured" *ngIf="isFeatured">Featured</span>
      <span class="badge badge-new" *ngIf="isNew">New</span>
      <span class="badge badge-trending" *ngIf="isTrending">Trending</span>
      <span class="badge badge-touring" *ngIf="ad.isTouring">Touring</span>
    </div>

    <!-- Category Badge -->
    <div class="category-badge" *ngIf="ad.category && showBadges">
      <span class="badge">{{ ad.category }}</span>
    </div>

    <!-- Price Badge -->
    <div class="price-badge" *ngIf="ad.price">
      <span class="badge badge-price">{{ formatPrice(ad.price) }}</span>
    </div>
  </div>

  <!-- Card Content Section -->
  <div class="ad-card-content">
    <div class="ad-card-header">
      <h3 class="ad-card-title">{{ ad.title }}</h3>

      <!-- Location -->
      <p class="ad-card-location" *ngIf="ad.location && showLocation">
        <nb-icon icon="location_on"></nb-icon>
        <span>{{ ad.location }}</span>
      </p>
    </div>

    <!-- Description -->
    <p class="ad-card-description" *ngIf="showDescription && ad.description">
      {{ getTruncatedDescription() }}
    </p>

    <!-- Tags -->
    <div class="ad-card-tags" *ngIf="ad.tags && ad.tags.length > 0 && showDescription">
      <span class="tag" *ngFor="let tag of ad.tags.slice(0, 3)">{{ tag }}</span>
      <span class="tag more-tag" *ngIf="ad.tags.length > 3">+{{ ad.tags.length - 3 }}</span>
    </div>

    <!-- Card Footer -->
    <div class="ad-card-footer">
      <!-- Meta Information -->
      <div class="ad-card-meta">
        <span class="ad-card-date" *ngIf="ad.createdAt">
          <nb-icon icon="access_time"></nb-icon>
          {{ getTimeSince() }}
        </span>

        <span class="ad-card-views" *ngIf="ad.viewCount">
          <nb-icon icon="visibility"></nb-icon>
          {{ ad.viewCount }}
        </span>
      </div>

      <!-- Action Buttons -->
      <div class="ad-card-actions" *ngIf="showActions">
        <button nbButton ghost color="primary" nbTooltip="View Details" (click)="onViewDetails()">
          <nb-icon icon="info"></nb-icon>
        </button>

        <button nbButton ghost color="accent" nbTooltip="Add to Favorites" (click)="onLike($event)">
          <nb-icon icon="favorite_border"></nb-icon>
        </button>

        <button nbButton ghost color="primary" nbTooltip="Start Chat" (click)="onChat($event)">
          <nb-icon icon="chat"></nb-icon>
        </button>

        <button nbButton ghost nbTooltip="Share" (click)="onShare($event)">
          <nb-icon icon="share"></nb-icon>
        </button>
      </div>
    </div>
  </div>
</div>
