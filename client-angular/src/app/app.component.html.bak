<nb-layout>
  <nb-layout-header fixed>
    <nb-actions>
      <nb-action>
        <a class="navbar-brand" routerLink="/" aria-label="DateNight.io Home">
          <span class="brand-text">DateNight<span class="brand-accent">.io</span></span>
        </a>
      </nb-action>

      <!-- Main Navigation Links -->
      <nb-action>
        <nb-actions>
          <nb-action>
            <a nbButton ghost routerLink="/" [queryParams]="{ view: 'netflix' }">
              <nb-icon icon="grid-outline"></nb-icon>
              Browse
            </a>
          </nb-action>
          <nb-action>
            <a nbButton ghost routerLink="/" [queryParams]="{ view: 'tinder' }">
              <nb-icon icon="heart-outline"></nb-icon>
              Swipe
            </a>
          </nb-action>
          <nb-action>
            <a nbButton ghost routerLink="/" [queryParams]="{ view: 'list' }">
              <nb-icon icon="list-outline"></nb-icon>
              List
            </a>
          </nb-action>
          <nb-action *ngIf="isAuthenticated && isAdvertiser">
            <a nbButton ghost routerLink="/my-ads">
              <nb-icon icon="file-text-outline"></nb-icon>
              My Ads
            </a>
          </nb-action>
          <nb-action *ngIf="isAuthenticated">
            <a nbButton ghost routerLink="/chat">
              <nb-icon icon="message-circle-outline"></nb-icon>
              Chat
              <nb-badge
                *ngIf="unreadMessages > 0"
                [text]="unreadMessages"
                status="danger"
              ></nb-badge>
            </a>
          </nb-action>
          <nb-action *ngIf="isAuthenticated">
            <a nbButton ghost routerLink="/favorites">
              <nb-icon icon="heart-outline"></nb-icon>
              Favorites
            </a>
          </nb-action>
          <nb-action *ngIf="isAuthenticated">
            <a nbButton ghost routerLink="/location-matching">
              <nb-icon icon="map-outline"></nb-icon>
              Location Matching
            </a>
          </nb-action>
        </nb-actions>
      </nb-action>

      <!-- Right Side Actions -->
      <nb-action class="ml-auto">
        <nb-actions>
          <!-- PWA Install Button -->
          <nb-action *ngIf="showInstallPrompt">
            <button nbButton outline (click)="installPwa()">
              <nb-icon icon="download-outline"></nb-icon>
              Install App
            </button>
          </nb-action>

          <!-- Notifications -->
          <nb-action *ngIf="isAuthenticated">
            <button nbButton ghost [nbContextMenu]="notificationsMenu">
              <nb-icon icon="bell-outline"></nb-icon>
              <nb-badge
                *ngIf="notificationCount > 0"
                [text]="notificationCount"
                status="danger"
              ></nb-badge>
            </button>
          </nb-action>

          <!-- Admin Alerts -->
          <nb-action *ngIf="isAuthenticated && isAdmin">
            <app-alert-notifications></app-alert-notifications>
          </nb-action>

          <!-- Auth Buttons -->
          <nb-action *ngIf="!isAuthenticated">
            <a nbButton ghost routerLink="/auth/login">Login</a>
          </nb-action>
          <nb-action *ngIf="!isAuthenticated">
            <a nbButton status="primary" routerLink="/auth/register">Sign Up</a>
          </nb-action>

          <!-- User Menu -->
          <nb-action *ngIf="isAuthenticated">
            <nb-user [name]="username" [nbContextMenu]="userMenu" nbContextMenuTag="user-menu">
            </nb-user>
          </nb-action>
        </nb-actions>
      </nb-action>
    </nb-actions>
  </nb-layout-header>

  <nb-layout-column>
    <router-outlet></router-outlet>
  </nb-layout-column>

  <nb-layout-footer fixed>
    <span>&copy; 2024 DateNight.io. All rights reserved.</span>
  </nb-layout-footer>
</nb-layout>

<!-- Context Menus -->
<ng-template #notificationsMenu>
  <nb-card>
    <nb-card-header>Notifications</nb-card-header>
    <nb-list>
      <nb-list-item *ngFor="let notification of notifications">
        {{ notification.message }}
      </nb-list-item>
    </nb-list>
  </nb-card>
</ng-template>

<ng-template #userMenu>
  <nb-menu>
    <nb-menu-item title="Profile" icon="person-outline" link="/profile"></nb-menu-item>
    <nb-menu-item title="Settings" icon="settings-2-outline" link="/settings"></nb-menu-item>
    <nb-menu-item
      title="Preferences Demo"
      icon="options-2-outline"
      link="/preferences-demo"
    ></nb-menu-item>
    <nb-menu-item
      title="Design System"
      icon="color-palette-outline"
      link="/design-system"
    ></nb-menu-item>
    <nb-menu-item
      title="Accessibility Demo"
      icon="checkmark-circle-2-outline"
      link="/accessibility"
    ></nb-menu-item>
    <nb-menu-item
      title="Micro-interactions"
      icon="flash-outline"
      link="/micro-interactions"
    ></nb-menu-item>
    <nb-menu-item title="My Favorites" icon="heart-outline" link="/favorites"></nb-menu-item>
    <nb-menu-item
      *ngIf="isAdvertiser"
      title="Travel Plans"
      icon="map-outline"
      link="/touring"
    ></nb-menu-item>
    <nb-menu-item
      title="AI Profile Generator"
      icon="bulb-outline"
      link="/ai-dating-profile-generator"
    ></nb-menu-item>
    <nb-menu-item title="Video Chat" icon="video-outline" link="/video-chat"></nb-menu-item>
    <nb-menu-item
      *ngIf="isClient"
      title="Client Dashboard"
      icon="activity-outline"
      link="/client-dashboard"
    ></nb-menu-item>
    <nb-menu-item
      *ngIf="isAdvertiser"
      title="Escort Dashboard"
      icon="briefcase-outline"
      link="/escort-dashboard"
    ></nb-menu-item>
  </nb-menu>
</ng-template>

<main class="app-main" role="main">
  <div class="page-loading-indicator" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>
  <div class="container page-transition-container">
    <router-outlet></router-outlet>
  </div>
</main>

<!-- Notification and Debug Components -->
<app-notification></app-notification>
<app-debug-info></app-debug-info>
<!-- <app-performance-monitor></app-performance-monitor> -->

<footer class="app-footer" role="contentinfo">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <h5 class="footer-heading">DateNight<span class="text-primary">.io</span></h5>
        <p class="footer-text">
          The premier platform for escort, striptease, and massage services in Scandinavia.
        </p>
      </div>
      <div class="col-md-4">
        <h5 class="footer-heading">Quick Links</h5>
        <ul class="footer-links">
          <li><a routerLink="/about">About Us</a></li>
          <li><a routerLink="/terms">Terms of Service</a></li>
          <li><a routerLink="/privacy">Privacy Policy</a></li>
          <li><a routerLink="/contact">Contact Us</a></li>
        </ul>
      </div>
      <div class="col-md-4">
        <h5 class="footer-heading">Connect With Us</h5>
        <div class="social-links">
          <a href="#" class="social-link" aria-label="Facebook">
            <i class="fab fa-facebook-f" aria-hidden="true"></i>
          </a>
          <a href="#" class="social-link" aria-label="Twitter">
            <i class="fab fa-twitter" aria-hidden="true"></i>
          </a>
          <a href="#" class="social-link" aria-label="Instagram">
            <i class="fab fa-instagram" aria-hidden="true"></i>
          </a>
          <a href="#" class="social-link" aria-label="Telegram">
            <i class="fab fa-telegram" aria-hidden="true"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 DateNight.io - All rights reserved</p>
    </div>
  </div>
</footer>
